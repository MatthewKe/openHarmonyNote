<!DOCTYPE html><html><head>
      <title>note</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\keke2\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.8.10\crossnote\dependencies\katex\katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="分布式任务调度子系统轻量系统">分布式任务调度子系统（轻量系统） </h1>
<h2 id="三个模块">三个模块 </h2>
<p>//todo 部署视图，文件和模块</p>
<p>//todo 底层信息通信机制（信号量？）</p>
<p>dmsfwk_lite：分布式任务调度实现（支持FA）<br>
safwk_lite：负责提供基础服务运行的空进程（foundation进程实现），用以启动或初始化服务管理器，并使其持续运行<br>
samgr_lite：系统服务框架基于面向服务的架构，提供了服务开发、服务的子功能开发、对外接口的开发、以及多服务共进程、进程间服务调用等开发能力</p>
<p class="plantuml"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="300px" preserveAspectRatio="none" style="width:870px;height:300px;background:#FFFFFF;" version="1.1" viewBox="0 0 870 300" width="870px" zoomAndPan="magnify"><defs></defs><g><!--cluster ???????--><g id="cluster_轻量分布式调度"><rect fill="#FFFFFF" height="282" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="590" x="274.5" y="12"></rect><rect fill="#FFFFFF" height="10" style="stroke:#000000;stroke-width:1.0;" width="15" x="844.5" y="17"></rect><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="842.5" y="19"></rect><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="842.5" y="23"></rect><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="98" x="520.5" y="39.0752">轻量分布式调度</text></g><!--cluster ?????--><g id="cluster_分布式框架"><rect fill="#FFFFFF" height="99" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="259" x="581.5" y="56"></rect><rect fill="#FFFFFF" height="10" style="stroke:#000000;stroke-width:1.0;" width="15" x="820.5" y="61"></rect><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="818.5" y="63"></rect><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="818.5" y="67"></rect><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="70" x="676" y="83.0752">分布式框架</text></g><!--cluster ????--><g id="cluster_服务管理"><rect fill="#FFFFFF" height="214" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="259" x="298.5" y="56"></rect><rect fill="#FFFFFF" height="10" style="stroke:#000000;stroke-width:1.0;" width="15" x="537.5" y="61"></rect><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="535.5" y="63"></rect><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="535.5" y="67"></rect><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="56" x="400" y="83.0752">服务管理</text></g><!--entity ????--><g id="elem_远程启动"><rect fill="#FFFFFF" height="47.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="96" x="728.5" y="92"></rect><rect fill="#FFFFFF" height="10" style="stroke:#000000;stroke-width:1.0;" width="15" x="804.5" y="97"></rect><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="802.5" y="99"></rect><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="802.5" y="103"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="56" x="743.5" y="126.0752">远程启动</text></g><!--entity ????--><g id="elem_远程调用"><rect fill="#FFFFFF" height="47.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="96" x="597.5" y="92"></rect><rect fill="#FFFFFF" height="10" style="stroke:#000000;stroke-width:1.0;" width="15" x="673.5" y="97"></rect><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="671.5" y="99"></rect><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="671.5" y="103"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="56" x="612.5" y="126.0752">远程调用</text></g><!--entity ????--><g id="elem_服务注册"><rect fill="#FFFFFF" height="47.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="96" x="314.5" y="92"></rect><rect fill="#FFFFFF" height="10" style="stroke:#000000;stroke-width:1.0;" width="15" x="390.5" y="97"></rect><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="388.5" y="99"></rect><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="388.5" y="103"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="56" x="329.5" y="126.0752">服务注册</text></g><!--entity ????--><g id="elem_服务发现"><rect fill="#FFFFFF" height="47.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="96" x="445.5" y="92"></rect><rect fill="#FFFFFF" height="10" style="stroke:#000000;stroke-width:1.0;" width="15" x="521.5" y="97"></rect><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="519.5" y="99"></rect><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="519.5" y="103"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="56" x="460.5" y="126.0752">服务发现</text></g><!--entity ?????--><g id="elem_服务间通信"><rect fill="#FFFFFF" height="47.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="110" x="314.5" y="207"></rect><rect fill="#FFFFFF" height="10" style="stroke:#000000;stroke-width:1.0;" width="15" x="404.5" y="212"></rect><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="402.5" y="214"></rect><rect fill="#FFFFFF" height="2" style="stroke:#000000;stroke-width:1.0;" width="4" x="402.5" y="218"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="70" x="329.5" y="241.0752">服务间通信</text></g><!--entity dmsfwk_lite--><g id="elem_dmsfwk_lite"><path d="M13.5,88 L54.5,88 A3.75,3.75 0 0 1 57,90.5 L64,109 L121.5,109 A2.5,2.5 0 0 1 124,111.5 L124,140.5146 A2.5,2.5 0 0 1 121.5,143.0146 L13.5,143.0146 A2.5,2.5 0 0 1 11,140.5146 L11,90.5 A2.5,2.5 0 0 1 13.5,88 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><line style="stroke:#000000;stroke-width:1.0;" x1="11" x2="64" y1="109" y2="109"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="83" x="21" y="130.0752">dmsfwk_lite</text></g><!--entity safwk_lite--><g id="elem_safwk_lite"><path d="M161.5,88 L202.5,88 A3.75,3.75 0 0 1 205,90.5 L212,109 L255.5,109 A2.5,2.5 0 0 1 258,111.5 L258,140.5146 A2.5,2.5 0 0 1 255.5,143.0146 L161.5,143.0146 A2.5,2.5 0 0 1 159,140.5146 L159,90.5 A2.5,2.5 0 0 1 161.5,88 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><line style="stroke:#000000;stroke-width:1.0;" x1="159" x2="212" y1="109" y2="109"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="69" x="169" y="130.0752">safwk_lite</text></g><!--entity samgr_lite--><g id="elem_samgr_lite"><path d="M18.5,203 L59.5,203 A3.75,3.75 0 0 1 62,205.5 L69,224 L116.5,224 A2.5,2.5 0 0 1 119,226.5 L119,255.5146 A2.5,2.5 0 0 1 116.5,258.0146 L18.5,258.0146 A2.5,2.5 0 0 1 16,255.5146 L16,205.5 A2.5,2.5 0 0 1 18.5,203 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><line style="stroke:#000000;stroke-width:1.0;" x1="16" x2="69" y1="224" y2="224"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="73" x="26" y="245.0752">samgr_lite</text></g><!--SRC=[Kop9ICrDLIZ8ISpCur80WkJyt8BylDIy4eKNUtU_REz_sj7sT4VpqptzBpOqFzsrh1gi25KXNCcpXMtFvcr3A44pR_-SvokwdqvO_xHh1LubG9kUJq4egSLYvRCvlK-x5ZvVj_3vX3PSza7KFDkyucbR3rubJ_idFk_RW5V9o-bRNZRCUh9_8Pgh86HQVavAQf52IcvnMdbsV4vcIIgoS74YTj7Sz2A4g3goRWKRNLtqK8MgGXW6L5IKcPvHeejf5480R19oO040]--></g></svg></p><h2 id="samgrlite与soa架构">SamgrLite与SOA架构 </h2>
<h3 id="soa架构">SOA架构 </h3>
<blockquote>
<p>SOA，即面向服务的架构（Service-Oriented Architecture），是一种构建计算机软件的设计模式，其核心思想是将功能分解为单独的、定义良好的服务。这些服务通常为独立部署的、独立运行的软件组件，它们可以跨多种系统、应用和网络进行通信和交互。</p>
</blockquote>
<p class="plantuml"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="169px" preserveAspectRatio="none" style="width:275px;height:169px;background:#FFFFFF;" version="1.1" viewBox="0 0 275 169" width="275px" zoomAndPan="magnify"><defs></defs><g><!--entity Samgr--><g id="elem_Samgr"><rect fill="#FFFFFF" height="37.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="66" x="103.5" y="12"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="46" x="113.5" y="36.0752">Samgr</text></g><!--entity Provider--><g id="elem_Provider"><rect fill="#FFFFFF" height="37.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="77" x="12" y="126"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="57" x="22" y="150.0752">Provider</text></g><!--entity Consumer--><g id="elem_Consumer"><rect fill="#FFFFFF" height="37.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="92" x="177.5" y="126"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="72" x="187.5" y="150.0752">Consumer</text></g><!--reverse link Samgr to Consumer--><g id="link_Samgr_Consumer"><path d="M154.4428,53.6834 C161.6328,62.6134 166.71,69.01 174.5,79 C186.78,94.75 200.51,112.87 210.31,125.89 " fill="none" id="Samgr-backto-Consumer" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="150.68,49.01,153.2086,58.5287,153.8157,52.9045,159.4399,53.5116,150.68,49.01" style="stroke:#000000;stroke-width:1.0;"></polygon><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="52" x="187.5" y="93.0698">发现服务</text></g><!--reverse link Samgr to Provider--><g id="link_Samgr_Provider"><path d="M104.1741,52.7352 C93.2641,60.7952 86.11,67.54 77.5,79 C66.85,93.17 59.56,112.15 55.27,125.85 " fill="none" id="Samgr-backto-Provider" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="109,49.17,99.3844,51.3006,104.9784,52.141,104.138,57.7351,109,49.17" style="stroke:#000000;stroke-width:1.0;"></polygon><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="91" x="78.5" y="93.0698">注册服务和服务</text></g><!--reverse link Provider to Consumer--><g id="link_Provider_Consumer"><path d="M95.32,144.5 C121.43,144.5 149.95,144.5 177.44,144.5 " fill="none" id="Provider-backto-Consumer" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="89.32,144.5,98.32,148.5,94.32,144.5,98.32,140.5,89.32,144.5" style="stroke:#000000;stroke-width:1.0;"></polygon><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="52" x="107.25" y="138.5698">调用服务</text></g><!--SRC=[Kop9ICrDLIZ8ISpCur80WgBKv9B4lFISL8NWnDpq8ZInWAByiioKL7HXv_oyuj9Se31O7AnHmKOt9RyyJnSkfs2byBH_ulE-3S_cz3xjMeX59SnmeCfdcrSyRUk1g7mwgGT92roHZMvHPdf62Oe5BpOqFv-o0g8Q0000]--></g></svg></p><h4 id="通信方式">通信方式： </h4>
<p class="plantuml"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="103px" preserveAspectRatio="none" style="width:301px;height:103px;background:#FFFFFF;" version="1.1" viewBox="0 0 301 103" width="301px" zoomAndPan="magnify"><defs></defs><g><text fill="#000000" font-family="Verdana" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="154" x="69.25" y="37.1182">进程内同步通信</text><!--entity Provider--><g id="elem_Provider"><rect fill="#FFFFFF" height="37.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="77" x="12" y="60.4668"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="57" x="22" y="84.542">Provider</text></g><!--entity Consumer--><g id="elem_Consumer"><rect fill="#FFFFFF" height="37.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="92" x="203.5" y="60.4668"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="72" x="213.5" y="84.542">Consumer</text></g><!--reverse link Provider to Consumer--><g id="link_Provider_Consumer"><path d="M95.34,78.9668 C128.03,78.9668 168.84,78.9668 203.42,78.9668 " fill="none" id="Provider-backto-Consumer" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="89.34,78.9668,98.34,82.9668,94.34,78.9668,98.34,74.9668,89.34,78.9668" style="stroke:#000000;stroke-width:1.0;"></polygon><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="78" x="107.25" y="73.0366">直接调用服务</text></g><!--SRC=[Kop9ICrDLIZ8ISpCur80WfBCafnKXHVxPpzVqVsqhVNfX9vdQvU-R9ZrPFz2i7nHQd99ObuwK4r0KNvPPafg4PgmStvUSMakL1YcHi56joWpFQD45owjOANmVFQMPtrBNsneVZvbnRCvlK-x5W80]--></g></svg></p><p class="plantuml"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="216px" preserveAspectRatio="none" style="width:551px;height:216px;background:#FFFFFF;" version="1.1" viewBox="0 0 551 216" width="551px" zoomAndPan="magnify"><defs></defs><g><text fill="#000000" font-family="Verdana" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="154" x="194.25" y="37.1182">进程内异步通信</text><!--entity Provider--><g id="elem_Provider"><rect fill="#FFFFFF" height="37.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="77" x="12" y="173.7373"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="57" x="22" y="197.8125">Provider</text></g><!--entity Consumer--><g id="elem_Consumer"><rect fill="#FFFFFF" height="37.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="92" x="453.5" y="173.7373"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="72" x="463.5" y="197.8125">Consumer</text></g><!--entity ???????????--><g id="elem_本地过程调用的消息枢纽"><rect fill="#FFFFFF" height="37.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="174" x="187.5" y="59.7373"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="154" x="197.5" y="83.8125">本地过程调用的消息枢纽</text></g><!--entity ???????????--><g id="elem_本地过程调用的广播枢纽"><rect fill="#FFFFFF" height="37.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="174" x="177.5" y="173.7373"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="154" x="187.5" y="197.8125">本地过程调用的广播枢纽</text></g><!--reverse link ??????????? to Consumer--><g id="link_本地过程调用的消息枢纽_Consumer"><path d="M315.5214,99.6609 C357.6514,120.6309 421.96,152.6373 464.01,173.5773 " fill="none" id="本地过程调用的消息枢纽-backto-Consumer" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="310.15,96.9873,316.4247,104.5786,314.6262,99.2153,319.9895,97.4168,310.15,96.9873" style="stroke:#000000;stroke-width:1.0;"></polygon><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="78" x="400.5" y="140.8071">发送请求信息</text></g><!--link ??????????? to Provider--><g id="link_本地过程调用的消息枢纽_Provider"><path d="M239.01,96.9873 C197.06,117.9573 133.0663,149.9535 91.1963,170.8935 " fill="none" id="本地过程调用的消息枢纽-to-Provider" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="85.83,173.5773,95.6687,173.1292,90.3019,171.3408,92.0903,165.9741,85.83,173.5773" style="stroke:#000000;stroke-width:1.0;"></polygon><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="78" x="176.5" y="140.8071">接受请求信息</text></g><!--link Provider to ???????????--><g id="link_Provider_本地过程调用的广播枢纽"><path d="M89.25,192.2373 C113.82,192.2373 140.64,192.2373 171.22,192.2373 " fill="none" id="Provider-to-本地过程调用的广播枢纽" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="177.22,192.2373,168.22,188.2373,172.22,192.2373,168.22,196.2373,177.22,192.2373" style="stroke:#000000;stroke-width:1.0;"></polygon><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="52" x="107.25" y="186.3071">发布事件</text></g><!--link ??????????? to Consumer--><g id="link_本地过程调用的广播枢纽_Consumer"><path d="M351.67,192.2373 C386.16,192.2373 418.38,192.2373 447.32,192.2373 " fill="none" id="本地过程调用的广播枢纽-to-Consumer" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="453.32,192.2373,444.32,188.2373,448.32,192.2373,444.32,196.2373,453.32,192.2373" style="stroke:#000000;stroke-width:1.0;"></polygon><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="65" x="370" y="186.3071">通知订阅者</text></g><!--SRC=[Kop9ICrDLIZ8ISpCur80WfBCafnKXHVxPpzVqVsqhVNfdgPdQvU-R9ZrPFz2i7nHQd99ObuwK4r0KNvPPafg4PgmStvUSMakL1XDxjcSDK_dR7Ynlnre-8iDpS-dh7W-g-NPjevdZUkVpLlqVDTUOjG_tRd_sQIrKFLW3GIDLR3HBSfCpoZHXRjEmKhXQV_4bmsDBzPlVxQn2UWxe6AmOJ1l0VMK5kWIORQLmhE-fK_xfsEOHD3rG2joKjE0heBR2NRLqntDJtPrFzcz3MmAtCKmnOIDjL80HjZp-KjVh5lqSaRhYuPM0000]--></g></svg></p><p class="plantuml"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="216px" preserveAspectRatio="none" style="width:590px;height:216px;background:#FFFFFF;" version="1.1" viewBox="0 0 590 216" width="590px" zoomAndPan="magnify"><defs></defs><g><text fill="#000000" font-family="Verdana" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="154" x="213.75" y="37.1182">进程间异步通信</text><!--entity Provider--><g id="elem_Provider"><rect fill="#FFFFFF" height="37.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="77" x="12" y="173.7373"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="57" x="22" y="197.8125">Provider</text></g><!--entity Consumer--><g id="elem_Consumer"><rect fill="#FFFFFF" height="37.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="92" x="492.5" y="173.7373"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="72" x="502.5" y="197.8125">Consumer</text></g><!--entity ???????????--><g id="elem_进程间通信消息接收枢纽"><rect fill="#FFFFFF" height="37.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="174" x="207.5" y="59.7373"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="154" x="217.5" y="83.8125">进程间通信消息接收枢纽</text></g><!--entity ???????????--><g id="elem_进程间通信消息发送枢纽"><rect fill="#FFFFFF" height="37.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="174" x="203.5" y="173.7373"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="154" x="213.5" y="197.8125">进程间通信消息发送枢纽</text></g><!--reverse link ??????????? to Consumer--><g id="link_进程间通信消息接收枢纽_Consumer"><path d="M338.3429,99.3604 C384.1129,120.3704 454.66,152.7573 500.33,173.7173 " fill="none" id="进程间通信消息接收枢纽-backto-Consumer" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="332.89,96.8573,339.4007,104.2472,337.4341,98.9432,342.7381,96.9766,332.89,96.8573" style="stroke:#000000;stroke-width:1.0;"></polygon><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="78" x="431.5" y="140.8071">发送请求信息</text></g><!--link ??????????? to Provider--><g id="link_进程间通信消息接收枢纽_Provider"><path d="M256.11,96.8573 C210.34,117.8673 139.7931,150.2546 94.1231,171.2146 " fill="none" id="进程间通信消息接收枢纽-to-Provider" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="88.67,173.7173,98.5181,173.5987,93.2143,171.6317,95.1812,166.3279,88.67,173.7173" style="stroke:#000000;stroke-width:1.0;"></polygon><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="78" x="187.5" y="140.8071">接受请求信息</text></g><!--link Provider to ???????????--><g id="link_Provider_进程间通信消息发送枢纽"><path d="M89.06,192.2373 C119.87,192.2373 158.23,192.2373 197.49,192.2373 " fill="none" id="Provider-to-进程间通信消息发送枢纽" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="203.49,192.2373,194.49,188.2373,198.49,192.2373,194.49,196.2373,203.49,192.2373" style="stroke:#000000;stroke-width:1.0;"></polygon><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="78" x="107.25" y="186.3071">发送响应信息</text></g><!--link ??????????? to Consumer--><g id="link_进程间通信消息发送枢纽_Consumer"><path d="M377.59,192.2373 C416.25,192.2373 454.17,192.2373 486.35,192.2373 " fill="none" id="进程间通信消息发送枢纽-to-Consumer" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="492.35,192.2373,483.35,188.2373,487.35,192.2373,483.35,196.2373,492.35,192.2373" style="stroke:#000000;stroke-width:1.0;"></polygon><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="78" x="396" y="186.3071">接受响应信息</text></g><!--SRC=[Kop9ICrDLIZ8ISpCur80WfBCafnKXHVxPpzVqVro-fQdUvgUhLtwic7Ma_qBmV95gSabYNdfG3K1HVbbcIcfHMZ2plbvnQMvK64qERYn40EVRUjurhZ-MT_IPrEsFPktwFcklSIeVze_yML38rGzM0D1OnLiT8ioqpDATE6kKx1IW9ZpOltsPnkRGBeQruCDWtaBgAUqG9S8iwqKWDod_TCnJ2BeUg0LEQbfG5V1xOIvwkdatgUxfY2P1NStJ0jXms7kGZOB0000]--></g></svg></p><ul>
<li>Provider：服务的提供者，为系统提供能力（对外接口）。</li>
<li>Consumer：服务的消费者，调用服务提供的功能（对外接口）。</li>
<li>Samgr：作为中介者，管理Provider提供的能力，同时帮助Consumer发现Provider的能力。</li>
</ul>
<p class="plantuml"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="457px" preserveAspectRatio="none" style="width:567px;height:457px;background:#FFFFFF;" version="1.1" viewBox="0 0 567 457" width="567px" zoomAndPan="magnify"><defs></defs><g><!--class SamgrLite--><g id="elem_SamgrLite"><rect codeline="3" fill="#FFFFFF" height="257.1904" id="SamgrLite" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="240" x="65.5" y="193"></rect><ellipse cx="146.25" cy="207" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M141.3594,209.0469 L143.75,208.8125 Q143.9688,210.0156 144.625,210.5781 Q145.2969,211.1406 146.4063,211.1406 Q147.5938,211.1406 148.1875,210.6406 Q148.7969,210.1406 148.7969,209.4688 Q148.7969,209.0313 148.5469,208.7344 Q148.2969,208.4219 147.6719,208.2031 Q147.2344,208.0469 145.7031,207.6719 Q143.7188,207.1875 142.9219,206.4688 Q141.7969,205.4688 141.7969,204.0156 Q141.7969,203.0938 142.3281,202.2813 Q142.8594,201.4688 143.8438,201.0469 Q144.8438,200.625 146.25,200.625 Q148.5313,200.625 149.6875,201.625 Q150.8594,202.625 150.9063,204.3125 L148.4531,204.4219 Q148.2969,203.4844 147.7813,203.0781 Q147.2656,202.6563 146.2188,202.6563 Q145.1563,202.6563 144.5469,203.0938 Q144.1563,203.375 144.1563,203.8594 Q144.1563,204.2813 144.5156,204.5938 Q144.9844,204.9844 146.7656,205.4063 Q148.5625,205.8281 149.4219,206.2813 Q150.2813,206.7344 150.7656,207.5156 Q151.2656,208.2969 151.2656,209.4531 Q151.2656,210.5 150.6719,211.4219 Q150.0938,212.3281 149.0313,212.7813 Q147.9688,213.2188 146.3906,213.2188 Q144.0781,213.2188 142.8438,212.1563 Q141.6094,211.0781 141.3594,209.0469 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="71" x="163.75" y="212.5679">SamgrLite</text><line style="stroke:#000000;stroke-width:1.0;" x1="66.5" x2="304.5" y1="221" y2="221"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="120" x="71.5" y="239.0752">RegisterService()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="135" x="71.5" y="256.0898">UnregisterService()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="123" x="71.5" y="273.1045">RegisterFeatrue()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="146" x="71.5" y="290.1191">UnregiseterFeature()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="195" x="71.5" y="307.1338">RegisterDefaultFeatureApi()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="210" x="71.5" y="324.1484">UnregisterDefaultFeatureApi()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="145" x="71.5" y="341.1631">RegisterFeatureApi()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="160" x="71.5" y="358.1777">UnregisterFeatureApi()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="162" x="71.5" y="375.1924">GetDefaultFeatureApi()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="112" x="71.5" y="392.207">GetFeatureApi()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="160" x="71.5" y="409.2217">AddSystemCapability()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="158" x="71.5" y="426.2363">HasSystemCapability()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="228" x="71.5" y="443.251">GetSystemAvailableCapabilities()</text></g><!--class Vector--><g id="elem_Vector"><rect codeline="18" fill="#FFFFFF" height="138.0879" id="Vector" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="219" x="341" y="252.5"></rect><ellipse cx="423.75" cy="266.5" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M418.8594,268.5469 L421.25,268.3125 Q421.4688,269.5156 422.125,270.0781 Q422.7969,270.6406 423.9063,270.6406 Q425.0938,270.6406 425.6875,270.1406 Q426.2969,269.6406 426.2969,268.9688 Q426.2969,268.5313 426.0469,268.2344 Q425.7969,267.9219 425.1719,267.7031 Q424.7344,267.5469 423.2031,267.1719 Q421.2188,266.6875 420.4219,265.9688 Q419.2969,264.9688 419.2969,263.5156 Q419.2969,262.5938 419.8281,261.7813 Q420.3594,260.9688 421.3438,260.5469 Q422.3438,260.125 423.75,260.125 Q426.0313,260.125 427.1875,261.125 Q428.3594,262.125 428.4063,263.8125 L425.9531,263.9219 Q425.7969,262.9844 425.2813,262.5781 Q424.7656,262.1563 423.7188,262.1563 Q422.6563,262.1563 422.0469,262.5938 Q421.6563,262.875 421.6563,263.3594 Q421.6563,263.7813 422.0156,264.0938 Q422.4844,264.4844 424.2656,264.9063 Q426.0625,265.3281 426.9219,265.7813 Q427.7813,266.2344 428.2656,267.0156 Q428.7656,267.7969 428.7656,268.9531 Q428.7656,270 428.1719,270.9219 Q427.5938,271.8281 426.5313,272.2813 Q425.4688,272.7188 423.8906,272.7188 Q421.5781,272.7188 420.3438,271.6563 Q419.1094,270.5781 418.8594,268.5469 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="46" x="441.25" y="272.0679">Vector</text><line style="stroke:#000000;stroke-width:1.0;" x1="342" x2="559" y1="280.5" y2="280.5"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="82" x="347" y="298.5752">max : int16</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="65" x="347" y="315.5898">top int16</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="79" x="347" y="332.6045">free : int16</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="99" x="347" y="349.6191">data : void **</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="134" x="347" y="366.6338">key : VECTOR_Key</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="207" x="347" y="383.6484">compare : VECTOR_Compare</text></g><!--class SamgrLiteImpl--><g id="elem_SamgrLiteImpl"><rect codeline="26" fill="#FFFFFF" height="121.0732" id="SamgrLiteImpl" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="179" x="229" y="12"></rect><ellipse cx="264.5" cy="26" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M259.6094,28.0469 L262,27.8125 Q262.2188,29.0156 262.875,29.5781 Q263.5469,30.1406 264.6563,30.1406 Q265.8438,30.1406 266.4375,29.6406 Q267.0469,29.1406 267.0469,28.4688 Q267.0469,28.0313 266.7969,27.7344 Q266.5469,27.4219 265.9219,27.2031 Q265.4844,27.0469 263.9531,26.6719 Q261.9688,26.1875 261.1719,25.4688 Q260.0469,24.4688 260.0469,23.0156 Q260.0469,22.0938 260.5781,21.2813 Q261.1094,20.4688 262.0938,20.0469 Q263.0938,19.625 264.5,19.625 Q266.7813,19.625 267.9375,20.625 Q269.1094,21.625 269.1563,23.3125 L266.7031,23.4219 Q266.5469,22.4844 266.0313,22.0781 Q265.5156,21.6563 264.4688,21.6563 Q263.4063,21.6563 262.7969,22.0938 Q262.4063,22.375 262.4063,22.8594 Q262.4063,23.2813 262.7656,23.5938 Q263.2344,23.9844 265.0156,24.4063 Q266.8125,24.8281 267.6719,25.2813 Q268.5313,25.7344 269.0156,26.5156 Q269.5156,27.2969 269.5156,28.4531 Q269.5156,29.5 268.9219,30.4219 Q268.3438,31.3281 267.2813,31.7813 Q266.2188,32.2188 264.6406,32.2188 Q262.3281,32.2188 261.0938,31.1563 Q259.8594,30.0781 259.6094,28.0469 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="101" x="281.5" y="31.5679">SamgrLiteImpl</text><line style="stroke:#000000;stroke-width:1.0;" x1="230" x2="407" y1="40" y2="40"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="113" x="235" y="58.0752">vtbl : SamgrLite</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="118" x="235" y="75.0898">mutex : MutexId</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="142" x="235" y="92.1045">status : BootStatus</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="118" x="235" y="109.1191">services : Vector</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="167" x="235" y="126.1338">sharedPool : TaskPool[]</text></g><path d="M11,21 L11,62.5986 A0,0 0 0 0 11,62.5986 L188,62.5986 A0,0 0 0 0 188,62.5986 L188,45.7993 L233,52.5073 L188,37.7993 L188,31 L178,21 L11,21 A0,0 0 0 0 11,21 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M178,21 L178,31 L188,31 L178,21 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="156" x="17" y="39.0698">samgr利用SamgrLite实现</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="143" x="17" y="54.8691">对系统服务和特性的管理</text><path d="M11,72.5986 L11,114.1973 A0,0 0 0 0 11,114.1973 L194,114.1973 A0,0 0 0 0 194,114.1973 L194,97.3979 L233,69.522 L194,89.3979 L194,82.5986 L184,72.5986 L11,72.5986 A0,0 0 0 0 11,72.5986 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M184,72.5986 L184,82.5986 L194,82.5986 L184,72.5986 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="143" x="17" y="90.6685">互斥锁其实现与底层平台</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="162" x="17" y="106.4678">的标准CMSIS、POSIX有关</text><!--link SamgrLiteImpl to SamgrLite--><g id="link_SamgrLiteImpl_SamgrLite"><path codeline="35" d="M286.3,133.29 C276.54,151.42 268.2655,166.7977 257.0555,187.6077 " fill="none" id="SamgrLiteImpl-to-SamgrLite" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="254.21,192.89,261.9998,186.8635,256.5813,188.4881,254.9567,183.0695,254.21,192.89" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link SamgrLiteImpl to Vector--><g id="link_SamgrLiteImpl_Vector"><path codeline="36" d="M350.45,133.29 C369.6,169.13 391.1918,209.5284 411.1118,246.7984 " fill="none" id="SamgrLiteImpl-to-Vector" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="413.94,252.09,413.2254,242.2671,411.5831,247.6803,406.1699,246.0381,413.94,252.09" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--SRC=[XLBBIXn155t7hwZiek32JHQp24p6HmOZYcr4a20rqtUSmgwkflhEO2E2XlWAQe9e5a6Ik0X9DYOo43BwER6woL-akgeTPso7zARwddFkFQSU3x4E74ZWKUOF4FtLcGi4U80HuS0h84C3EoWRLIGEvSloEKDOC-Y3MLXc8O9qG3PP5HuDMlY5B-ydRlJZGFN0kth8c8RCDOn2ZJOypDXYmF9MVINTflsQyzm4OD-9cik3HTTr8ZsBbsX0AynZ6DrGpsZOZzAZB5LiKkRHYWST3OCmKwrtty4yL558Um6Shf82OJwEF3OrYg2hgac07jgbI3NG5CmbGqC6Me588_DZfRdfsQL9Y0nO5JoW4cw9aWNoOJeFeim3psPgOiNJdHt61cqWf56dqhNi6Yn4VOIX1fyAWOufB6xVJChOlLgqhWEuCqAam-Tek9B-BhxC8WtOKDrfXeUVt0cHexFnjjaN2CI36X9HwvKM2kcUR8eKLxlVa-Dl7Oaw_vWS_ZIq-j5EMbV9rQVuz42zELD7-ybUEzxucdnudPoV9U-sZGfyrxZztzSScr5TNnx5xx_yFTvKMx-iuVNlGtLveYvUgNPBlRN-sYV-lADsjajJJjdvix4vC-sK5-BJFRNLwh7-1m00]--></g></svg></p><h3 id="samgrlite">SamgrLite </h3>
<blockquote>
<p>foundation/distributedschedule/samgr_lite/interfaces/kits/samgr/samgr_lite.h</p>
</blockquote>
<p>samgr利用SamgrLite实现对系统服务和特性的管理</p>
<h3 id="mutexid">MutexId </h3>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">//foundation/distributedschedule/samgr_lite/interfaces/kits/samgr/common.h</span>
<span class="token keyword keyword-typedef">typedef</span> <span class="token keyword keyword-void">void</span> <span class="token operator">*</span>MutexId<span class="token punctuation">;</span>
</code></pre><p>互斥锁，用于保护对共享资源的访问<br>
其实现与平台所用接口（CMSIS, POSIX）相关：</p>
<p class="plantuml"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="224px" preserveAspectRatio="none" style="width:775px;height:224px;background:#FFFFFF;" version="1.1" viewBox="0 0 775 224" width="775px" zoomAndPan="magnify"><defs></defs><g><!--cluster adpter--><g id="cluster_adpter"><path d="M13.5,11 L65.5,11 A3.75,3.75 0 0 1 68,13.5 L75,34.0146 L765.5,34.0146 A2.5,2.5 0 0 1 768,36.5146 L768,214.5 A2.5,2.5 0 0 1 765.5,217 L13.5,217 A2.5,2.5 0 0 1 11,214.5 L11,13.5 A2.5,2.5 0 0 1 13.5,11 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><line style="stroke:#000000;stroke-width:1.0;" x1="11" x2="75" y1="34.0146" y2="34.0146"></line><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="51" x="15" y="27.0752">adpter</text></g><!--entity memory_adapter--><g id="elem_memory_adapter"><path d="M138,166.5 L138,198.5146 A2.5,2.5 0 0 0 140.5,201.0146 L275.5,201.0146 A2.5,2.5 0 0 0 278,198.5146 L278,174 L268,164 L140.5,164 A2.5,2.5 0 0 0 138,166.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M268,164 L268,171.5 A2.5,2.5 0 0 0 270.5,174 L278,174 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="120" x="148" y="188.0752">memory_adapter</text></g><!--entity queue_adapter--><g id="elem_queue_adapter"><path d="M313,166.5 L313,198.5146 A2.5,2.5 0 0 0 315.5,201.0146 L436.5,201.0146 A2.5,2.5 0 0 0 439,198.5146 L439,174 L429,164 L315.5,164 A2.5,2.5 0 0 0 313,166.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M429,164 L429,171.5 A2.5,2.5 0 0 0 431.5,174 L439,174 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="106" x="323" y="188.0752">queue_adapter</text></g><!--entity thread_adapter--><g id="elem_thread_adapter"><path d="M474.5,166.5 L474.5,198.5146 A2.5,2.5 0 0 0 477,201.0146 L601,201.0146 A2.5,2.5 0 0 0 603.5,198.5146 L603.5,174 L593.5,164 L477,164 A2.5,2.5 0 0 0 474.5,166.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M593.5,164 L593.5,171.5 A2.5,2.5 0 0 0 596,174 L603.5,174 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="109" x="484.5" y="188.0752">thread_adapter</text></g><!--entity time_adapter--><g id="elem_time_adapter"><path d="M638.5,166.5 L638.5,198.5146 A2.5,2.5 0 0 0 641,201.0146 L749,201.0146 A2.5,2.5 0 0 0 751.5,198.5146 L751.5,174 L741.5,164 L641,164 A2.5,2.5 0 0 0 638.5,166.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M741.5,164 L741.5,171.5 A2.5,2.5 0 0 0 744,174 L751.5,174 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="93" x="648.5" y="188.0752">time_adapter</text></g><!--entity build.gn--><g id="elem_build.gn"><path d="M27,166.5 L27,198.5146 A2.5,2.5 0 0 0 29.5,201.0146 L100.5,201.0146 A2.5,2.5 0 0 0 103,198.5146 L103,174 L93,164 L29.5,164 A2.5,2.5 0 0 0 27,166.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M93,164 L93,171.5 A2.5,2.5 0 0 0 95.5,174 L103,174 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="56" x="37" y="188.0752">build.gn</text></g><!--entity posix--><g id="elem_posix"><path d="M493,55.5 L547,55.5 A3.75,3.75 0 0 1 549.5,58 L556.5,78.5146 L571,78.5146 A2.5,2.5 0 0 1 573.5,81.0146 L573.5,93.0146 A2.5,2.5 0 0 1 571,95.5146 L493,95.5146 A2.5,2.5 0 0 1 490.5,93.0146 L490.5,58 A2.5,2.5 0 0 1 493,55.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><line style="stroke:#000000;stroke-width:1.0;" x1="490.5" x2="556.5" y1="78.5146" y2="78.5146"></line><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="41" x="500.5" y="72.5752">posix</text></g><!--entity cmsis--><g id="elem_cmsis"><path d="M367.5,55.5 L422.5,55.5 A3.75,3.75 0 0 1 425,58 L432,78.5146 L446.5,78.5146 A2.5,2.5 0 0 1 449,81.0146 L449,93.0146 A2.5,2.5 0 0 1 446.5,95.5146 L367.5,95.5146 A2.5,2.5 0 0 1 365,93.0146 L365,58 A2.5,2.5 0 0 1 367.5,55.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><line style="stroke:#000000;stroke-width:1.0;" x1="365" x2="432" y1="78.5146" y2="78.5146"></line><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="42" x="375" y="72.5752">cmsis</text></g><g id="elem_GMN18"><path d="M27,47 L27,104.3979 A0,0 0 0 0 27,104.3979 L139.89,104.3979 L82.86,163.97 L147.89,104.3979 L317,104.3979 A0,0 0 0 0 317,104.3979 L317,57 L307,47 L27,47 A0,0 0 0 0 27,47 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M307,47 L307,57 L317,57 L307,47 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="233" x="33" y="65.0698">根据ohos_kernel_type决定构建的依赖</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="233" x="33" y="80.8691">liteos_m内核则链接cmsis包下的源文件</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="269" x="33" y="96.6685">liteos_a或linux内核则链接posix包下的源文件</text></g><!--link posix to memory_adapter--><g id="link_posix_memory_adapter"><path d="M490.31,94.93 C482.62,98.11 474.61,101.26 467,104 C402.19,127.33 343.9301,144.5868 291.1901,159.1568 " fill="none" id="posix-to-memory_adapter" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="none" points="273.84,163.95,292.7878,164.9402,289.5924,153.3735,273.84,163.95" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link posix to queue_adapter--><g id="link_posix_queue_adapter"><path d="M503.75,95.51 C474.86,114.96 445.2835,134.8706 417.1535,153.8006 " fill="none" id="posix-to-queue_adapter" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="none" points="402.22,163.85,420.5033,158.7784,413.8037,148.8227,402.22,163.85" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link posix to thread_adapter--><g id="link_posix_thread_adapter"><path d="M533.28,95.76 C534.58,115.18 535.3601,126.94 536.6201,145.8 " fill="none" id="posix-to-thread_adapter" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="none" points="537.82,163.76,542.6068,145.4001,530.6335,146.2,537.82,163.76" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link posix to time_adapter--><g id="link_posix_time_adapter"><path d="M561.52,95.51 C591.7,114.96 623.0773,135.1731 652.4673,154.1031 " fill="none" id="posix-to-time_adapter" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="none" points="667.6,163.85,655.7163,149.0589,649.2184,159.1473,667.6,163.85" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link cmsis to memory_adapter--><g id="link_cmsis_memory_adapter"><path d="M370.96,95.51 C334.11,114.96 293.2501,136.5207 257.3701,155.4507 " fill="none" id="cmsis-to-memory_adapter" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="none" points="241.45,163.85,260.1699,160.7574,254.5704,150.1439,241.45,163.85" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link cmsis to queue_adapter--><g id="link_cmsis_queue_adapter"><path d="M401.31,95.76 C395.58,115.18 391.8899,127.6346 386.3299,146.4946 " fill="none" id="cmsis-to-queue_adapter" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="none" points="381.24,163.76,392.085,148.1913,380.5748,144.798,381.24,163.76" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link cmsis to thread_adapter--><g id="link_cmsis_thread_adapter"><path d="M430.9,95.51 C455.27,114.9 478.6932,133.5345 502.5032,152.4745 " fill="none" id="cmsis-to-thread_adapter" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="none" points="516.59,163.68,506.2384,147.7789,498.7681,157.1701,516.59,163.68" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link cmsis to time_adapter--><g id="link_cmsis_time_adapter"><path d="M449.1,94.48 C457.01,97.73 465.23,101.03 473,104 C530.19,125.88 579.5166,142.9894 624.6866,158.1594 " fill="none" id="cmsis-to-time_adapter" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="none" points="641.75,163.89,626.5968,152.4716,622.7764,163.8472,641.75,163.89" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--SRC=[VP3BIiD058RtVOhn0UeZ-2fXR4wReNCpcK2BkkiDl2080GjADswx4QMsqAV9ZFKjJ0RCf6scP_bVu3l_cOg00P8K4zv2nKdSwUCU81nA1V6rrShh4Wg80HFnCC0XBirzxog559ej5SM0Guz7cATrcH8QdlTufVwZIP6GmP7QOGb9MaukGwZTlhdmGBj0CxdpFVYrGFs7ohT0fmXSe9d0-Hw2Mg2HW0jL32ma4jtZDStYspmiHIIIe0yn1ngeeGGz-T3BkNaRwStwPpxAjw-xpwpgKAAWo3Cz6Pl5IizUVf-tvl7TSkZxSRwwApfc_MIoQRxvEgnXCyieuUdWe6w7F5477jfNh73x1m00]--></g></svg></p><h3 id="bootstatus">BootStatus </h3>
<blockquote>
<p>foundation/distributedschedule/samgr_lite/samgr/source/samgr_lite_inner.h</p>
</blockquote>
<p class="plantuml"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="549px" preserveAspectRatio="none" style="width:424px;height:549px;background:#FFFFFF;" version="1.1" viewBox="0 0 424 549" width="424px" zoomAndPan="magnify"><defs></defs><g><ellipse cx="214.5" cy="21" fill="#FFFFFF" rx="10" ry="10" style="stroke:#000000;stroke-width:1.0;"></ellipse><g id="BOOT_SYS"><rect fill="#FFFFFF" height="66.1826" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="252" x="88.5" y="108"></rect><line style="stroke:#000000;stroke-width:1.0;" x1="88.5" x2="340.5" y1="135.0146" y2="135.0146"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="79" x="175" y="127.0752">BOOT_SYS</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="155" x="93.5" y="152.0791">启动SYS_SERVICE_INIT和</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="228" x="97.5" y="166.6631">SYS_FEATURE_INIT宏修饰的服务与特性</text></g><g id="BOOT_APP"><rect fill="#FFFFFF" height="66.1826" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="405" x="12" y="267"></rect><line style="stroke:#000000;stroke-width:1.0;" x1="12" x2="417" y1="294.0146" y2="294.0146"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="76" x="176.5" y="286.0752">BOOT_APP</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="315" x="17" y="311.0791">启动所有SYSSEX_SERVICE_INIT,APP_SERVICE_INIT</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="381" x="21" y="325.6631">SYSSEX_FEATURE_INIT, APP_FEATURE_INIT宏修饰的服务与特性</text></g><g id="BOOT_DYNAMIC"><rect fill="#FFFFFF" height="50" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="136" x="146.5" y="410"></rect><line style="stroke:#000000;stroke-width:1.0;" x1="146.5" x2="282.5" y1="437.0146" y2="437.0146"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="116" x="156.5" y="429.0752">BOOT_DYNAMIC</text></g><ellipse cx="214.5" cy="532" fill="none" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"></ellipse><ellipse cx="214.5" cy="532" fill="#FFFFFF" rx="6" ry="6" style="stroke:#000000;stroke-width:1.0;"></ellipse><!--link *start* to BOOT_SYS--><g id="link_*start*_BOOT_SYS"><path d="M214.5,31.26 C214.5,47.56 214.5,76.09 214.5,101.89 " fill="none" id="*start*-to-BOOT_SYS" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="214.5,107.89,218.5,98.89,214.5,102.89,210.5,98.89,214.5,107.89" style="stroke:#000000;stroke-width:1.0;"></polygon><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="140" x="215.5" y="75.0698">SYS_INIT()初始化赋予</text></g><!--link BOOT_SYS to BOOT_APP--><g id="link_BOOT_SYS_BOOT_APP"><path d="M214.5,174.15 C214.5,201.24 214.5,233.81 214.5,260.89 " fill="none" id="BOOT_SYS-to-BOOT_APP" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="214.5,266.89,218.5,257.89,214.5,261.89,210.5,257.89,214.5,266.89" style="stroke:#000000;stroke-width:1.0;"></polygon><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="116" x="215.5" y="218.0698">Bootstrap服务调用</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="113" x="222" y="233.8691">INIT_APP_CALL()</text></g><!--link BOOT_APP to BOOT_DYNAMIC--><g id="link_BOOT_APP_BOOT_DYNAMIC"><path d="M214.5,333.2 C214.5,356.72 214.5,382.13 214.5,403.6 " fill="none" id="BOOT_APP-to-BOOT_DYNAMIC" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="214.5,409.6,218.5,400.6,214.5,404.6,210.5,400.6,214.5,409.6" style="stroke:#000000;stroke-width:1.0;"></polygon><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="156" x="215.5" y="377.0698">系统所有应用程序启动完毕</text></g><!--link BOOT_DYNAMIC to *end*--><g id="link_BOOT_DYNAMIC_*end*"><path d="M214.5,460.46 C214.5,480.04 214.5,500.49 214.5,514.8 " fill="none" id="BOOT_DYNAMIC-to-*end*" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="214.5,520.8,218.5,511.8,214.5,515.8,210.5,511.8,214.5,520.8" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--SRC=[Kop9ICrDLIZ8ISpCur80WcYjM0LTNJi59t__aFZWo605AmKW6U_fvncYeVcqO-xJvTrFUwQzsDhzP5S7M0DSeMvAVdaUJATZG01GfrD-VabnIL5YmRCvlK-x5hxOqFnyoWg5c3m5a74WDV7EZZu-6fe8Wq3wK0noYVHpzFLq1XhsVFFkvxldF-jiU3Qdy-ckAK2Jdg_eVhgh_-c4zK-xLZnTr_Di_LI4GJ1z8By0_SI5wbOh1OWkaDU2NOF2F9rTmLvyEga7v3oGi9khOqXe45HuNV-J_UjUBjtmV5OBn2jFTlGzxzpvh64vgjDXva9S2JGcs3K2nG8TaAUH1Q3MWTGXswYZ0598f1i0]--></g></svg></p><h3 id="vector">Vector </h3>
<blockquote>
<p>foundation/distributedschedule/samgr_lite/interfaces/kits/samgr/common.h</p>
</blockquote>
<p>支持动态扩容的数组，扩容策略为重新申请一块增大4个单元的内存空间</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-typedef">typedef</span> <span class="token keyword keyword-void">void</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">*</span>VECTOR_biKey<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-void">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-typedef">typedef</span> <span class="token keyword keyword-int">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>VECTOR_Compare<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-void">void</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-void">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-typedef">typedef</span> <span class="token keyword keyword-struct">struct</span> <span class="token class-name">SimpleVector</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    VECTOR_Key key<span class="token punctuation">;</span> <span class="token comment">//将元素转化为key，用以比较</span>
    VECTOR_Compare compare<span class="token punctuation">;</span> <span class="token comment">//比较两个key的大小</span>
    <span class="token comment">//在samgr_lite.c中，key为GetServiceName(), compare为strcmp()</span>
<span class="token punctuation">}</span> Vector<span class="token punctuation">;</span>
</code></pre><h3 id="sharedpool">SharedPool[] </h3>
<p class="plantuml"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="189px" preserveAspectRatio="none" style="width:686px;height:189px;background:#FFFFFF;" version="1.1" viewBox="0 0 686 189" width="686px" zoomAndPan="magnify"><defs></defs><g><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="359" x="167.5" y="6"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="339" x="177.5" y="28.0645">SAMGR_Bootstrap()为每一个服务创建消息队列和任务池参数</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="304" x="195" y="60.584"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="284" x="205" y="82.6484">samgr调用服务的GetTaskConfig()获取其任务配置</text><polygon fill="#FFFFFF" points="225.5,115.168,468.5,115.168,480.5,127.168,468.5,139.168,225.5,139.168,213.5,127.168,225.5,115.168" style="stroke:#000000;stroke-width:1.0;"></polygon><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="243" x="225.5" y="131.5427">TaskConfig-&gt;taskFlags == SHARED_TASK</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="20" x="193.5" y="124.8584">yes</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="14" x="480.5" y="124.8584">no</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="335" x="6" y="149.168"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="315" x="16" y="171.2324">service的任务池指向samgr的共用任务池,以节约系统资源</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="319" x="361" y="149.168"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="299" x="371" y="171.2324">服务拥有独立消息队列和任务池，记录在serviceImpl中</text><line style="stroke:#000000;stroke-width:1.0;" x1="347" x2="347" y1="40.584" y2="60.584"></line><polygon fill="#000000" points="343,50.584,347,60.584,351,50.584,347,54.584" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="213.5" x2="173.5" y1="127.168" y2="127.168"></line><line style="stroke:#000000;stroke-width:1.0;" x1="173.5" x2="173.5" y1="127.168" y2="149.168"></line><polygon fill="#000000" points="169.5,139.168,173.5,149.168,177.5,139.168,173.5,143.168" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="480.5" x2="520.5" y1="127.168" y2="127.168"></line><line style="stroke:#000000;stroke-width:1.0;" x1="520.5" x2="520.5" y1="127.168" y2="149.168"></line><polygon fill="#000000" points="516.5,139.168,520.5,149.168,524.5,139.168,520.5,143.168" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="347" x2="347" y1="95.168" y2="115.168"></line><polygon fill="#000000" points="343,105.168,347,115.168,351,105.168,347,109.168" style="stroke:#000000;stroke-width:1.0;"></polygon><!--SRC=[Kop9ICrDLIZ8ISpCur800gjWHr_te7Yd_FoIufAYn08DpISxTZrRt_zaHyEJ7QkUpUbzshNmQSVifxjtFTlMyQnn_SiPyvzsJ7ywgUV9xjr0gMSR5ppjRtesTOCrnBJYnDpqeXSRcfzFMG7H-tnMYtjgIKXYSRPpVbvQPhg6vek-xK_xfprjtGOnuMLhx_Ezwo3QCzCKD11ATUrAW6otdCJqOWLRMuLW3ySWLvVu4CTWRqq5e3Vo53GgKuireVQc5fLb9gS2ROExwrbF-zC94y4E0We_RTq8T1DSKkV9xgKlkfgUxrhsVFFkvxldlzZQycpN18WhKb9B4fCpmCpKdE9K1OsyVAWj42yzwrxwR4xdy-urprTtumgKztjwNgpRy7JlrATpLa3TvfbRaFDanrfaEm00]--></g></svg></p><p class="plantuml"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="304px" preserveAspectRatio="none" style="width:715px;height:304px;background:#FFFFFF;" version="1.1" viewBox="0 0 715 304" width="715px" zoomAndPan="magnify"><defs></defs><g><!--class TaskConfig--><g id="elem_TaskConfig"><rect codeline="3" fill="#FFFFFF" height="121.0732" id="TaskConfig" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="145" x="290" y="12"></rect><ellipse cx="320.55" cy="26" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M315.6594,28.0469 L318.05,27.8125 Q318.2688,29.0156 318.925,29.5781 Q319.5969,30.1406 320.7063,30.1406 Q321.8938,30.1406 322.4875,29.6406 Q323.0969,29.1406 323.0969,28.4688 Q323.0969,28.0313 322.8469,27.7344 Q322.5969,27.4219 321.9719,27.2031 Q321.5344,27.0469 320.0031,26.6719 Q318.0188,26.1875 317.2219,25.4688 Q316.0969,24.4688 316.0969,23.0156 Q316.0969,22.0938 316.6281,21.2813 Q317.1594,20.4688 318.1438,20.0469 Q319.1438,19.625 320.55,19.625 Q322.8313,19.625 323.9875,20.625 Q325.1594,21.625 325.2063,23.3125 L322.7531,23.4219 Q322.5969,22.4844 322.0813,22.0781 Q321.5656,21.6563 320.5188,21.6563 Q319.4563,21.6563 318.8469,22.0938 Q318.4563,22.375 318.4563,22.8594 Q318.4563,23.2813 318.8156,23.5938 Q319.2844,23.9844 321.0656,24.4063 Q322.8625,24.8281 323.7219,25.2813 Q324.5813,25.7344 325.0656,26.5156 Q325.5656,27.2969 325.5656,28.4531 Q325.5656,29.5 324.9719,30.4219 Q324.3938,31.3281 323.3313,31.7813 Q322.2688,32.2188 320.6906,32.2188 Q318.3781,32.2188 317.1438,31.1563 Q315.9094,30.0781 315.6594,28.0469 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="78" x="336.45" y="31.5679">TaskConfig</text><line style="stroke:#000000;stroke-width:1.0;" x1="291" x2="434" y1="40" y2="40"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="82" x="296" y="58.0752">level : int16</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="102" x="296" y="75.0898">priority : int16</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="127" x="296" y="92.1045">stackSize : uint16</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="133" x="296" y="109.1191">queueSize : uint16</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="118" x="296" y="126.1338">taskFlags : uint8</text></g><!--class TaskType--><g id="elem_TaskType"><rect codeline="10" fill="#FFFFFF" height="104.0586" id="TaskType" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="135" x="295" y="193"></rect><ellipse cx="326" cy="207" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M321.7344,213 L321.7344,200.8281 L330.7656,200.8281 L330.7656,202.8906 L324.1875,202.8906 L324.1875,205.5938 L330.2969,205.5938 L330.2969,207.6406 L324.1875,207.6406 L324.1875,210.9531 L331,210.9531 L331,213 L321.7344,213 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="67" x="342" y="212.5679">TaskType</text><line style="stroke:#000000;stroke-width:1.0;" x1="296" x2="429" y1="221" y2="221"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="108" x="301" y="239.0752">SHARED_TASK</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="101" x="301" y="256.0898">SINGLE_TASK</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="123" x="301" y="273.1045">SPECIFIED_TASK</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="69" x="301" y="290.1191">NO_TASK</text></g><path d="M11,219 L11,260.5986 A0,0 0 0 0 11,260.5986 L260,260.5986 A0,0 0 0 0 260,260.5986 L260,243.7993 L299,233.5073 L260,235.7993 L260,229 L250,219 L11,219 A0,0 0 0 0 11,219 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M250,219 L250,229 L260,229 L250,219 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="228" x="17" y="237.0698">基于它们的priority被多个服务共享的，</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="113" x="17" y="252.8691">例如BootStap服务</text><path d="M465,203.5 L465,236.0986 L424,267.5366 L465,244.0986 L465,276.6973 A0,0 0 0 0 465,276.6973 L708,276.6973 A0,0 0 0 0 708,276.6973 L708,213.5 L698,203.5 L465,203.5 A0,0 0 0 0 465,203.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M698,203.5 L698,213.5 L708,213.5 L698,203.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="221" x="471" y="221.5698">这是一个由多个服务共享的特定任务。</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="222" x="471" y="237.3691">与 SHARED_TASK 不同，这不是基于</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="208" x="471" y="253.1685">优先级进行共享，而是允许多个指定</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="130" x="471" y="268.9678">的服务共享同一个任务</text><!--link TaskConfig to TaskType--><g id="link_TaskConfig_TaskType"><path codeline="17" d="M362.5,133.13 C362.5,152.63 362.5,168.09 362.5,186.9 " fill="none" id="TaskConfig-to-TaskType" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="362.5,192.9,366.5,183.9,362.5,187.9,358.5,183.9,362.5,192.9" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--SRC=[RL3BJi905Dtx5UC7i71Z30iJH52YGMFPcme3DFHbEpL1Gu8eyLM82nU89WPZD163OLSBaO-nGxlp5nncAbImY-dSSy-zvvoPHtaeGQ2Al23F0VBbXGm4K59H4KXGseEQJc4TQKOQWHIl5wAAd1Lou8ZY8Zo08WW3GKOBYnHHDK7H138U17N4fmkSS0W9QapWVGCQS1P6H2KkyZdTXvSeMg8db0s9saWLLUYRuDOZEx7LtLI4ss1r8hcs6GlKsx5e8fu8Kf9RatjfZlu2sKAXvR46QyeAWYHi5W4bEsw5mzFA-C5sx3hkd3YzDxTv-liMtcCRFpKTwtLuNyENBLpjEdQRzB_x9XrpFg_mSsL5KH27U9MH_BGPAZtne0cv_BI9sNZUu7ROU7UiCj5qRxh_YhiN7xZJT7ez0dwLAyo8LG- -9gbh-DeaDib2SYSxMK96xZTmzTorNxp1dTSosU8HjsoEYDLZhsFvokOPaQ93H3ZeWsndBfcFFw5_0000]--></g></svg></p><h3 id="service">Service </h3>
<p class="plantuml"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="417px" preserveAspectRatio="none" style="width:971px;height:417px;background:#FFFFFF;" version="1.1" viewBox="0 0 971 417" width="971px" zoomAndPan="magnify"><defs></defs><g><!--class Vector--><g id="elem_Vector"><rect codeline="3" fill="#FFFFFF" height="138.0879" id="Vector" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="219" x="12" y="238"></rect><ellipse cx="94.75" cy="252" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M89.8594,254.0469 L92.25,253.8125 Q92.4688,255.0156 93.125,255.5781 Q93.7969,256.1406 94.9063,256.1406 Q96.0938,256.1406 96.6875,255.6406 Q97.2969,255.1406 97.2969,254.4688 Q97.2969,254.0313 97.0469,253.7344 Q96.7969,253.4219 96.1719,253.2031 Q95.7344,253.0469 94.2031,252.6719 Q92.2188,252.1875 91.4219,251.4688 Q90.2969,250.4688 90.2969,249.0156 Q90.2969,248.0938 90.8281,247.2813 Q91.3594,246.4688 92.3438,246.0469 Q93.3438,245.625 94.75,245.625 Q97.0313,245.625 98.1875,246.625 Q99.3594,247.625 99.4063,249.3125 L96.9531,249.4219 Q96.7969,248.4844 96.2813,248.0781 Q95.7656,247.6563 94.7188,247.6563 Q93.6563,247.6563 93.0469,248.0938 Q92.6563,248.375 92.6563,248.8594 Q92.6563,249.2813 93.0156,249.5938 Q93.4844,249.9844 95.2656,250.4063 Q97.0625,250.8281 97.9219,251.2813 Q98.7813,251.7344 99.2656,252.5156 Q99.7656,253.2969 99.7656,254.4531 Q99.7656,255.5 99.1719,256.4219 Q98.5938,257.3281 97.5313,257.7813 Q96.4688,258.2188 94.8906,258.2188 Q92.5781,258.2188 91.3438,257.1563 Q90.1094,256.0781 89.8594,254.0469 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="46" x="112.25" y="257.5679">Vector</text><line style="stroke:#000000;stroke-width:1.0;" x1="13" x2="230" y1="266" y2="266"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="82" x="18" y="284.0752">max : int16</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="65" x="18" y="301.0898">top int16</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="79" x="18" y="318.1045">free : int16</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="99" x="18" y="335.1191">data : void **</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="134" x="18" y="352.1338">key : VECTOR_Key</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="207" x="18" y="369.1484">compare : VECTOR_Compare</text></g><!--class SamgrLiteImpl--><g id="elem_SamgrLiteImpl"><rect codeline="11" fill="#FFFFFF" height="121.0732" id="SamgrLiteImpl" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="179" x="32" y="12"></rect><ellipse cx="67.5" cy="26" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M62.6094,28.0469 L65,27.8125 Q65.2188,29.0156 65.875,29.5781 Q66.5469,30.1406 67.6563,30.1406 Q68.8438,30.1406 69.4375,29.6406 Q70.0469,29.1406 70.0469,28.4688 Q70.0469,28.0313 69.7969,27.7344 Q69.5469,27.4219 68.9219,27.2031 Q68.4844,27.0469 66.9531,26.6719 Q64.9688,26.1875 64.1719,25.4688 Q63.0469,24.4688 63.0469,23.0156 Q63.0469,22.0938 63.5781,21.2813 Q64.1094,20.4688 65.0938,20.0469 Q66.0938,19.625 67.5,19.625 Q69.7813,19.625 70.9375,20.625 Q72.1094,21.625 72.1563,23.3125 L69.7031,23.4219 Q69.5469,22.4844 69.0313,22.0781 Q68.5156,21.6563 67.4688,21.6563 Q66.4063,21.6563 65.7969,22.0938 Q65.4063,22.375 65.4063,22.8594 Q65.4063,23.2813 65.7656,23.5938 Q66.2344,23.9844 68.0156,24.4063 Q69.8125,24.8281 70.6719,25.2813 Q71.5313,25.7344 72.0156,26.5156 Q72.5156,27.2969 72.5156,28.4531 Q72.5156,29.5 71.9219,30.4219 Q71.3438,31.3281 70.2813,31.7813 Q69.2188,32.2188 67.6406,32.2188 Q65.3281,32.2188 64.0938,31.1563 Q62.8594,30.0781 62.6094,28.0469 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="101" x="84.5" y="31.5679">SamgrLiteImpl</text><line style="stroke:#000000;stroke-width:1.0;" x1="33" x2="210" y1="40" y2="40"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="113" x="38" y="58.0752">vtbl : SamgrLite</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="118" x="38" y="75.0898">mutex : MutexId</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="142" x="38" y="92.1045">status : BootStatus</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="118" x="38" y="109.1191">services : Vector</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="167" x="38" y="126.1338">sharedPool : TaskPool[]</text></g><!--class ServiceImpl--><g id="elem_ServiceImpl"><rect codeline="18" fill="#FFFFFF" height="155.1025" id="ServiceImpl" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="163" x="319" y="229.5"></rect><ellipse cx="356.75" cy="243.5" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M351.8594,245.5469 L354.25,245.3125 Q354.4688,246.5156 355.125,247.0781 Q355.7969,247.6406 356.9063,247.6406 Q358.0938,247.6406 358.6875,247.1406 Q359.2969,246.6406 359.2969,245.9688 Q359.2969,245.5313 359.0469,245.2344 Q358.7969,244.9219 358.1719,244.7031 Q357.7344,244.5469 356.2031,244.1719 Q354.2188,243.6875 353.4219,242.9688 Q352.2969,241.9688 352.2969,240.5156 Q352.2969,239.5938 352.8281,238.7813 Q353.3594,237.9688 354.3438,237.5469 Q355.3438,237.125 356.75,237.125 Q359.0313,237.125 360.1875,238.125 Q361.3594,239.125 361.4063,240.8125 L358.9531,240.9219 Q358.7969,239.9844 358.2813,239.5781 Q357.7656,239.1563 356.7188,239.1563 Q355.6563,239.1563 355.0469,239.5938 Q354.6563,239.875 354.6563,240.3594 Q354.6563,240.7813 355.0156,241.0938 Q355.4844,241.4844 357.2656,241.9063 Q359.0625,242.3281 359.9219,242.7813 Q360.7813,243.2344 361.2656,244.0156 Q361.7656,244.7969 361.7656,245.9531 Q361.7656,247 361.1719,247.9219 Q360.5938,248.8281 359.5313,249.2813 Q358.4688,249.7188 356.8906,249.7188 Q354.5781,249.7188 353.3438,248.6563 Q352.1094,247.5781 351.8594,245.5469 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="80" x="374.25" y="249.0679">ServiceImpl</text><line style="stroke:#000000;stroke-width:1.0;" x1="320" x2="481" y1="257.5" y2="257.5"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="109" x="325" y="275.5752">service: Service</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="151" x="325" y="292.5898">defaultApi: IUnknown</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="132" x="325" y="309.6045">taskPool: TaskPool</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="115" x="325" y="326.6191">features: Vector</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="109" x="325" y="343.6338">serviceId: int16</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="85" x="325" y="360.6484">inited: uint8</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="114" x="325" y="377.6631">ops: Operations</text></g><!--class Service--><g id="elem_Service"><rect codeline="27" fill="#FFFFFF" height="104.0586" id="Service" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="298" x="251.5" y="20.5"></rect><ellipse cx="371.75" cy="34.5" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M366.8594,36.5469 L369.25,36.3125 Q369.4688,37.5156 370.125,38.0781 Q370.7969,38.6406 371.9063,38.6406 Q373.0938,38.6406 373.6875,38.1406 Q374.2969,37.6406 374.2969,36.9688 Q374.2969,36.5313 374.0469,36.2344 Q373.7969,35.9219 373.1719,35.7031 Q372.7344,35.5469 371.2031,35.1719 Q369.2188,34.6875 368.4219,33.9688 Q367.2969,32.9688 367.2969,31.5156 Q367.2969,30.5938 367.8281,29.7813 Q368.3594,28.9688 369.3438,28.5469 Q370.3438,28.125 371.75,28.125 Q374.0313,28.125 375.1875,29.125 Q376.3594,30.125 376.4063,31.8125 L373.9531,31.9219 Q373.7969,30.9844 373.2813,30.5781 Q372.7656,30.1563 371.7188,30.1563 Q370.6563,30.1563 370.0469,30.5938 Q369.6563,30.875 369.6563,31.3594 Q369.6563,31.7813 370.0156,32.0938 Q370.4844,32.4844 372.2656,32.9063 Q374.0625,33.3281 374.9219,33.7813 Q375.7813,34.2344 376.2656,35.0156 Q376.7656,35.7969 376.7656,36.9531 Q376.7656,38 376.1719,38.9219 Q375.5938,39.8281 374.5313,40.2813 Q373.4688,40.7188 371.8906,40.7188 Q369.5781,40.7188 368.3438,39.6563 Q367.1094,38.5781 366.8594,36.5469 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="50" x="389.25" y="40.0679">Service</text><line style="stroke:#000000;stroke-width:1.0;" x1="252.5" x2="548.5" y1="48.5" y2="48.5"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="187" x="257.5" y="66.5752">GetName()   //获取服务名称</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="170" x="257.5" y="83.5898">Initialize()    //服务初始化</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="220" x="257.5" y="100.6045">MessageHandle() //消息处理函数</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="286" x="257.5" y="117.6191">GetTaskConfig() //获取服务的任务运行配置</text></g><path d="M517,194 L517,202.8997 L434,270.0073 L517,210.8997 L517,219.7993 A0,0 0 0 0 517,219.7993 L642,219.7993 A0,0 0 0 0 642,219.7993 L642,204 L632,194 L517,194 A0,0 0 0 0 517,194 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M632,194 L632,204 L642,204 L632,194 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="104" x="523" y="212.0698">指向具体服务对象</text><path d="M517,229.7993 L517,254.4983 L476,287.022 L517,262.4983 L517,287.1973 A0,0 0 0 0 517,287.1973 L893,287.1973 A0,0 0 0 0 893,287.1973 L893,239.7993 L883,229.7993 L517,229.7993 A0,0 0 0 0 517,229.7993 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M883,229.7993 L883,239.7993 L893,239.7993 L883,229.7993 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="301" x="523" y="247.8691">通过宏INHERIT_IUNKNOWN继承IUnknown接口；</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="221" x="523" y="263.6685">用以记录服务或特性的对象引用数量；</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="355" x="523" y="279.4678">用以实现父类IUnkown指针到具体服务或特性指针的类型转换</text><path d="M517,297.1973 L517,306.0969 L434,338.0659 L517,314.0969 L517,322.9966 A0,0 0 0 0 517,322.9966 L827,322.9966 A0,0 0 0 0 827,322.9966 L827,307.1973 L817,297.1973 L517,297.1973 A0,0 0 0 0 517,297.1973 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M817,297.1973 L817,307.1973 L827,307.1973 L817,297.1973 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="289" x="523" y="315.2671">与g_samgrImpl-&gt;services-&gt;data的偏移量一致</text><path d="M517,332.9966 L517,349.7959 L410,355.0806 L517,357.7959 L517,374.5952 A0,0 0 0 0 517,374.5952 L964,374.5952 A0,0 0 0 0 964,374.5952 L964,342.9966 L954,332.9966 L517,332.9966 A0,0 0 0 0 517,332.9966 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M954,332.9966 L954,342.9966 L964,342.9966 L954,332.9966 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="272" x="523" y="351.0664">服务状态：SVC_INIT,SVC_IDLE,SVC_BUSY</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="426" x="523" y="366.8657">处于SVC_INIT状态可以注册特性，处于SVC_IDLE状态可以处理消息事件</text><path d="M517,384.5952 L517,393.4949 L439,372.0952 L517,401.4949 L517,410.3945 A0,0 0 0 0 517,410.3945 L580,410.3945 A0,0 0 0 0 580,410.3945 L580,394.5952 L570,384.5952 L517,384.5952 A0,0 0 0 0 517,384.5952 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M570,384.5952 L570,394.5952 L580,394.5952 L570,384.5952 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="42" x="523" y="402.665">//todo</text><g id="elem_GMN12"><path d="M584.5,51.5 L584.5,68.5 L549.72,72.5 L584.5,76.5 L584.5,93.0986 A0,0 0 0 0 584.5,93.0986 L826.5,93.0986 A0,0 0 0 0 826.5,93.0986 L826.5,61.5 L816.5,51.5 L584.5,51.5 A0,0 0 0 0 584.5,51.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M816.5,51.5 L816.5,61.5 L826.5,61.5 L816.5,51.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="221" x="590.5" y="69.5698">所有服务类的父类，每一个具体的服务</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="216" x="590.5" y="85.3691">类继承该类并实现其4个生命周期函数</text></g><!--link SamgrLiteImpl to Vector--><g id="link_SamgrLiteImpl_Vector"><path codeline="34" d="M121.5,133.07 C121.5,165.09 121.5,198.71 121.5,231.94 " fill="none" id="SamgrLiteImpl-to-Vector" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="121.5,237.94,125.5,228.94,121.5,232.94,117.5,228.94,121.5,237.94" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link Vector to ServiceImpl--><g id="link_Vector_ServiceImpl"><path codeline="35" d="M231.37,307 C260.49,307 285.43,307 312.76,307 " fill="none" id="Vector-to-ServiceImpl" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="318.76,307,309.76,303,313.76,307,309.76,311,318.76,307" style="stroke:#000000;stroke-width:1.0;"></polygon><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="51" x="249.5" y="301.0698">data[*]</text></g><!--reverse link Service to ServiceImpl--><g id="link_Service_ServiceImpl"><path codeline="36" d="M400.5,130.52 C400.5,161.27 400.5,195.01 400.5,229.47 " fill="none" id="Service-backto-ServiceImpl" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="400.5,124.52,396.5,133.52,400.5,129.52,404.5,133.52,400.5,124.52" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--SRC=[hLHTJnD157ttLwnlIco8YJ6c3oHIYMo0OYXW335awKxR3TsTpUuKHMDI4g05-W4AF212K4c9CRH4KpvAmv_PsLsU-0lEHxiT4esIk2yxUywvTywzSsTlenJGWMIc5Ssu9P4dfQb00hg9PYKTw5F0iXaSGrOcZgHn44VGUiiWNNajXINDGFSVicy4JU4hOG5mZLOLf11W1cggrDN5e6amIv3nliZeyCZa09XbO1pgfcA13X7X02FVYMPYYfwq1ZK4PDrCSqypQ2fD8WE66yqWGAqEqRUiCin62ihO1Eo54CNO1yU1DQF50MLuhHnD4GFgCmXfyb75dgRBYPU_iSJ3EuQ4dE4s6n0gI2YPD7fiQc597ZEc3VZA24ZKsgQpOK0b0F5h0VkQHs4dMHKRJn_D8CqWQ8R0Zm8KcYJ5i0ai1MdGiFzOJgUKfm155HtSkKlMtTr-wHYNDztj8bxUmwj5hr8BX3BPK5FIsXkk9UAMBFy9LrPmOJDG3W7RLfAWNp7KD1KJPJtlpbNnrtblTH7dckv6JToVTYC2ZOIMP6BHWxSrxpGQPE5VhFfxXSk5ejSyR5N5on8dHWg5UiG6ygKKihHa2X5AE4jowdHy9xhuaOjCA6Dsj7mN0o8WiImIJ8ZYSDWM9i0jvF3g6buuTfeVMisfdlf7Uum4Xiho_3LZPuQOyZAxvL_ay65PZlRtZSYZa_9OT20w_3pgDIhkqaLxojpIFYv_kJh_o8AyzGEdiUyVrd1pWpjnyvlUqgcRhP2MSbVuV8F8o5bSvihNu_3XZbUgUVcwTzIW-MdwGkxoVHxdQs9rGKxEaima0E-i-CtlRl7ppQh-_tqChWuJEYUbvAHDfuMoePxsRo7KG-U0DcMkx5KQf1VEITRF_RpPNlmsSlDyS9VhRdRkwdmhDXwPbAFow3ssU3BOnnQzOx4NJ4tkX7DMQeju52vNoI6uFmxmOe7tz-gy80X94b78hnM_OixPYjEetymx-MVSuXSQGHN-QoolTIdhRY-rAZvgq05WGqFykbNQIEVa6pz6Gd4P7pEYPTFhL_Vfo9pM-SZXXVe34kAjx-Ar9buxSBTtXTz5szKl]--></g></svg></p><h3 id="servcie类的3个子类具体实现">Servcie类的3个子类具体实现 </h3>
<p>//todo 三个服务的具体实现的区别与其优缺点</p>
<p>//todo C语言宏实现继承,IUnkown的QueryInterface操作</p>
<p class="plantuml"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="400px" preserveAspectRatio="none" style="width:983px;height:400px;background:#FFFFFF;" version="1.1" viewBox="0 0 983 400" width="983px" zoomAndPan="magnify"><defs></defs><g><!--class Bootstrap--><g id="elem_Bootstrap"><rect codeline="3" fill="#FFFFFF" height="70.0293" id="Bootstrap" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="134" x="157.5" y="176"></rect><ellipse cx="186.25" cy="190" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M181.3594,192.0469 L183.75,191.8125 Q183.9688,193.0156 184.625,193.5781 Q185.2969,194.1406 186.4063,194.1406 Q187.5938,194.1406 188.1875,193.6406 Q188.7969,193.1406 188.7969,192.4688 Q188.7969,192.0313 188.5469,191.7344 Q188.2969,191.4219 187.6719,191.2031 Q187.2344,191.0469 185.7031,190.6719 Q183.7188,190.1875 182.9219,189.4688 Q181.7969,188.4688 181.7969,187.0156 Q181.7969,186.0938 182.3281,185.2813 Q182.8594,184.4688 183.8438,184.0469 Q184.8438,183.625 186.25,183.625 Q188.5313,183.625 189.6875,184.625 Q190.8594,185.625 190.9063,187.3125 L188.4531,187.4219 Q188.2969,186.4844 187.7813,186.0781 Q187.2656,185.6563 186.2188,185.6563 Q185.1563,185.6563 184.5469,186.0938 Q184.1563,186.375 184.1563,186.8594 Q184.1563,187.2813 184.5156,187.5938 Q184.9844,187.9844 186.7656,188.4063 Q188.5625,188.8281 189.4219,189.2813 Q190.2813,189.7344 190.7656,190.5156 Q191.2656,191.2969 191.2656,192.4531 Q191.2656,193.5 190.6719,194.4219 Q190.0938,195.3281 189.0313,195.7813 Q187.9688,196.2188 186.3906,196.2188 Q184.0781,196.2188 182.8438,195.1563 Q181.6094,194.0781 181.3594,192.0469 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="71" x="201.75" y="195.5679">Bootstrap</text><line style="stroke:#000000;stroke-width:1.0;" x1="158.5" x2="290.5" y1="204" y2="204"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="122" x="163.5" y="222.0752">identity : Identity</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="77" x="163.5" y="239.0898">flag : unit8</text></g><!--class BroadcastService--><g id="elem_BroadcastService"><rect codeline="7" fill="#FFFFFF" height="28" id="BroadcastService" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="149" x="377" y="197"></rect><ellipse cx="390" cy="211" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M385.1094,213.0469 L387.5,212.8125 Q387.7188,214.0156 388.375,214.5781 Q389.0469,215.1406 390.1563,215.1406 Q391.3438,215.1406 391.9375,214.6406 Q392.5469,214.1406 392.5469,213.4688 Q392.5469,213.0313 392.2969,212.7344 Q392.0469,212.4219 391.4219,212.2031 Q390.9844,212.0469 389.4531,211.6719 Q387.4688,211.1875 386.6719,210.4688 Q385.5469,209.4688 385.5469,208.0156 Q385.5469,207.0938 386.0781,206.2813 Q386.6094,205.4688 387.5938,205.0469 Q388.5938,204.625 390,204.625 Q392.2813,204.625 393.4375,205.625 Q394.6094,206.625 394.6563,208.3125 L392.2031,208.4219 Q392.0469,207.4844 391.5313,207.0781 Q391.0156,206.6563 389.9688,206.6563 Q388.9063,206.6563 388.2969,207.0938 Q387.9063,207.375 387.9063,207.8594 Q387.9063,208.2813 388.2656,208.5938 Q388.7344,208.9844 390.5156,209.4063 Q392.3125,209.8281 393.1719,210.2813 Q394.0313,210.7344 394.5156,211.5156 Q395.0156,212.2969 395.0156,213.4531 Q395.0156,214.5 394.4219,215.4219 Q393.8438,216.3281 392.7813,216.7813 Q391.7188,217.2188 390.1406,217.2188 Q387.8281,217.2188 386.5938,216.1563 Q385.3594,215.0781 385.1094,213.0469 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="121" x="402" y="216.5679">BroadcastService</text></g><!--class HiviewService--><g id="elem_HiviewService"><rect codeline="9" fill="#FFFFFF" height="53.0146" id="HiviewService" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="134" x="679.5" y="184.5"></rect><ellipse cx="698.35" cy="198.5" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M693.4594,200.5469 L695.85,200.3125 Q696.0688,201.5156 696.725,202.0781 Q697.3969,202.6406 698.5063,202.6406 Q699.6938,202.6406 700.2875,202.1406 Q700.8969,201.6406 700.8969,200.9688 Q700.8969,200.5313 700.6469,200.2344 Q700.3969,199.9219 699.7719,199.7031 Q699.3344,199.5469 697.8031,199.1719 Q695.8188,198.6875 695.0219,197.9688 Q693.8969,196.9688 693.8969,195.5156 Q693.8969,194.5938 694.4281,193.7813 Q694.9594,192.9688 695.9438,192.5469 Q696.9438,192.125 698.35,192.125 Q700.6313,192.125 701.7875,193.125 Q702.9594,194.125 703.0063,195.8125 L700.5531,195.9219 Q700.3969,194.9844 699.8813,194.5781 Q699.3656,194.1563 698.3188,194.1563 Q697.2563,194.1563 696.6469,194.5938 Q696.2563,194.875 696.2563,195.3594 Q696.2563,195.7813 696.6156,196.0938 Q697.0844,196.4844 698.8656,196.9063 Q700.6625,197.3281 701.5219,197.7813 Q702.3813,198.2344 702.8656,199.0156 Q703.3656,199.7969 703.3656,200.9531 Q703.3656,202 702.7719,202.9219 Q702.1938,203.8281 701.1313,204.2813 Q700.0688,204.7188 698.4906,204.7188 Q696.1781,204.7188 694.9438,203.6563 Q693.7094,202.5781 693.4594,200.5469 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="93" x="711.65" y="204.0679">HiviewService</text><line style="stroke:#000000;stroke-width:1.0;" x1="680.5" x2="812.5" y1="212.5" y2="212.5"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="122" x="685.5" y="230.5752">identity : Identity</text></g><!--class HiviewInterface--><g id="elem_HiviewInterface"><rect codeline="12" fill="#FFFFFF" height="53.0146" id="HiviewInterface" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="133" x="680" y="323"></rect><ellipse cx="693" cy="337" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M688.1094,339.0469 L690.5,338.8125 Q690.7188,340.0156 691.375,340.5781 Q692.0469,341.1406 693.1563,341.1406 Q694.3438,341.1406 694.9375,340.6406 Q695.5469,340.1406 695.5469,339.4688 Q695.5469,339.0313 695.2969,338.7344 Q695.0469,338.4219 694.4219,338.2031 Q693.9844,338.0469 692.4531,337.6719 Q690.4688,337.1875 689.6719,336.4688 Q688.5469,335.4688 688.5469,334.0156 Q688.5469,333.0938 689.0781,332.2813 Q689.6094,331.4688 690.5938,331.0469 Q691.5938,330.625 693,330.625 Q695.2813,330.625 696.4375,331.625 Q697.6094,332.625 697.6563,334.3125 L695.2031,334.4219 Q695.0469,333.4844 694.5313,333.0781 Q694.0156,332.6563 692.9688,332.6563 Q691.9063,332.6563 691.2969,333.0938 Q690.9063,333.375 690.9063,333.8594 Q690.9063,334.2813 691.2656,334.5938 Q691.7344,334.9844 693.5156,335.4063 Q695.3125,335.8281 696.1719,336.2813 Q697.0313,336.7344 697.5156,337.5156 Q698.0156,338.2969 698.0156,339.4531 Q698.0156,340.5 697.4219,341.4219 Q696.8438,342.3281 695.7813,342.7813 Q694.7188,343.2188 693.1406,343.2188 Q690.8281,343.2188 689.5938,342.1563 Q688.3594,341.0781 688.1094,339.0469 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="105" x="705" y="342.5679">HiviewInterface</text><line style="stroke:#000000;stroke-width:1.0;" x1="681" x2="812" y1="351" y2="351"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="60" x="686" y="369.0752">output()</text></g><!--class Service--><g id="elem_Service"><rect codeline="15" fill="#FFFFFF" height="104.0586" id="Service" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="298" x="290.5" y="12"></rect><ellipse cx="410.75" cy="26" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M405.8594,28.0469 L408.25,27.8125 Q408.4688,29.0156 409.125,29.5781 Q409.7969,30.1406 410.9063,30.1406 Q412.0938,30.1406 412.6875,29.6406 Q413.2969,29.1406 413.2969,28.4688 Q413.2969,28.0313 413.0469,27.7344 Q412.7969,27.4219 412.1719,27.2031 Q411.7344,27.0469 410.2031,26.6719 Q408.2188,26.1875 407.4219,25.4688 Q406.2969,24.4688 406.2969,23.0156 Q406.2969,22.0938 406.8281,21.2813 Q407.3594,20.4688 408.3438,20.0469 Q409.3438,19.625 410.75,19.625 Q413.0313,19.625 414.1875,20.625 Q415.3594,21.625 415.4063,23.3125 L412.9531,23.4219 Q412.7969,22.4844 412.2813,22.0781 Q411.7656,21.6563 410.7188,21.6563 Q409.6563,21.6563 409.0469,22.0938 Q408.6563,22.375 408.6563,22.8594 Q408.6563,23.2813 409.0156,23.5938 Q409.4844,23.9844 411.2656,24.4063 Q413.0625,24.8281 413.9219,25.2813 Q414.7813,25.7344 415.2656,26.5156 Q415.7656,27.2969 415.7656,28.4531 Q415.7656,29.5 415.1719,30.4219 Q414.5938,31.3281 413.5313,31.7813 Q412.4688,32.2188 410.8906,32.2188 Q408.5781,32.2188 407.3438,31.1563 Q406.1094,30.0781 405.8594,28.0469 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="50" x="428.25" y="31.5679">Service</text><line style="stroke:#000000;stroke-width:1.0;" x1="291.5" x2="587.5" y1="40" y2="40"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="187" x="296.5" y="58.0752">GetName()   //获取服务名称</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="170" x="296.5" y="75.0898">Initialize()    //服务初始化</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="220" x="296.5" y="92.1045">MessageHandle() //消息处理函数</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="286" x="296.5" y="109.1191">GetTaskConfig() //获取服务的任务运行配置</text></g><!--class IUnknown--><g id="elem_IUnknown"><rect codeline="21" fill="#FFFFFF" height="87.0439" id="IUnknown" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="128" x="848.5" y="306"></rect><ellipse cx="875" cy="320" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M870.1094,322.0469 L872.5,321.8125 Q872.7188,323.0156 873.375,323.5781 Q874.0469,324.1406 875.1563,324.1406 Q876.3438,324.1406 876.9375,323.6406 Q877.5469,323.1406 877.5469,322.4688 Q877.5469,322.0313 877.2969,321.7344 Q877.0469,321.4219 876.4219,321.2031 Q875.9844,321.0469 874.4531,320.6719 Q872.4688,320.1875 871.6719,319.4688 Q870.5469,318.4688 870.5469,317.0156 Q870.5469,316.0938 871.0781,315.2813 Q871.6094,314.4688 872.5938,314.0469 Q873.5938,313.625 875,313.625 Q877.2813,313.625 878.4375,314.625 Q879.6094,315.625 879.6563,317.3125 L877.2031,317.4219 Q877.0469,316.4844 876.5313,316.0781 Q876.0156,315.6563 874.9688,315.6563 Q873.9063,315.6563 873.2969,316.0938 Q872.9063,316.375 872.9063,316.8594 Q872.9063,317.2813 873.2656,317.5938 Q873.7344,317.9844 875.5156,318.4063 Q877.3125,318.8281 878.1719,319.2813 Q879.0313,319.7344 879.5156,320.5156 Q880.0156,321.2969 880.0156,322.4531 Q880.0156,323.5 879.4219,324.4219 Q878.8438,325.3281 877.7813,325.7813 Q876.7188,326.2188 875.1406,326.2188 Q872.8281,326.2188 871.5938,325.1563 Q870.3594,324.0781 870.1094,322.0469 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="70" x="890" y="325.5679">IUnknown</text><line style="stroke:#000000;stroke-width:1.0;" x1="849.5" x2="975.5" y1="334" y2="334"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="116" x="854.5" y="352.0752">QueryInterface()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="63" x="854.5" y="369.0898">AddRef()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="65" x="854.5" y="386.1045">Release()</text></g><g id="elem_GMN16"><path d="M11,328.5 L11,370.0986 A0,0 0 0 0 11,370.0986 L336,370.0986 A0,0 0 0 0 336,370.0986 L336,338.5 L326,328.5 L185.02,328.5 L211.76,246.09 L177.02,328.5 L11,328.5 A0,0 0 0 0 11,328.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M326,328.5 L326,338.5 L336,338.5 L326,328.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="281" x="17" y="346.5698">调用INIT_APP_CALL()，以启动App服务与特性</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="304" x="17" y="362.3691">(被SYSEX\APP_SERVICE\FEATURE_INIT宏修饰)</text></g><g id="elem_GMN19"><path d="M371,336.5 L371,362.2993 A0,0 0 0 0 371,362.2993 L622,362.2993 A0,0 0 0 0 622,362.2993 L622,346.5 L612,336.5 L496.52,336.5 L455.81,225.09 L488.52,336.5 L371,336.5 A0,0 0 0 0 371,336.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M612,336.5 L612,346.5 L622,346.5 L612,336.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="230" x="377" y="354.5698">该服务的功能由其PubSubFeature提供</text></g><g id="elem_n1"><path d="M623.5,51 L623.5,76.7993 A0,0 0 0 0 623.5,76.7993 L752.56,76.7993 L748.44,184.41 L760.56,76.7993 L891.5,76.7993 A0,0 0 0 0 891.5,76.7993 L891.5,61 L881.5,51 L623.5,51 A0,0 0 0 0 623.5,51 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M881.5,51 L881.5,61 L891.5,61 L881.5,51 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="247" x="629.5" y="69.0698">DFX的子系统，提升软件质量设计的工具集</text></g><!--reverse link Service to Bootstrap--><g id="link_Service_Bootstrap"><path codeline="27" d="M348.7757,126.183 C319.3957,145.993 301.47,158.09 275.07,175.9 " fill="none" id="Service-backto-Bootstrap" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="none" points="363.7,116.12,345.4213,121.2082,352.13,131.1578,363.7,116.12" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--reverse link Service to BroadcastService--><g id="link_Service_BroadcastService"><path codeline="28" d="M445.215,134.0586 C447.605,162.9286 448.92,178.81 450.42,196.94 " fill="none" id="Service-backto-BroadcastService" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="none" points="443.73,116.12,439.2355,134.5537,451.1946,133.5636,443.73,116.12" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--reverse link Service to HiviewService--><g id="link_Service_HiviewService"><path codeline="29" d="M564.0149,123.8094 C612.8649,146.8894 652.16,165.44 692.1,184.31 " fill="none" id="Service-backto-HiviewService" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="none" points="547.74,116.12,561.4518,129.2343,566.5781,118.3844,547.74,116.12" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link HiviewService to HiviewInterface--><g id="link_HiviewService_HiviewInterface"><path codeline="30" d="M746.5,237.67 C746.5,262.08 746.5,280.57 746.5,304.94 " fill="none" id="HiviewService-to-HiviewInterface" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="none" points="746.5,322.94,752.5,304.94,740.5,304.94,746.5,322.94" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link HiviewInterface to IUnknown--><g id="link_HiviewInterface_IUnknown"><path codeline="31" d="M813.29,349.5 C824.92,349.5 818.54,349.5 830.17,349.5 " fill="none" id="HiviewInterface-to-IUnknown" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="none" points="848.17,349.5,830.17,343.5,830.17,355.5,848.17,349.5" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--SRC=[ZPBVRz9G5CVVzrTSzmGFsx8tuuC98hWcSq7Ap4oMa0kzG3Fw8-tjbZbDN3R6H1Xzc7jmccL60eaHC1hGLBP_ffUM9_y5RrlMyKlZVMXkplbyxpddUte7vv20W9o7l3W7wCdn7098aF4k492GGehgXbciQ6aC7aWILh42vJqtwXpAYvYd-3t03Az-BfE7MHhNH1xVTOClnnvJ9CYbeOfPf6ppQRGtZQpmsppQ6Sl_g-OCBIDYf6JWg5hIiApXG71QCbNe4S9hK4218BqlBTadNL8zwx-laD8bqIjMlUs331sHXtd-kSTIU8WTVo3rDwHyvfEFaQh2B5g18fTtO4fsZllxBVBfqDAFIB7NVziUhP-0wbPO4ZDyreL7Ux3U7Pg6GI_sjMvVbWU5YjLhJa_5h8jRehGZtexrH4FAhk_Cq0ddX3WkZZ8ZWJZA8wYYCRFSZ_ydW0LDNdXn_yOxBpcnsLdCs6h_0-3e10uoiTOHr8-11ONFvh13tym-vtAYX158IHXB0f0ojpEuIRjzO9qsc3KcaGp5OibmQ7Kr4FpzgsmQDQAtIAaHacNFT_F7YVNwP_zLtTK5x8-VsMTiP6FJaR6H-5Cc7DcCHaA9zNWawRn7cbNpkZcejJqNaSYvdSpkQS8whxLMpTyuALtO1pthz2ifT69QYjLIKGInfg1-LJUlplzMOVvXTCDHVz6jRuPbND31g81KYdQlPHeT-tjZKApQpIkxwHRfraYXEpW_cWTG1UAozyuoM5mSNyiV]--></g></svg></p><blockquote>
<p><code>IUnknown</code> 是 COM (Component Object Model) 技术中的一个核心接口。COM 是 Microsoft 开发的一个组件化编程模型，广泛用于 Windows 操作系统中。<code>IUnknown</code> 接口为所有 COM 对象提供了基本的对象生命周期管理和接口查询机制。</p>
<p><code>IUnknown</code> 提供了三个核心方法：</p>
<ol>
<li><strong>AddRef()</strong>: 增加对象的引用计数。</li>
<li><strong>Release()</strong>: 减少对象的引用计数，并在引用计数达到零时删除对象。</li>
<li><strong>QueryInterface()</strong>: 允许客户端查询对象是否支持特定的接口，并获取该接口的指针。<br>
任何想要遵循 COM 规则并能够在 COM 环境中使用的对象都必须实现 <code>IUnknown</code> 接口。此外，COM 对象的生命周期管理是通过引用计数完成的，即当一个客户端开始使用一个对象时，它会调用 <code>AddRef</code>，当不再使用它时会调用 <code>Release</code>。当对象的引用计数达到零时，对象会自动销毁。</li>
</ol>
<p><code>QueryInterface</code> 方法允许对象在运行时查询它是否支持特定的接口。这是一种动态类型检查机制，允许安全地在对象上调用特定的方法。</p>
</blockquote>
<h4 id="broadcastservice">BroadcastService </h4>
<p class="plantuml"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="685px" preserveAspectRatio="none" style="width:1131px;height:685px;background:#FFFFFF;" version="1.1" viewBox="0 0 1131 685" width="1131px" zoomAndPan="magnify"><defs></defs><g><!--class SamgrLiteImpl--><g id="elem_SamgrLiteImpl"><rect codeline="3" fill="#FFFFFF" height="121.0732" id="SamgrLiteImpl" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="179" x="188" y="12"></rect><ellipse cx="223.5" cy="26" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M218.6094,28.0469 L221,27.8125 Q221.2188,29.0156 221.875,29.5781 Q222.5469,30.1406 223.6563,30.1406 Q224.8438,30.1406 225.4375,29.6406 Q226.0469,29.1406 226.0469,28.4688 Q226.0469,28.0313 225.7969,27.7344 Q225.5469,27.4219 224.9219,27.2031 Q224.4844,27.0469 222.9531,26.6719 Q220.9688,26.1875 220.1719,25.4688 Q219.0469,24.4688 219.0469,23.0156 Q219.0469,22.0938 219.5781,21.2813 Q220.1094,20.4688 221.0938,20.0469 Q222.0938,19.625 223.5,19.625 Q225.7813,19.625 226.9375,20.625 Q228.1094,21.625 228.1563,23.3125 L225.7031,23.4219 Q225.5469,22.4844 225.0313,22.0781 Q224.5156,21.6563 223.4688,21.6563 Q222.4063,21.6563 221.7969,22.0938 Q221.4063,22.375 221.4063,22.8594 Q221.4063,23.2813 221.7656,23.5938 Q222.2344,23.9844 224.0156,24.4063 Q225.8125,24.8281 226.6719,25.2813 Q227.5313,25.7344 228.0156,26.5156 Q228.5156,27.2969 228.5156,28.4531 Q228.5156,29.5 227.9219,30.4219 Q227.3438,31.3281 226.2813,31.7813 Q225.2188,32.2188 223.6406,32.2188 Q221.3281,32.2188 220.0938,31.1563 Q218.8594,30.0781 218.6094,28.0469 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="101" x="240.5" y="31.5679">SamgrLiteImpl</text><line style="stroke:#000000;stroke-width:1.0;" x1="189" x2="366" y1="40" y2="40"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="113" x="194" y="58.0752">vtbl : SamgrLite</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="118" x="194" y="75.0898">mutex : MutexId</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="142" x="194" y="92.1045">status : BootStatus</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="118" x="194" y="109.1191">services : Vector</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="167" x="194" y="126.1338">sharedPool : TaskPool[]</text></g><!--class Service--><g id="elem_Service"><rect codeline="10" fill="#FFFFFF" height="104.0586" id="Service" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="131" x="21" y="426"></rect><ellipse cx="57.85" cy="440" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M52.9594,442.0469 L55.35,441.8125 Q55.5688,443.0156 56.225,443.5781 Q56.8969,444.1406 58.0063,444.1406 Q59.1938,444.1406 59.7875,443.6406 Q60.3969,443.1406 60.3969,442.4688 Q60.3969,442.0313 60.1469,441.7344 Q59.8969,441.4219 59.2719,441.2031 Q58.8344,441.0469 57.3031,440.6719 Q55.3188,440.1875 54.5219,439.4688 Q53.3969,438.4688 53.3969,437.0156 Q53.3969,436.0938 53.9281,435.2813 Q54.4594,434.4688 55.4438,434.0469 Q56.4438,433.625 57.85,433.625 Q60.1313,433.625 61.2875,434.625 Q62.4594,435.625 62.5063,437.3125 L60.0531,437.4219 Q59.8969,436.4844 59.3813,436.0781 Q58.8656,435.6563 57.8188,435.6563 Q56.7563,435.6563 56.1469,436.0938 Q55.7563,436.375 55.7563,436.8594 Q55.7563,437.2813 56.1156,437.5938 Q56.5844,437.9844 58.3656,438.4063 Q60.1625,438.8281 61.0219,439.2813 Q61.8813,439.7344 62.3656,440.5156 Q62.8656,441.2969 62.8656,442.4531 Q62.8656,443.5 62.2719,444.4219 Q61.6938,445.3281 60.6313,445.7813 Q59.5688,446.2188 57.9906,446.2188 Q55.6781,446.2188 54.4438,445.1563 Q53.2094,444.0781 52.9594,442.0469 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="50" x="75.15" y="445.5679">Service</text><line style="stroke:#000000;stroke-width:1.0;" x1="22" x2="151" y1="454" y2="454"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="76" x="27" y="472.0752">GetName()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="68" x="27" y="489.0898">Initialize()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="119" x="27" y="506.1045">MessageHandle()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="115" x="27" y="523.1191">GetTaskConfig()</text></g><!--class BroadcastService--><g id="elem_BroadcastService"><rect codeline="16" fill="#FFFFFF" height="28" id="BroadcastService" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="149" x="12" y="273.5"></rect><ellipse cx="25" cy="287.5" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M20.1094,289.5469 L22.5,289.3125 Q22.7188,290.5156 23.375,291.0781 Q24.0469,291.6406 25.1563,291.6406 Q26.3438,291.6406 26.9375,291.1406 Q27.5469,290.6406 27.5469,289.9688 Q27.5469,289.5313 27.2969,289.2344 Q27.0469,288.9219 26.4219,288.7031 Q25.9844,288.5469 24.4531,288.1719 Q22.4688,287.6875 21.6719,286.9688 Q20.5469,285.9688 20.5469,284.5156 Q20.5469,283.5938 21.0781,282.7813 Q21.6094,281.9688 22.5938,281.5469 Q23.5938,281.125 25,281.125 Q27.2813,281.125 28.4375,282.125 Q29.6094,283.125 29.6563,284.8125 L27.2031,284.9219 Q27.0469,283.9844 26.5313,283.5781 Q26.0156,283.1563 24.9688,283.1563 Q23.9063,283.1563 23.2969,283.5938 Q22.9063,283.875 22.9063,284.3594 Q22.9063,284.7813 23.2656,285.0938 Q23.7344,285.4844 25.5156,285.9063 Q27.3125,286.3281 28.1719,286.7813 Q29.0313,287.2344 29.5156,288.0156 Q30.0156,288.7969 30.0156,289.9531 Q30.0156,291 29.4219,291.9219 Q28.8438,292.8281 27.7813,293.2813 Q26.7188,293.7188 25.1406,293.7188 Q22.8281,293.7188 21.5938,292.6563 Q20.3594,291.5781 20.1094,289.5469 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="121" x="37" y="293.0679">BroadcastService</text></g><!--class IUnknown--><g id="elem_IUnknown"><rect codeline="18" fill="#FFFFFF" height="87.0439" id="IUnknown" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="128" x="338.5" y="591"></rect><ellipse cx="365" cy="605" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M360.1094,607.0469 L362.5,606.8125 Q362.7188,608.0156 363.375,608.5781 Q364.0469,609.1406 365.1563,609.1406 Q366.3438,609.1406 366.9375,608.6406 Q367.5469,608.1406 367.5469,607.4688 Q367.5469,607.0313 367.2969,606.7344 Q367.0469,606.4219 366.4219,606.2031 Q365.9844,606.0469 364.4531,605.6719 Q362.4688,605.1875 361.6719,604.4688 Q360.5469,603.4688 360.5469,602.0156 Q360.5469,601.0938 361.0781,600.2813 Q361.6094,599.4688 362.5938,599.0469 Q363.5938,598.625 365,598.625 Q367.2813,598.625 368.4375,599.625 Q369.6094,600.625 369.6563,602.3125 L367.2031,602.4219 Q367.0469,601.4844 366.5313,601.0781 Q366.0156,600.6563 364.9688,600.6563 Q363.9063,600.6563 363.2969,601.0938 Q362.9063,601.375 362.9063,601.8594 Q362.9063,602.2813 363.2656,602.5938 Q363.7344,602.9844 365.5156,603.4063 Q367.3125,603.8281 368.1719,604.2813 Q369.0313,604.7344 369.5156,605.5156 Q370.0156,606.2969 370.0156,607.4531 Q370.0156,608.5 369.4219,609.4219 Q368.8438,610.3281 367.7813,610.7813 Q366.7188,611.2188 365.1406,611.2188 Q362.8281,611.2188 361.5938,610.1563 Q360.3594,609.0781 360.1094,607.0469 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="70" x="380" y="610.5679">IUnknown</text><line style="stroke:#000000;stroke-width:1.0;" x1="339.5" x2="465.5" y1="619" y2="619"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="116" x="344.5" y="637.0752">QueryInterface()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="63" x="344.5" y="654.0898">AddRef()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="65" x="344.5" y="671.1045">Release()</text></g><!--class ServiceImpl--><g id="elem_ServiceImpl"><rect codeline="23" fill="#FFFFFF" height="155.1025" id="ServiceImpl" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="163" x="196" y="210"></rect><ellipse cx="233.75" cy="224" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M228.8594,226.0469 L231.25,225.8125 Q231.4688,227.0156 232.125,227.5781 Q232.7969,228.1406 233.9063,228.1406 Q235.0938,228.1406 235.6875,227.6406 Q236.2969,227.1406 236.2969,226.4688 Q236.2969,226.0313 236.0469,225.7344 Q235.7969,225.4219 235.1719,225.2031 Q234.7344,225.0469 233.2031,224.6719 Q231.2188,224.1875 230.4219,223.4688 Q229.2969,222.4688 229.2969,221.0156 Q229.2969,220.0938 229.8281,219.2813 Q230.3594,218.4688 231.3438,218.0469 Q232.3438,217.625 233.75,217.625 Q236.0313,217.625 237.1875,218.625 Q238.3594,219.625 238.4063,221.3125 L235.9531,221.4219 Q235.7969,220.4844 235.2813,220.0781 Q234.7656,219.6563 233.7188,219.6563 Q232.6563,219.6563 232.0469,220.0938 Q231.6563,220.375 231.6563,220.8594 Q231.6563,221.2813 232.0156,221.5938 Q232.4844,221.9844 234.2656,222.4063 Q236.0625,222.8281 236.9219,223.2813 Q237.7813,223.7344 238.2656,224.5156 Q238.7656,225.2969 238.7656,226.4531 Q238.7656,227.5 238.1719,228.4219 Q237.5938,229.3281 236.5313,229.7813 Q235.4688,230.2188 233.8906,230.2188 Q231.5781,230.2188 230.3438,229.1563 Q229.1094,228.0781 228.8594,226.0469 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="80" x="251.25" y="229.5679">ServiceImpl</text><line style="stroke:#000000;stroke-width:1.0;" x1="197" x2="358" y1="238" y2="238"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="109" x="202" y="256.0752">service: Service</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="151" x="202" y="273.0898">defaultApi: IUnknown</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="132" x="202" y="290.1045">taskPool: TaskPool</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="115" x="202" y="307.1191">features: Vector</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="109" x="202" y="324.1338">serviceId: int16</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="85" x="202" y="341.1484">inited: uint8</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="114" x="202" y="358.1631">ops: Operations</text></g><!--class PubSubImplement--><g id="elem_PubSubImplement"><rect codeline="32" fill="#FFFFFF" height="146.0879" id="PubSubImplement" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="185" x="516" y="214.5"></rect><ellipse cx="542.05" cy="228.5" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M537.1594,230.5469 L539.55,230.3125 Q539.7688,231.5156 540.425,232.0781 Q541.0969,232.6406 542.2063,232.6406 Q543.3938,232.6406 543.9875,232.1406 Q544.5969,231.6406 544.5969,230.9688 Q544.5969,230.5313 544.3469,230.2344 Q544.0969,229.9219 543.4719,229.7031 Q543.0344,229.5469 541.5031,229.1719 Q539.5188,228.6875 538.7219,227.9688 Q537.5969,226.9688 537.5969,225.5156 Q537.5969,224.5938 538.1281,223.7813 Q538.6594,222.9688 539.6438,222.5469 Q540.6438,222.125 542.05,222.125 Q544.3313,222.125 545.4875,223.125 Q546.6594,224.125 546.7063,225.8125 L544.2531,225.9219 Q544.0969,224.9844 543.5813,224.5781 Q543.0656,224.1563 542.0188,224.1563 Q540.9563,224.1563 540.3469,224.5938 Q539.9563,224.875 539.9563,225.3594 Q539.9563,225.7813 540.3156,226.0938 Q540.7844,226.4844 542.5656,226.9063 Q544.3625,227.3281 545.2219,227.7813 Q546.0813,228.2344 546.5656,229.0156 Q547.0656,229.7969 547.0656,230.9531 Q547.0656,232 546.4719,232.9219 Q545.8938,233.8281 544.8313,234.2813 Q543.7688,234.7188 542.1906,234.7188 Q539.8781,234.7188 538.6438,233.6563 Q537.4094,232.5781 537.1594,230.5469 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="128" x="556.95" y="234.0679">PubSubImplement</text><line style="stroke:#000000;stroke-width:1.0;" x1="517" x2="700" y1="242.5" y2="242.5"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="173" x="522" y="260.5752">feature : PubSubFeature</text><line style="stroke:#000000;stroke-width:1.0;" x1="517" x2="700" y1="267.5146" y2="267.5146"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="75" x="522" y="285.5898">addTopic()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="79" x="522" y="302.6045">subscribe()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="131" x="522" y="319.6191">modifyConsumer()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="97" x="522" y="336.6338">unsubscribe()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="62" x="522" y="353.6484">publish()</text></g><!--class PubSubInterface--><g id="elem_PubSubInterface"><rect codeline="40" fill="#FFFFFF" height="70.0293" id="PubSubInterface" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="176" x="314.5" y="443"></rect><ellipse cx="341.9" cy="457" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M337.0094,459.0469 L339.4,458.8125 Q339.6188,460.0156 340.275,460.5781 Q340.9469,461.1406 342.0563,461.1406 Q343.2438,461.1406 343.8375,460.6406 Q344.4469,460.1406 344.4469,459.4688 Q344.4469,459.0313 344.1969,458.7344 Q343.9469,458.4219 343.3219,458.2031 Q342.8844,458.0469 341.3531,457.6719 Q339.3688,457.1875 338.5719,456.4688 Q337.4469,455.4688 337.4469,454.0156 Q337.4469,453.0938 337.9781,452.2813 Q338.5094,451.4688 339.4938,451.0469 Q340.4938,450.625 341.9,450.625 Q344.1813,450.625 345.3375,451.625 Q346.5094,452.625 346.5563,454.3125 L344.1031,454.4219 Q343.9469,453.4844 343.4313,453.0781 Q342.9156,452.6563 341.8688,452.6563 Q340.8063,452.6563 340.1969,453.0938 Q339.8063,453.375 339.8063,453.8594 Q339.8063,454.2813 340.1656,454.5938 Q340.6344,454.9844 342.4156,455.4063 Q344.2125,455.8281 345.0719,456.2813 Q345.9313,456.7344 346.4156,457.5156 Q346.9156,458.2969 346.9156,459.4531 Q346.9156,460.5 346.3219,461.4219 Q345.7438,462.3281 344.6813,462.7813 Q343.6188,463.2188 342.0406,463.2188 Q339.7281,463.2188 338.4938,462.1563 Q337.2594,461.0781 337.0094,459.0469 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="116" x="357.1" y="462.5679">PubSubInterface</text><line style="stroke:#000000;stroke-width:1.0;" x1="315.5" x2="489.5" y1="471" y2="471"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="164" x="320.5" y="489.0752">subscriber : Subscriber</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="131" x="320.5" y="506.0898">provider : Provider</text></g><!--class PubSubFeature--><g id="elem_PubSubFeature"><rect codeline="44" fill="#FFFFFF" height="112.0586" id="PubSubFeature" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="144" x="747.5" y="231.5"></rect><ellipse cx="764.55" cy="245.5" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M759.6594,247.5469 L762.05,247.3125 Q762.2688,248.5156 762.925,249.0781 Q763.5969,249.6406 764.7063,249.6406 Q765.8938,249.6406 766.4875,249.1406 Q767.0969,248.6406 767.0969,247.9688 Q767.0969,247.5313 766.8469,247.2344 Q766.5969,246.9219 765.9719,246.7031 Q765.5344,246.5469 764.0031,246.1719 Q762.0188,245.6875 761.2219,244.9688 Q760.0969,243.9688 760.0969,242.5156 Q760.0969,241.5938 760.6281,240.7813 Q761.1594,239.9688 762.1438,239.5469 Q763.1438,239.125 764.55,239.125 Q766.8313,239.125 767.9875,240.125 Q769.1594,241.125 769.2063,242.8125 L766.7531,242.9219 Q766.5969,241.9844 766.0813,241.5781 Q765.5656,241.1563 764.5188,241.1563 Q763.4563,241.1563 762.8469,241.5938 Q762.4563,241.875 762.4563,242.3594 Q762.4563,242.7813 762.8156,243.0938 Q763.2844,243.4844 765.0656,243.9063 Q766.8625,244.3281 767.7219,244.7813 Q768.5813,245.2344 769.0656,246.0156 Q769.5656,246.7969 769.5656,247.9531 Q769.5656,249 768.9719,249.9219 Q768.3938,250.8281 767.3313,251.2813 Q766.2688,251.7188 764.6906,251.7188 Q762.3781,251.7188 761.1438,250.6563 Q759.9094,249.5781 759.6594,247.5469 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="107" x="777.45" y="251.0679">PubSubFeature</text><line style="stroke:#000000;stroke-width:1.0;" x1="748.5" x2="890.5" y1="259.5" y2="259.5"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="118" x="753.5" y="277.5752">mutex : MutexId</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="132" x="753.5" y="294.5898">relations : Relation</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="122" x="753.5" y="311.6045">identity : Identity</text><line style="stroke:#000000;stroke-width:1.0;" x1="748.5" x2="890.5" y1="318.5439" y2="318.5439"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="93" x="753.5" y="336.6191">GetRelation()</text></g><!--class FeatureImpl--><g id="elem_FeatureImpl"><rect codeline="50" fill="#FFFFFF" height="70.0293" id="FeatureImpl" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="166" x="525.5" y="443"></rect><ellipse cx="563.25" cy="457" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M558.3594,459.0469 L560.75,458.8125 Q560.9688,460.0156 561.625,460.5781 Q562.2969,461.1406 563.4063,461.1406 Q564.5938,461.1406 565.1875,460.6406 Q565.7969,460.1406 565.7969,459.4688 Q565.7969,459.0313 565.5469,458.7344 Q565.2969,458.4219 564.6719,458.2031 Q564.2344,458.0469 562.7031,457.6719 Q560.7188,457.1875 559.9219,456.4688 Q558.7969,455.4688 558.7969,454.0156 Q558.7969,453.0938 559.3281,452.2813 Q559.8594,451.4688 560.8438,451.0469 Q561.8438,450.625 563.25,450.625 Q565.5313,450.625 566.6875,451.625 Q567.8594,452.625 567.9063,454.3125 L565.4531,454.4219 Q565.2969,453.4844 564.7813,453.0781 Q564.2656,452.6563 563.2188,452.6563 Q562.1563,452.6563 561.5469,453.0938 Q561.1563,453.375 561.1563,453.8594 Q561.1563,454.2813 561.5156,454.5938 Q561.9844,454.9844 563.7656,455.4063 Q565.5625,455.8281 566.4219,456.2813 Q567.2813,456.7344 567.7656,457.5156 Q568.2656,458.2969 568.2656,459.4531 Q568.2656,460.5 567.6719,461.4219 Q567.0938,462.3281 566.0313,462.7813 Q564.9688,463.2188 563.3906,463.2188 Q561.0781,463.2188 559.8438,462.1563 Q558.6094,461.0781 558.3594,459.0469 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="83" x="580.75" y="462.5679">FeatureImpl</text><line style="stroke:#000000;stroke-width:1.0;" x1="526.5" x2="690.5" y1="471" y2="471"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="119" x="531.5" y="489.0752">feature : Feature</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="154" x="531.5" y="506.0898">iUnknown : IUnknown</text></g><!--class Feature--><g id="elem_Feature"><rect codeline="54" fill="#FFFFFF" height="104.0586" id="Feature" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="207" x="727" y="426"></rect><ellipse cx="800.25" cy="440" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M795.3594,442.0469 L797.75,441.8125 Q797.9688,443.0156 798.625,443.5781 Q799.2969,444.1406 800.4063,444.1406 Q801.5938,444.1406 802.1875,443.6406 Q802.7969,443.1406 802.7969,442.4688 Q802.7969,442.0313 802.5469,441.7344 Q802.2969,441.4219 801.6719,441.2031 Q801.2344,441.0469 799.7031,440.6719 Q797.7188,440.1875 796.9219,439.4688 Q795.7969,438.4688 795.7969,437.0156 Q795.7969,436.0938 796.3281,435.2813 Q796.8594,434.4688 797.8438,434.0469 Q798.8438,433.625 800.25,433.625 Q802.5313,433.625 803.6875,434.625 Q804.8594,435.625 804.9063,437.3125 L802.4531,437.4219 Q802.2969,436.4844 801.7813,436.0781 Q801.2656,435.6563 800.2188,435.6563 Q799.1563,435.6563 798.5469,436.0938 Q798.1563,436.375 798.1563,436.8594 Q798.1563,437.2813 798.5156,437.5938 Q798.9844,437.9844 800.7656,438.4063 Q802.5625,438.8281 803.4219,439.2813 Q804.2813,439.7344 804.7656,440.5156 Q805.2656,441.2969 805.2656,442.4531 Q805.2656,443.5 804.6719,444.4219 Q804.0938,445.3281 803.0313,445.7813 Q801.9688,446.2188 800.3906,446.2188 Q798.0781,446.2188 796.8438,445.1563 Q795.6094,444.0781 795.3594,442.0469 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="53" x="817.75" y="445.5679">Feature</text><line style="stroke:#000000;stroke-width:1.0;" x1="728" x2="933" y1="454" y2="454"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="76" x="733" y="472.0752">GetName()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="88" x="733" y="489.0898">OnInitialize()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="195" x="733" y="506.1045">OnStop() //停止对外提供特性</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="165" x="733" y="523.1191">OnMessage() //消息处理</text></g><!--class Relation--><g id="elem_Relation"><rect codeline="60" fill="#FFFFFF" height="87.0439" id="Relation" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="197" x="927" y="244"></rect><ellipse cx="993.75" cy="258" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M988.8594,260.0469 L991.25,259.8125 Q991.4688,261.0156 992.125,261.5781 Q992.7969,262.1406 993.9063,262.1406 Q995.0938,262.1406 995.6875,261.6406 Q996.2969,261.1406 996.2969,260.4688 Q996.2969,260.0313 996.0469,259.7344 Q995.7969,259.4219 995.1719,259.2031 Q994.7344,259.0469 993.2031,258.6719 Q991.2188,258.1875 990.4219,257.4688 Q989.2969,256.4688 989.2969,255.0156 Q989.2969,254.0938 989.8281,253.2813 Q990.3594,252.4688 991.3438,252.0469 Q992.3438,251.625 993.75,251.625 Q996.0313,251.625 997.1875,252.625 Q998.3594,253.625 998.4063,255.3125 L995.9531,255.4219 Q995.7969,254.4844 995.2813,254.0781 Q994.7656,253.6563 993.7188,253.6563 Q992.6563,253.6563 992.0469,254.0938 Q991.6563,254.375 991.6563,254.8594 Q991.6563,255.2813 992.0156,255.5938 Q992.4844,255.9844 994.2656,256.4063 Q996.0625,256.8281 996.9219,257.2813 Q997.7813,257.7344 998.2656,258.5156 Q998.7656,259.2969 998.7656,260.4531 Q998.7656,261.5 998.1719,262.4219 Q997.5938,263.3281 996.5313,263.7813 Q995.4688,264.2188 993.8906,264.2188 Q991.5781,264.2188 990.3438,263.1563 Q989.1094,262.0781 988.8594,260.0469 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="56" x="1011.25" y="263.5679">Relation</text><line style="stroke:#000000;stroke-width:1.0;" x1="928" x2="1123" y1="272" y2="272"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="162" x="933" y="290.0752">node : UTILS_DL_LIST</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="185" x="933" y="307.0898">callbacks : ConsumerNode</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="87" x="933" y="324.1045">topic : Topic</text></g><g id="elem_GMN24"><path d="M559,59.5 L559,85.2993 A0,0 0 0 0 559,85.2993 L604.5,85.2993 L608.5,214.28 L612.5,85.2993 L658,85.2993 A0,0 0 0 0 658,85.2993 L658,69.5 L648,59.5 L559,59.5 A0,0 0 0 0 559,59.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M648,59.5 L648,69.5 L658,69.5 L648,59.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="78" x="565" y="77.5698">提供对外接口</text></g><g id="elem_GMN27"><path d="M731,51.5 L731,93.0986 A0,0 0 0 0 731,93.0986 L815.5,93.0986 L819.5,231.08 L823.5,93.0986 L908,93.0986 A0,0 0 0 0 908,93.0986 L908,61.5 L898,51.5 L731,51.5 A0,0 0 0 0 731,51.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M898,51.5 L898,61.5 L908,61.5 L898,51.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="91" x="737" y="69.5698">广播的底层实现</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="156" x="737" y="85.3691">维护一个双向链表Relation</text></g><g id="elem_GMN30"><path d="M963,51.5 L963,93.0986 A0,0 0 0 0 963,93.0986 L1021.5,93.0986 L1025.5,243.64 L1029.5,93.0986 L1088,93.0986 A0,0 0 0 0 1088,93.0986 L1088,61.5 L1078,51.5 L963,51.5 A0,0 0 0 0 963,51.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M1078,51.5 L1078,61.5 L1088,61.5 L1078,51.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="52" x="969" y="69.5698">双向链表</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="104" x="969" y="85.3691">维护主题和订阅者</text></g><!--link SamgrLiteImpl to ServiceImpl--><g id="link_SamgrLiteImpl_ServiceImpl"><path codeline="66" d="M277.5,133.12 C277.5,156.87 277.5,178.51 277.5,203.73 " fill="none" id="SamgrLiteImpl-to-ServiceImpl" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="277.5,209.73,281.5,200.73,277.5,204.73,273.5,200.73,277.5,209.73" style="stroke:#000000;stroke-width:1.0;"></polygon><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="119" x="278.5" y="177.0698">services-&gt;data[x]</text></g><!--reverse link BroadcastService to ServiceImpl--><g id="link_BroadcastService_ServiceImpl"><path codeline="67" d="M167.11,287.5 C178.63,287.5 184.15,287.5 195.66,287.5 " fill="none" id="BroadcastService-backto-ServiceImpl" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="161.11,287.5,170.11,291.5,166.11,287.5,170.11,283.5,161.11,287.5" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link ServiceImpl to PubSubImplement--><g id="link_ServiceImpl_PubSubImplement"><path codeline="68" d="M359.32,287.5 C406.8,287.5 460.74,287.5 509.94,287.5 " fill="none" id="ServiceImpl-to-PubSubImplement" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="515.94,287.5,506.94,283.5,510.94,287.5,506.94,291.5,515.94,287.5" style="stroke:#000000;stroke-width:1.0;"></polygon><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="120" x="377.5" y="281.5698">features-&gt;data[x]</text></g><!--link BroadcastService to Service--><g id="link_BroadcastService_Service"><path codeline="69" d="M86.5,301.75 C86.5,327.15 86.5,365.86 86.5,407.93 " fill="none" id="BroadcastService-to-Service" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="none" points="86.5,425.93,92.5,407.93,80.5,407.93,86.5,425.93" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link PubSubImplement to PubSubInterface--><g id="link_PubSubImplement_PubSubInterface"><path codeline="70" d="M529.74,360.57 C498.84,388.84 478.1371,407.7761 453.0771,430.7161 " fill="none" id="PubSubImplement-to-PubSubInterface" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="none" points="439.8,442.87,457.1284,435.1418,449.0258,426.2904,439.8,442.87" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link PubSubImplement to FeatureImpl--><g id="link_PubSubImplement_FeatureImpl"><path codeline="71" d="M608.5,360.57 C608.5,388.84 608.5,401.93 608.5,424.87 " fill="none" id="PubSubImplement-to-FeatureImpl" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="none" points="608.5,442.87,614.5,424.87,602.5,424.87,608.5,442.87" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link PubSubInterface to IUnknown--><g id="link_PubSubInterface_IUnknown"><path codeline="72" d="M402.5,513.29 C402.5,536.14 402.5,548.33 402.5,572.75 " fill="none" id="PubSubInterface-to-IUnknown" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="none" points="402.5,590.75,408.5,572.75,396.5,572.75,402.5,590.75" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link PubSubImplement to PubSubFeature--><g id="link_PubSubImplement_PubSubFeature"><path codeline="73" d="M701.22,287.5 C716.63,287.5 726.03,287.5 741.43,287.5 " fill="none" id="PubSubImplement-to-PubSubFeature" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="747.43,287.5,738.43,283.5,742.43,287.5,738.43,291.5,747.43,287.5" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link PubSubFeature to Feature--><g id="link_PubSubFeature_Feature"><path codeline="74" d="M822.71,343.53 C824.23,369.5 824.9688,382.3407 826.4588,407.8107 " fill="none" id="PubSubFeature-to-Feature" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="none" points="827.51,425.78,832.4486,407.4603,820.469,408.1611,827.51,425.78" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link PubSubFeature to Relation--><g id="link_PubSubFeature_Relation"><path codeline="75" d="M891.52,287.5 C903.3,287.5 909.07,287.5 920.85,287.5 " fill="none" id="PubSubFeature-to-Relation" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="926.85,287.5,917.85,283.5,921.85,287.5,917.85,291.5,926.85,287.5" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--SRC=[VLJVJzH047xthwXly70XlXXp3oIWKIyvViY1ByIGRNTxjw7TRRPR1D4431Wr112Z8MfCH8p61D346904_nbw1_-5k-sstRtUsPUsyytCDpiptrxbBUGZA_009bSiyRGmH1Ro0xva-SYt4GiJSuEpoE5M0_XDLiSSrVp0MquG-InmsxEg1Pe3ViJHea36vBi6Stl80Oz20OnIoXl9Ju4Xje0T9D7xoE6K5KWBC0GdAPLaqo2Sbv-p3nByYL5ccg8ey0xYuy170uEvfKOmny33ZtJZ60f3q4Ht0O6URXVXakuc9IvkAhj1ECeeW0u8kS5ikDHco3oX3qbHrBq8iQKQuOYvmD7fHY2SGgvcc48U0Y7gnQm8pNce5bOpD0SWSa7ayP40L_E2Sf2hZXQzpI4NYH4n59P7ekXXrSA4NxkU0rZq5mbh9CmtSYiDH8g90370CILX-JYJaTs8R7aQiPQ45qS244xJ03jQLyB83Xs6RRrrFeNONHA32YCVCGs8I2_t8B8z7BOqYpgfMB2qbDlfVzzAi_4jbyjYKXBvJy79w88GcKGdrMU_x8hSs6En2qdpz4FtKHbJhb9AMLWn82ZwYuNCnIQept8PgW1pkueMwSr9SggLihgsgrVE_ubpWlIKvmHfS1eC35f3G_7gX_R1Ndnq4k-_RMzjdv-zxxmuQQzyrNoLc1Ftzk_dxTMZU7-ji_siN57M6wkeYL0e3pWpNQitvcxLv-grndGEEi3pRE3CoxvcgpOk0WeboKsLTrJoLeGfetw1MfNAi2vW4P5TVfLX23YONKmlDzsduY6NYxZkAySgUpBSR4dNBb49capF9aqfPQNoUDYuGxep9GvTIkZlg6sJxfG5fax6ufJIc4VIzy-m67ozu2nFBeihwTGvaiEpgDjDdU3ffgcjs_mIRtrEp8Z09BHV4hsE-EHlU-UWysuj_lCc_laqFlpOsVoH89tJN-sN- -V7A-V7t-EjZNZxrUNhiujFtmpbzgSotFHu8_dfvTvklBDnSRXtkRj-iR9k9Fq7]--></g></svg></p><h3 id="从轻量系统的拉起过程看服务注册与发现">从轻量系统的拉起过程看服务注册与发现 </h3>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token comment">//系统初始化</span>
<span class="token keyword keyword-void">void</span> <span class="token function">OHOS_SystemInit</span><span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">MODULE_INIT</span><span class="token punctuation">(</span>bsp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">MODULE_INIT</span><span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">MODULE_INIT</span><span class="token punctuation">(</span>core<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">SYS_INIT</span><span class="token punctuation">(</span>service<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//注册系统服务</span>
    <span class="token function">SYS_INIT</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//注册系统服务的特性</span>
    <span class="token function">MODULE_INIT</span><span class="token punctuation">(</span>run<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">SAMGR_Bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//启功samgr并管理系统服务和特性</span>
<span class="token punctuation">}</span>
</code></pre><p>SYS_INIT()负责初始化由SYS_SERVICE_INIT，SYS_FEATURE_INIT宏进行修饰的服务和特性</p>
<pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">LAYER_INITCALL</span><span class="token expression"><span class="token punctuation">(</span>func<span class="token punctuation">,</span> layer<span class="token punctuation">,</span> clayer<span class="token punctuation">,</span> <span class="token operator">&gt;</span>priority<span class="token punctuation">)</span>            </span><span class="token punctuation">\</span>
    <span class="token expression"><span class="token keyword keyword-static">static</span> <span class="token keyword keyword-const">const</span> InitCall USED_ATTR <span class="token operator">&gt;</span>__zinitcall_</span><span class="token punctuation">##</span><span class="token expression">layer</span><span class="token punctuation">##</span><span class="token expression">_</span><span class="token punctuation">##</span><span class="token expression">func </span><span class="token punctuation">\</span>
        <span class="token expression"><span class="token keyword keyword-__attribute__">__attribute__</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">section</span><span class="token punctuation">(</span></span><span class="token string">".zinitcall."</span> <span class="token expression">clayer <span class="token operator">&gt;</span>#priority </span><span class="token string">".init"</span><span class="token expression"><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> func</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">LAYER_INITCALL_DEF</span><span class="token expression"><span class="token punctuation">(</span>func<span class="token punctuation">,</span> layer<span class="token punctuation">,</span> clayer<span class="token punctuation">)</span> </span><span class="token punctuation">\</span>
    <span class="token expression"><span class="token function">LAYER_INITCALL</span><span class="token punctuation">(</span>func<span class="token punctuation">,</span> layer<span class="token punctuation">,</span> clayer<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">SYS_SERVICE_INIT</span><span class="token expression"><span class="token punctuation">(</span>func<span class="token punctuation">)</span> <span class="token function">LAYER_INITCALL_DEF</span><span class="token punctuation">(</span>func<span class="token punctuation">,</span> sys_service<span class="token punctuation">,</span> </span><span class="token string">"sys.service"</span><span class="token expression"><span class="token punctuation">)</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">SYS_FEATURE_INIT</span><span class="token expression"><span class="token punctuation">(</span>func<span class="token punctuation">)</span> <span class="token function">LAYER_INITCALL_DEF</span><span class="token punctuation">(</span>func<span class="token punctuation">,</span> sys_feature<span class="token punctuation">,</span> </span><span class="token string">"sys.feature"</span><span class="token expression"><span class="token punctuation">)</span></span></span>

</code></pre><pre data-role="codeBlock" data-info="c" class="language-c c"><code><span class="token keyword keyword-static">static</span> <span class="token keyword keyword-void">void</span> <span class="token function">Init</span><span class="token punctuation">(</span><span class="token keyword keyword-void">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    PubSubFeature <span class="token operator">*</span>feature <span class="token operator">=</span> <span class="token operator">&amp;</span>g_broadcastFeature<span class="token punctuation">;</span>
    feature<span class="token operator">-&gt;</span>relations<span class="token punctuation">.</span>topic <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    feature<span class="token operator">-&gt;</span>relations<span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span>consumer <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token function">UtilsListInit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>feature<span class="token operator">-&gt;</span>relations<span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">UtilsListInit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>feature<span class="token operator">-&gt;</span>relations<span class="token punctuation">.</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
    feature<span class="token operator">-&gt;</span>mutex <span class="token operator">=</span> <span class="token function">MUTEX_InitValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">SAMGR_GetInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">RegisterFeature</span><span class="token punctuation">(</span>BROADCAST_SERVICE<span class="token punctuation">,</span> <span class="token punctuation">(</span>Feature <span class="token operator">*</span><span class="token punctuation">)</span>feature<span class="token punctuation">)</span><span class="token punctuation">;</span>

    PubSubImplement <span class="token operator">*</span>apiEntry <span class="token operator">=</span> <span class="token function">BCE_CreateInstance</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Feature <span class="token operator">*</span><span class="token punctuation">)</span>feature<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">SAMGR_GetInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">RegisterFeatureApi</span><span class="token punctuation">(</span>BROADCAST_SERVICE<span class="token punctuation">,</span> PUB_SUB_FEATURE<span class="token punctuation">,</span> <span class="token function">GET_IUNKNOWN</span><span class="token punctuation">(</span><span class="token operator">*</span>apiEntry<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">SYS_FEATURE_INIT</span><span class="token punctuation">(</span>Init<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><p>其实现与Linux的initcall相似</p>
<blockquote>
<p>Linux内核使用了一个称为initcall的机制，该机制允许在内核启动时以特定的顺序执行初始化函数。initcall背后的基本思想是将一系列的初始化函数地址存储在特定的内存区段，然后在内核启动时按顺序执行这些函数。<br>
这个机制依赖GCC的特性，特别是__attribute__((section(...))),__attribute__((section(...)))将函数地址在链接时放入zInit代码段，而后由其它函数遍历这些段内的函数</p>
</blockquote>
<h4 id="boot_sys阶段">BOOT_SYS阶段 </h4>
<p class="plantuml"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="1376px" preserveAspectRatio="none" style="width:479px;height:1376px;background:#FFFFFF;" version="1.1" viewBox="0 0 479 1376" width="479px" zoomAndPan="magnify"><defs></defs><g><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="142" x="168.5" y="6"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="122" x="178.5" y="28.0645">OHOS_SystemInit()</text><rect fill="#FFFFFF" height="559.2852" style="stroke:#000000;stroke-width:1.0;" width="437" x="21" y="50.584"></rect><path d="M115,50.584 L115,60.5986 L105,70.5986 L21,70.5986 " fill="none" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="84" x="24" y="65.6592">注册系统服务</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="377" x="51" y="87.5986"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="357" x="61" y="109.6631">SYS_INIT(service)遍历所有SYS_SERVICE_INIT宏修饰的Init()</text><rect fill="#FFFFFF" height="356.5186" style="stroke:#000000;stroke-width:1.0;" width="417" x="31" y="132.1826"></rect><path d="M140,132.1826 L140,142.1973 L130,152.1973 L31,152.1973 " fill="none" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="99" x="34" y="147.2578">注册Bootstrap</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="106" x="186.5" y="169.1973"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="86" x="196.5" y="191.2617">注册Bootstrap</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="330" x="74.5" y="223.7813"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="310" x="84.5" y="245.8457">调用SAMGR_GETInstance()获取单例对象g_samrImpl</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="130" x="174.5" y="278.3652"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="110" x="184.5" y="300.4297">g_samrImpl懒加载</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="275" x="102" y="332.9492"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="255" x="112" y="355.0137">调用g_samrImpl的RegisterService进行注册</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="354" x="62.5" y="387.5332"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="334" x="72.5" y="409.5977">为BootStrap(继承自Servcie)创建一个ServiceImpl进行管理</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="397" x="41" y="442.1172"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="377" x="51" y="464.1816">将该ServiceImpl VECTOR_Add()到g_samrImpl的services字段中</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="107" x="186" y="508.7012"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="87" x="196" y="530.7656">注册Broadcast</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="85" x="197" y="563.2852"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="65" x="207" y="585.3496">注册Hiview</text><rect fill="#FFFFFF" height="424.7012" style="stroke:#000000;stroke-width:1.0;" width="441" x="19" y="619.8691"></rect><path d="M155,619.8691 L155,629.8838 L145,639.8838 L19,639.8838 " fill="none" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="126" x="22" y="634.9443">注册系统服务的特性</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="374" x="52.5" y="656.8838"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="354" x="62.5" y="678.9482">SYS_INIT(feature)遍历所有SYS_Feature_INIT宏修饰的Init()</text><rect fill="#FFFFFF" height="331.1025" style="stroke:#000000;stroke-width:1.0;" width="421" x="29" y="701.4678"></rect><path d="M320,701.4678 L320,711.4824 L310,721.4824 L29,721.4824 " fill="none" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="281" x="32" y="716.543">注册Broadcast的特性PUB_SUB_FEAFURE</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="289" x="95" y="738.4824"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="269" x="105" y="760.5469">调用g_samrImpl的RegisterFeature()注册特性</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="301" x="89" y="793.0664"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="281" x="99" y="815.1309">为PUB_SUB_FEAFURE创建FeatureImpl进行管理</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="400" x="39.5" y="847.6504"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="380" x="49.5" y="869.7148">将该FeatureImpl VECTOR_Add()到serviceImpl的features字段中</text><rect fill="#FFFFFF" height="49.168" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="308" x="85.5" y="902.2344"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="203" x="95.5" y="924.2988">创建特性接口g_pubSubImplement</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="288" x="95.5" y="938.8828">关联g_pubSubImplement与PubSubFeature对象</text><rect fill="#FFFFFF" height="49.168" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="401" x="39" y="971.4023"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="252" x="49" y="993.4668">调用RegisterFeatureApi注册特性的默认接口</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="381" x="49" y="1008.0508">使serviceImpl-&gt;defaultApi指向g_pubSubImplement.iUnknown</text><rect fill="#FFFFFF" height="315.5332" style="stroke:#000000;stroke-width:1.0;" width="467" x="6" y="1054.5703"></rect><path d="M286,1054.5703 L286,1064.585 L276,1074.585 L6,1074.585 " fill="none" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="270" x="9" y="1069.6455">调用SAMGR_Bootstrap()启动服务和特性</text><rect fill="#FFFFFF" height="49.168" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="306" x="86.5" y="1091.585"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="286" x="96.5" y="1113.6494">samgr创建Vector initServices记录未初始化的服务</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="278" x="96.5" y="1128.2334">（根据serviceImpl的inited字段是否为SVC_INIT)</text><rect fill="#FFFFFF" height="207.3506" style="stroke:#000000;stroke-width:1.0;" width="447" x="16" y="1150.7529"></rect><path d="M350,1150.7529 L350,1160.7676 L340,1170.7676 L16,1170.7676 " fill="none" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="324" x="19" y="1165.8281">调用InitializeAllServices()初始化所有未初始化服务</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="290" x="94.5" y="1187.7676"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="270" x="104.5" y="1209.832">调用AddTaskPool()为服务创建任务池和消息队列</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="427" x="26" y="1242.3516"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="407" x="36" y="1264.416">调用InitializeSingleService()向消息队列发送MSG_DIRECT的初始化消息</text><rect fill="#FFFFFF" height="49.168" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="276" x="101.5" y="1296.9355"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="256" x="111.5" y="1319">调用SAMGR_StartTaskPool()启动各服务线程</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="156" x="111.5" y="1333.584">各服务循环监听各自消息队列</text><line style="stroke:#000000;stroke-width:1.0;" x1="239.5" x2="239.5" y1="203.7813" y2="223.7813"></line><polygon fill="#000000" points="235.5,213.7813,239.5,223.7813,243.5,213.7813,239.5,217.7813" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="239.5" x2="239.5" y1="258.3652" y2="278.3652"></line><polygon fill="#000000" points="235.5,268.3652,239.5,278.3652,243.5,268.3652,239.5,272.3652" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="239.5" x2="239.5" y1="312.9492" y2="332.9492"></line><polygon fill="#000000" points="235.5,322.9492,239.5,332.9492,243.5,322.9492,239.5,326.9492" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="239.5" x2="239.5" y1="367.5332" y2="387.5332"></line><polygon fill="#000000" points="235.5,377.5332,239.5,387.5332,243.5,377.5332,239.5,381.5332" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="239.5" x2="239.5" y1="422.1172" y2="442.1172"></line><polygon fill="#000000" points="235.5,432.1172,239.5,442.1172,243.5,432.1172,239.5,436.1172" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="239.5" x2="239.5" y1="122.1826" y2="169.1973"></line><polygon fill="#000000" points="235.5,159.1973,239.5,169.1973,243.5,159.1973,239.5,163.1973" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="239.5" x2="239.5" y1="476.7012" y2="508.7012"></line><polygon fill="#000000" points="235.5,498.7012,239.5,508.7012,243.5,498.7012,239.5,502.7012" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="239.5" x2="239.5" y1="543.2852" y2="563.2852"></line><polygon fill="#000000" points="235.5,553.2852,239.5,563.2852,243.5,553.2852,239.5,557.2852" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="239.5" x2="239.5" y1="40.584" y2="87.5986"></line><polygon fill="#000000" points="235.5,77.5986,239.5,87.5986,243.5,77.5986,239.5,81.5986" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="239.5" x2="239.5" y1="773.0664" y2="793.0664"></line><polygon fill="#000000" points="235.5,783.0664,239.5,793.0664,243.5,783.0664,239.5,787.0664" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="239.5" x2="239.5" y1="827.6504" y2="847.6504"></line><polygon fill="#000000" points="235.5,837.6504,239.5,847.6504,243.5,837.6504,239.5,841.6504" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="239.5" x2="239.5" y1="882.2344" y2="902.2344"></line><polygon fill="#000000" points="235.5,892.2344,239.5,902.2344,243.5,892.2344,239.5,896.2344" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="239.5" x2="239.5" y1="951.4023" y2="971.4023"></line><polygon fill="#000000" points="235.5,961.4023,239.5,971.4023,243.5,961.4023,239.5,965.4023" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="239.5" x2="239.5" y1="691.4678" y2="738.4824"></line><polygon fill="#000000" points="235.5,728.4824,239.5,738.4824,243.5,728.4824,239.5,732.4824" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="239.5" x2="239.5" y1="597.8691" y2="656.8838"></line><polygon fill="#000000" points="235.5,646.8838,239.5,656.8838,243.5,646.8838,239.5,650.8838" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="239.5" x2="239.5" y1="1222.3516" y2="1242.3516"></line><polygon fill="#000000" points="235.5,1232.3516,239.5,1242.3516,243.5,1232.3516,239.5,1236.3516" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="239.5" x2="239.5" y1="1276.9355" y2="1296.9355"></line><polygon fill="#000000" points="235.5,1286.9355,239.5,1296.9355,243.5,1286.9355,239.5,1290.9355" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="239.5" x2="239.5" y1="1140.7529" y2="1187.7676"></line><polygon fill="#000000" points="235.5,1177.7676,239.5,1187.7676,243.5,1177.7676,239.5,1181.7676" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="239.5" x2="239.5" y1="1020.5703" y2="1091.585"></line><polygon fill="#000000" points="235.5,1081.585,239.5,1091.585,243.5,1081.585,239.5,1085.585" style="stroke:#000000;stroke-width:1.0;"></polygon><!--SRC=[ZLHTJnf157tlhw1lyD3-04sQe4NbmMfO9EdJPeMHRbnsoUwYQUC3f2s2ycdyIhLHqbe9gO0nRT4jycTsPfUd_eNExepkyg4joIRaphtddhddp7sglW49u4aA72y-yU3VniBS0iCoRnKL988YhsxOqOcXgDStQSVZifHAUj1L7MOBnfLcQ2Vek0YtQgI8USsmmLV1i5S1yXeV1Rv-fWXBMPHFe-EyTSW4Gf7WTC1EWisotclspzh6fmyFjPYI95LHPIv9y8U297_2RBytTkkCVtusnCu6ma5HKJan2hm-i_GBblTXSK-_tOQjQ_Eo5cSLBY474qc1rZe1jBa3jqxDRdS0rJd7B4CWpkE1o0ovdTaxCci5meaMwPqRYnrZiVCQsZdAzypDXfKVvO4FvewWTgDtqdgdGJ4iP89ZD6j69KjnO3jhjivSEPv8O3gy46BziPWNuxG7UD5fA_3Y03L_w9qBWWB461dcmF1aYOj5EKMTT4Vd-3KUh8yhUqXmtDR8NwFq-P3oAu1JK_AeyZCa_l_At_6yRxIuDCKo-9i9-6UMGe5_gaGxUdsKl0tYw3G4HxIXDO-guiePLaLn1CD4w2Y6PPaWhGWVL3g3vIznDfbQPbBBLY5-dQ9g9yAFLsPcT-HCxvGMxGWbGfmzuDgX4VYJl7i6c5fVEpIRNqbpkr3lzbpadxs8WHKk9QXMPM4JLgeZB9xpI-AgAAsBuqmppaBkLth_Wl7KAYsuLIUUWZi5jwUmfd6P32i2egeaUtXi5lee5BFPXjqzTDo0kS_mV1iMzl6zNClep-ySEhr6nUQWA1O4Y159q64BLhvXBp2HQTkO0puaX2r_yfp0lmD-GRZhRObDcnA7kscu5oB1mFO8SyhgeYG9NXzkHszBje6cuV_eyXHV7ltCeKohVtW2SmS3UZea65wC2u3oiAPNTHV1ShMVpimpi-pBO0XR4z_NeMNdZLcPZCh9giEF208hT9R6JS-eRnC_tiNWRSCejOoZAgnynq6yuKQPFs28lm00]--></g></svg></p><h4 id="initializesingleservice启动特性">InitializeSingleService启动特性 </h4>
<p class="plantuml"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="240px" preserveAspectRatio="none" style="width:833px;height:240px;background:#FFFFFF;" version="1.1" viewBox="0 0 833 240" width="833px" zoomAndPan="magnify"><defs></defs><g><rect fill="#FFFFFF" height="57.7993" style="stroke:#000000;stroke-width:1.0;" width="10" x="549" y="128.4126"></rect><rect fill="#FFFFFF" height="14" style="stroke:#000000;stroke-width:1.0;" width="10" x="753" y="158.2119"></rect><line style="stroke:#000000;stroke-width:1.0;" x1="50" x2="50" y1="37.0146" y2="204.2119"></line><line style="stroke:#000000;stroke-width:1.0;" x1="337" x2="337" y1="37.0146" y2="204.2119"></line><line style="stroke:#000000;stroke-width:1.0;" x1="553.5" x2="553.5" y1="37.0146" y2="204.2119"></line><line style="stroke:#000000;stroke-width:1.0;" x1="758" x2="758" y1="37.0146" y2="204.2119"></line><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="60" x="20" y="5"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="46" x="27" y="26.0752">Samgr</text><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="60" x="20" y="203.2119"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="46" x="27" y="224.2871">Samgr</text><path d="M304,10 L370,10 C375,10 375,23.5073 375,23.5073 C375,23.5073 375,37.0146 370,37.0146 L304,37.0146 C299,37.0146 299,23.5073 299,23.5073 C299,23.5073 299,10 304,10 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M370,10 C365,10 365,23.5073 365,23.5073 C365,37.0146 370,37.0146 370,37.0146 " fill="none" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="56" x="304" y="29.0752">MQueue</text><path d="M304,203.2119 L370,203.2119 C375,203.2119 375,216.7192 375,216.7192 C375,216.7192 375,230.2266 370,230.2266 L304,230.2266 C299,230.2266 299,216.7192 299,216.7192 C299,216.7192 299,203.2119 304,203.2119 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M370,203.2119 C365,203.2119 365,216.7192 365,216.7192 C365,230.2266 370,230.2266 370,230.2266 " fill="none" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="56" x="304" y="222.2871">MQueue</text><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="85" x="511.5" y="5"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="71" x="518.5" y="26.0752">Broadcast</text><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="85" x="511.5" y="203.2119"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="71" x="518.5" y="224.2871">Broadcast</text><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="138" x="689" y="5"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="124" x="696" y="26.0752">BroadcastFeature</text><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="138" x="689" y="203.2119"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="124" x="696" y="224.2871">BroadcastFeature</text><rect fill="#FFFFFF" height="57.7993" style="stroke:#000000;stroke-width:1.0;" width="10" x="549" y="128.4126"></rect><rect fill="#FFFFFF" height="14" style="stroke:#000000;stroke-width:1.0;" width="10" x="753" y="158.2119"></rect><polygon fill="#000000" points="325,80.6133,335,84.6133,325,88.6133,329,84.6133" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="50" x2="331" y1="84.6133" y2="84.6133"></line><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="154" x="57" y="64.0845">发送type为MSG_DIRECT</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="263" x="57" y="79.8838">且handle为HandleInitRequest()的request</text><polygon fill="#000000" points="61,94.6133,51,98.6133,61,102.6133,57,98.6133" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="55" x2="336" y1="98.6133" y2="98.6133"></line><polygon fill="#000000" points="537,124.4126,547,128.4126,537,132.4126,541,128.4126" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="337" x2="543" y1="128.4126" y2="128.4126"></line><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="193" x="344" y="123.6831">循环监听消息队列，获取request</text><polygon fill="#000000" points="741,154.2119,751,158.2119,741,162.2119,745,158.2119" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="559" x2="747" y1="158.2119" y2="158.2119"></line><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="175" x="566" y="153.4824">调用OnInitialize()进行初始化</text><polygon fill="#000000" points="570,168.2119,560,172.2119,570,176.2119,566,172.2119" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="564" x2="757" y1="172.2119" y2="172.2119"></line><polygon fill="#000000" points="348,182.2119,338,186.2119,348,190.2119,344,186.2119" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="342" x2="553" y1="186.2119" y2="186.2119"></line><!--SRC=[Kop9ICrDLIZ8ISpCur80We34efBCvCo2nBmIXU34tFGYi6XWQMffge8lc08BWAKKTEsWOWfM2a_x9xviQ2ofB4XzicENRx1xl8jdaAjpI4pUanrJCXBpKd90uXvWXcTUPabGQc5fQd69XkRpMIr543ROOAXvka2Z4TR31EqKd8ho4rEI4ujBG3RkM_MyR_tpsHEVJbZpR5l7iyRrBsVCVzen_VsUdXTzsv_sJqCsDp6v9BCiiIGLOG9O664Uik5kgOabfKKWNxtOqFnyoWh_F92JCnDpCgjIDJHVx9_zOc7FquwvJvTtF-sPXiDug1ceji0CraNp2bXLIYgHfe2r8qK6Deq0]--></g></svg></p><h4 id="boot_app阶段">BOOT_APP阶段 </h4>
<p>所有由SYS_SERVICE_INIT()和SYS_FEATURE_INIT()修饰的服务与特性启动完毕,接下来启动由SYSEX_SERVICE_INIT,SYSEX_FEATURE_INIT,APP_SERVICE_INIT,APP_FEATURE_INIT修饰的服务与特性</p>
<p class="plantuml"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="258px" preserveAspectRatio="none" style="width:920px;height:258px;background:#FFFFFF;" version="1.1" viewBox="0 0 920 258" width="920px" zoomAndPan="magnify"><defs></defs><g><rect fill="#FFFFFF" height="66.7993" style="stroke:#000000;stroke-width:1.0;" width="10" x="534" y="129.6279"></rect><rect fill="#FFFFFF" height="37" style="stroke:#000000;stroke-width:1.0;" width="10" x="758" y="159.4272"></rect><line style="stroke:#000000;stroke-width:1.0;" x1="50" x2="50" y1="54.0293" y2="205.4272"></line><line style="stroke:#000000;stroke-width:1.0;" x1="322" x2="322" y1="54.0293" y2="205.4272"></line><line style="stroke:#000000;stroke-width:1.0;" x1="538.5" x2="538.5" y1="54.0293" y2="205.4272"></line><line style="stroke:#000000;stroke-width:1.0;" x1="762.5" x2="762.5" y1="54.0293" y2="205.4272"></line><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="60" x="20" y="22.0146"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="46" x="27" y="43.0898">Samgr</text><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="60" x="20" y="204.4272"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="46" x="27" y="225.5024">Samgr</text><path d="M289,27.0146 L355,27.0146 C360,27.0146 360,40.522 360,40.522 C360,40.522 360,54.0293 355,54.0293 L289,54.0293 C284,54.0293 284,40.522 284,40.522 C284,40.522 284,27.0146 289,27.0146 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M355,27.0146 C350,27.0146 350,40.522 350,40.522 C350,54.0293 355,54.0293 355,54.0293 " fill="none" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="56" x="289" y="46.0898">MQueue</text><path d="M289,204.4272 L355,204.4272 C360,204.4272 360,217.9346 360,217.9346 C360,217.9346 360,231.4419 355,231.4419 L289,231.4419 C284,231.4419 284,217.9346 284,217.9346 C284,217.9346 284,204.4272 289,204.4272 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M355,204.4272 C350,204.4272 350,217.9346 350,217.9346 C350,231.4419 355,231.4419 355,231.4419 " fill="none" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="56" x="289" y="223.5024">MQueue</text><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="85" x="496.5" y="22.0146"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="71" x="503.5" y="43.0898">Bootstrap</text><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="85" x="496.5" y="204.4272"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="71" x="503.5" y="225.5024">Bootstrap</text><rect fill="#FFFFFF" height="48.0293" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="303" x="611.5" y="5"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="289" x="618.5" y="26.0752">由SYSEX\APP_SERVICE\FEATURE_INIT宏</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="112" x="707" y="43.0898">修饰的服务与特性</text><rect fill="#FFFFFF" height="48.0293" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="303" x="611.5" y="204.4272"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="289" x="618.5" y="225.5024">由SYSEX\APP_SERVICE\FEATURE_INIT宏</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="112" x="707" y="242.5171">修饰的服务与特性</text><rect fill="#FFFFFF" height="66.7993" style="stroke:#000000;stroke-width:1.0;" width="10" x="534" y="129.6279"></rect><rect fill="#FFFFFF" height="37" style="stroke:#000000;stroke-width:1.0;" width="10" x="758" y="159.4272"></rect><polygon fill="#000000" points="310,81.8286,320,85.8286,310,89.8286,314,85.8286" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="50" x2="316" y1="85.8286" y2="85.8286"></line><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="248" x="57" y="81.0991">发送BOOT_SYS_COMPLETED的request</text><polygon fill="#000000" points="61,95.8286,51,99.8286,61,103.8286,57,99.8286" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="55" x2="321" y1="99.8286" y2="99.8286"></line><polygon fill="#000000" points="522,125.6279,532,129.6279,522,133.6279,526,129.6279" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="322" x2="528" y1="129.6279" y2="129.6279"></line><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="193" x="329" y="124.8984">循环监听消息队列，获取request</text><polygon fill="#000000" points="746,155.4272,756,159.4272,746,163.4272,750,159.4272" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="544" x2="752" y1="159.4272" y2="159.4272"></line><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="113" x="551" y="154.6978">INIT_APP_CALL()</text><polygon fill="#000000" points="555,169.4272,545,173.4272,555,177.4272,551,173.4272" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="549" x2="757" y1="173.4272" y2="173.4272"></line><polygon fill="#000000" points="333,183.4272,323,187.4272,333,191.4272,329,187.4272" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="327" x2="533" y1="187.4272" y2="187.4272"></line><!--SRC=[Kop9ICrDLIZ8ISpCur80We34efBCvCo2nBmIXU34tFGYi6XWQMffge8lc08BWAKKTEsWOWfM2a_x9xviQ7Jozm-93uuCZdVszmtmSGrnTNa-gwKejR0qjRW4h16gNXUe5M4yJD1EmIa_lwIuf2Yn06JYlbNF-zO_dptnwOGrpxPrF6jS_tB6_ASTqz_lwNdHj_rf_pHaSnEJIpBB4ajI4IQ0XH7c0GrNUZvb8z1jhX4nZW41yS6kGM6UpgunRgwE8Q51hl6UVfuXJzVrn-GzsR_kvT8DG7S_czFxj6lXanrzppjtFcjOhWHq4qXHF4YtiwEFZuOcgjMKcWysZM97wY878teWm6CC0000]--></g></svg></p><h4 id="boot_dynamic阶段">BOOT_DYNAMIC阶段 </h4>
<p>所有由SYSEX_SERVICE_INIT,SYSEX_FEATURE_INIT,APP_SERVICE_INIT,APP_FEATURE_INIT修饰的服务与特性启动完毕</p>
<h3 id="消息队列">消息队列 </h3>
<p class="plantuml"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="921px" preserveAspectRatio="none" style="width:1776px;height:921px;background:#FFFFFF;" version="1.1" viewBox="0 0 1776 921" width="1776px" zoomAndPan="magnify"><defs></defs><g><!--class TaskPool--><g id="elem_TaskPool"><rect codeline="3" fill="#FFFFFF" height="265.1904" id="TaskPool" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="230" x="901.5" y="25.5"></rect><ellipse cx="981.75" cy="39.5" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M976.8594,41.5469 L979.25,41.3125 Q979.4688,42.5156 980.125,43.0781 Q980.7969,43.6406 981.9063,43.6406 Q983.0938,43.6406 983.6875,43.1406 Q984.2969,42.6406 984.2969,41.9688 Q984.2969,41.5313 984.0469,41.2344 Q983.7969,40.9219 983.1719,40.7031 Q982.7344,40.5469 981.2031,40.1719 Q979.2188,39.6875 978.4219,38.9688 Q977.2969,37.9688 977.2969,36.5156 Q977.2969,35.5938 977.8281,34.7813 Q978.3594,33.9688 979.3438,33.5469 Q980.3438,33.125 981.75,33.125 Q984.0313,33.125 985.1875,34.125 Q986.3594,35.125 986.4063,36.8125 L983.9531,36.9219 Q983.7969,35.9844 983.2813,35.5781 Q982.7656,35.1563 981.7188,35.1563 Q980.6563,35.1563 980.0469,35.5938 Q979.6563,35.875 979.6563,36.3594 Q979.6563,36.7813 980.0156,37.0938 Q980.4844,37.4844 982.2656,37.9063 Q984.0625,38.3281 984.9219,38.7813 Q985.7813,39.2344 986.2656,40.0156 Q986.7656,40.7969 986.7656,41.9531 Q986.7656,43 986.1719,43.9219 Q985.5938,44.8281 984.5313,45.2813 Q983.4688,45.7188 981.8906,45.7188 Q979.5781,45.7188 978.3438,44.6563 Q977.1094,43.5781 976.8594,41.5469 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="62" x="999.25" y="45.0679">TaskPool</text><line style="stroke:#000000;stroke-width:1.0;" x1="902.5" x2="1130.5" y1="53.5" y2="53.5"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="143" x="907.5" y="71.5752">queueId : MQueueId</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="127" x="907.5" y="88.5898">stackSize : uint16</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="102" x="907.5" y="105.6045">priority : uint8</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="79" x="907.5" y="122.6191">size : uint8</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="76" x="907.5" y="139.6338">top : uint8</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="62" x="907.5" y="156.6484">ref : int8</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="117" x="907.5" y="173.6631">tasks : ThreadId</text><line style="stroke:#000000;stroke-width:1.0;" x1="902.5" x2="1130.5" y1="180.6025" y2="180.6025"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="218" x="907.5" y="198.6777">SAMGR_CreateFixedTaskPool()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="171" x="907.5" y="215.6924">SAMGR_StartTaskPool()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="83" x="907.5" y="232.707">TaskEntry()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="111" x="907.5" y="249.7217">ProcResponse()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="141" x="907.5" y="266.7363">ProcDirectRequest()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="100" x="907.5" y="283.751">ProcRequest()</text></g><!--class Exchange--><g id="elem_Exchange"><rect codeline="19" fill="#FFFFFF" height="138.0879" id="Exchange" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="162" x="935.5" y="420.5"></rect><ellipse cx="978.75" cy="434.5" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M973.8594,436.5469 L976.25,436.3125 Q976.4688,437.5156 977.125,438.0781 Q977.7969,438.6406 978.9063,438.6406 Q980.0938,438.6406 980.6875,438.1406 Q981.2969,437.6406 981.2969,436.9688 Q981.2969,436.5313 981.0469,436.2344 Q980.7969,435.9219 980.1719,435.7031 Q979.7344,435.5469 978.2031,435.1719 Q976.2188,434.6875 975.4219,433.9688 Q974.2969,432.9688 974.2969,431.5156 Q974.2969,430.5938 974.8281,429.7813 Q975.3594,428.9688 976.3438,428.5469 Q977.3438,428.125 978.75,428.125 Q981.0313,428.125 982.1875,429.125 Q983.3594,430.125 983.4063,431.8125 L980.9531,431.9219 Q980.7969,430.9844 980.2813,430.5781 Q979.7656,430.1563 978.7188,430.1563 Q977.6563,430.1563 977.0469,430.5938 Q976.6563,430.875 976.6563,431.3594 Q976.6563,431.7813 977.0156,432.0938 Q977.4844,432.4844 979.2656,432.9063 Q981.0625,433.3281 981.9219,433.7813 Q982.7813,434.2344 983.2656,435.0156 Q983.7656,435.7969 983.7656,436.9531 Q983.7656,438 983.1719,438.9219 Q982.5938,439.8281 981.5313,440.2813 Q980.4688,440.7188 978.8906,440.7188 Q976.5781,440.7188 975.3438,439.6563 Q974.1094,438.5781 973.8594,436.5469 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="68" x="996.25" y="440.0679">Exchange</text><line style="stroke:#000000;stroke-width:1.0;" x1="936.5" x2="1096.5" y1="448.5" y2="448.5"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="82" x="941.5" y="466.5752">id : Identity</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="128" x="941.5" y="483.5898">request : Request</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="150" x="941.5" y="500.6045">response : Response</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="85" x="941.5" y="517.6191">type : short</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="121" x="941.5" y="534.6338">handler : Handler</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="132" x="941.5" y="551.6484">sharedRef : uint32</text></g><!--class ExchangeType--><g id="elem_ExchangeType"><rect codeline="28" fill="#FFFFFF" height="138.0879" id="ExchangeType" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="610" x="598.5" y="658"></rect><ellipse cx="848.75" cy="672" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M844.4844,678 L844.4844,665.8281 L853.5156,665.8281 L853.5156,667.8906 L846.9375,667.8906 L846.9375,670.5938 L853.0469,670.5938 L853.0469,672.6406 L846.9375,672.6406 L846.9375,675.9531 L853.75,675.9531 L853.75,678 L844.4844,678 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="102" x="866.25" y="677.5679">ExchangeType</text><line style="stroke:#000000;stroke-width:1.0;" x1="599.5" x2="1207.5" y1="686" y2="686"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="203" x="604.5" y="704.0752">MSG_EXIT //终止消息处理任务</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="598" x="604.5" y="721.0898">MSG_NON //不需要响应的请求消息，接收者调用服务的MessageHandle或特性的OnMessage</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="589" x="604.5" y="738.1045">MSG_CON  //需要响应的请求消息，接收者调用服务的MessageHandle或特性的OnMessage</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="144" x="604.5" y="755.1191">MSG_ACK //响应消息</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="153" x="604.5" y="772.1338">MSG_SYNC //同步消息</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="435" x="604.5" y="789.1484">MSG_DIRECT  //直接请求消息，无需响应，消息接收者调用handler</text></g><!--class Identity--><g id="elem_Identity"><rect codeline="37" fill="#FFFFFF" height="87.0439" id="Identity" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="155" x="12" y="683.5"></rect><ellipse cx="58.75" cy="697.5" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M53.8594,699.5469 L56.25,699.3125 Q56.4688,700.5156 57.125,701.0781 Q57.7969,701.6406 58.9063,701.6406 Q60.0938,701.6406 60.6875,701.1406 Q61.2969,700.6406 61.2969,699.9688 Q61.2969,699.5313 61.0469,699.2344 Q60.7969,698.9219 60.1719,698.7031 Q59.7344,698.5469 58.2031,698.1719 Q56.2188,697.6875 55.4219,696.9688 Q54.2969,695.9688 54.2969,694.5156 Q54.2969,693.5938 54.8281,692.7813 Q55.3594,691.9688 56.3438,691.5469 Q57.3438,691.125 58.75,691.125 Q61.0313,691.125 62.1875,692.125 Q63.3594,693.125 63.4063,694.8125 L60.9531,694.9219 Q60.7969,693.9844 60.2813,693.5781 Q59.7656,693.1563 58.7188,693.1563 Q57.6563,693.1563 57.0469,693.5938 Q56.6563,693.875 56.6563,694.3594 Q56.6563,694.7813 57.0156,695.0938 Q57.4844,695.4844 59.2656,695.9063 Q61.0625,696.3281 61.9219,696.7813 Q62.7813,697.2344 63.2656,698.0156 Q63.7656,698.7969 63.7656,699.9531 Q63.7656,701 63.1719,701.9219 Q62.5938,702.8281 61.5313,703.2813 Q60.4688,703.7188 58.8906,703.7188 Q56.5781,703.7188 55.3438,702.6563 Q54.1094,701.5781 53.8594,699.5469 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="54" x="76.25" y="703.0679">Identity</text><line style="stroke:#000000;stroke-width:1.0;" x1="13" x2="166" y1="711.5" y2="711.5"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="114" x="18" y="729.5752">serviceId : int16</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="116" x="18" y="746.5898">featureId : int16</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="143" x="18" y="763.6045">queueId : MQueueId</text></g><!--class Request--><g id="elem_Request"><rect codeline="43" fill="#FFFFFF" height="104.0586" id="Request" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="141" x="1244" y="675"></rect><ellipse cx="1281.75" cy="689" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M1276.8594,691.0469 L1279.25,690.8125 Q1279.4688,692.0156 1280.125,692.5781 Q1280.7969,693.1406 1281.9063,693.1406 Q1283.0938,693.1406 1283.6875,692.6406 Q1284.2969,692.1406 1284.2969,691.4688 Q1284.2969,691.0313 1284.0469,690.7344 Q1283.7969,690.4219 1283.1719,690.2031 Q1282.7344,690.0469 1281.2031,689.6719 Q1279.2188,689.1875 1278.4219,688.4688 Q1277.2969,687.4688 1277.2969,686.0156 Q1277.2969,685.0938 1277.8281,684.2813 Q1278.3594,683.4688 1279.3438,683.0469 Q1280.3438,682.625 1281.75,682.625 Q1284.0313,682.625 1285.1875,683.625 Q1286.3594,684.625 1286.4063,686.3125 L1283.9531,686.4219 Q1283.7969,685.4844 1283.2813,685.0781 Q1282.7656,684.6563 1281.7188,684.6563 Q1280.6563,684.6563 1280.0469,685.0938 Q1279.6563,685.375 1279.6563,685.8594 Q1279.6563,686.2813 1280.0156,686.5938 Q1280.4844,686.9844 1282.2656,687.4063 Q1284.0625,687.8281 1284.9219,688.2813 Q1285.7813,688.7344 1286.2656,689.5156 Q1286.7656,690.2969 1286.7656,691.4531 Q1286.7656,692.5 1286.1719,693.4219 Q1285.5938,694.3281 1284.5313,694.7813 Q1283.4688,695.2188 1281.8906,695.2188 Q1279.5781,695.2188 1278.3438,694.1563 Q1277.1094,693.0781 1276.8594,691.0469 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="58" x="1299.25" y="694.5679">Request</text><line style="stroke:#000000;stroke-width:1.0;" x1="1245" x2="1384" y1="703" y2="703"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="96" x="1250" y="721.0752">msgId : int16</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="72" x="1250" y="738.0898">len : int16</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="90" x="1250" y="755.1045">data : void *</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="129" x="1250" y="772.1191">msgValue : uint32</text></g><!--class Response--><g id="elem_Response"><rect codeline="50" fill="#FFFFFF" height="70.0293" id="Response" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="102" x="1485.5" y="692"></rect><ellipse cx="1500.75" cy="706" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M1495.8594,708.0469 L1498.25,707.8125 Q1498.4688,709.0156 1499.125,709.5781 Q1499.7969,710.1406 1500.9063,710.1406 Q1502.0938,710.1406 1502.6875,709.6406 Q1503.2969,709.1406 1503.2969,708.4688 Q1503.2969,708.0313 1503.0469,707.7344 Q1502.7969,707.4219 1502.1719,707.2031 Q1501.7344,707.0469 1500.2031,706.6719 Q1498.2188,706.1875 1497.4219,705.4688 Q1496.2969,704.4688 1496.2969,703.0156 Q1496.2969,702.0938 1496.8281,701.2813 Q1497.3594,700.4688 1498.3438,700.0469 Q1499.3438,699.625 1500.75,699.625 Q1503.0313,699.625 1504.1875,700.625 Q1505.3594,701.625 1505.4063,703.3125 L1502.9531,703.4219 Q1502.7969,702.4844 1502.2813,702.0781 Q1501.7656,701.6563 1500.7188,701.6563 Q1499.6563,701.6563 1499.0469,702.0938 Q1498.6563,702.375 1498.6563,702.8594 Q1498.6563,703.2813 1499.0156,703.5938 Q1499.4844,703.9844 1501.2656,704.4063 Q1503.0625,704.8281 1503.9219,705.2813 Q1504.7813,705.7344 1505.2656,706.5156 Q1505.7656,707.2969 1505.7656,708.4531 Q1505.7656,709.5 1505.1719,710.4219 Q1504.5938,711.3281 1503.5313,711.7813 Q1502.4688,712.2188 1500.8906,712.2188 Q1498.5781,712.2188 1497.3438,711.1563 Q1496.1094,710.0781 1495.8594,708.0469 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="69" x="1513.25" y="711.5679">Response</text><line style="stroke:#000000;stroke-width:1.0;" x1="1486.5" x2="1586.5" y1="720" y2="720"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="90" x="1491.5" y="738.0752">data : void *</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="72" x="1491.5" y="755.0898">len : int16</text></g><path d="M242.5,11 L242.5,36.7993 A0,0 0 0 0 242.5,36.7993 L471.5,36.7993 A0,0 0 0 0 471.5,36.7993 L471.5,29 L905.5,193.1099 L471.5,21 L471.5,21 L461.5,11 L242.5,11 A0,0 0 0 0 242.5,11 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M461.5,11 L461.5,21 L471.5,21 L461.5,11 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="208" x="248.5" y="29.0698">为每一个服务创建消息队列和任务池</text><path d="M242.5,46.7993 L242.5,88.3979 A0,0 0 0 0 242.5,88.3979 L866.5,88.3979 A0,0 0 0 0 866.5,88.3979 L866.5,71.5986 L905.5,210.1245 L866.5,63.5986 L866.5,56.7993 L856.5,46.7993 L242.5,46.7993 A0,0 0 0 0 242.5,46.7993 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M856.5,46.7993 L856.5,56.7993 L866.5,56.7993 L856.5,46.7993 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="499" x="248.5" y="64.8691">创建并运行监控线程,通过以下代码塞一个TaskEntry()，线程启动后运行TaskEntry()</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="603" x="248.5" y="80.6685">register ThreadId threadId = (ThreadId)THREAD_Create(TaskEntry, pool-&gt;queueId, &amp;attr);</text><path d="M242.5,98.3979 L242.5,139.9966 A0,0 0 0 0 242.5,139.9966 L684.5,139.9966 A0,0 0 0 0 684.5,139.9966 L684.5,123.1973 L905.5,227.1392 L684.5,115.1973 L684.5,108.3979 L674.5,98.3979 L242.5,98.3979 A0,0 0 0 0 242.5,98.3979 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M674.5,98.3979 L674.5,108.3979 L684.5,108.3979 L674.5,98.3979 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="104" x="248.5" y="116.4678">循环监听消息队列</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="421" x="248.5" y="132.2671">调用ProcResponse,ProcDirectRequest,ProcRequest等进行消息处理</text><path d="M242.5,149.9966 L242.5,191.5952 A0,0 0 0 0 242.5,191.5952 L491.5,191.5952 A0,0 0 0 0 491.5,191.5952 L491.5,174.7959 L905.5,244.1538 L491.5,166.7959 L491.5,159.9966 L481.5,149.9966 L242.5,149.9966 A0,0 0 0 0 242.5,149.9966 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M481.5,149.9966 L481.5,159.9966 L491.5,159.9966 L481.5,149.9966 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="141" x="248.5" y="168.0664">处理MSG_ACK响应消息</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="228" x="248.5" y="183.8657">调用Exchange的handler函数处理消息</text><path d="M242.5,201.5952 L242.5,243.1938 A0,0 0 0 0 242.5,243.1938 L491.5,243.1938 A0,0 0 0 0 491.5,243.1938 L491.5,226.3945 L905.5,261.1685 L491.5,218.3945 L491.5,211.5952 L481.5,201.5952 L242.5,201.5952 A0,0 0 0 0 242.5,201.5952 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M481.5,201.5952 L481.5,211.5952 L491.5,211.5952 L481.5,201.5952 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="163" x="248.5" y="219.665">处理MSG_DIRECT响应消息</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="228" x="248.5" y="235.4644">调用Exchange的handler函数处理消息</text><path d="M242.5,253.1938 L242.5,294.7925 A0,0 0 0 0 242.5,294.7925 L558.5,294.7925 A0,0 0 0 0 558.5,294.7925 L558.5,277.9932 L905.5,278.1831 L558.5,269.9932 L558.5,263.1938 L548.5,253.1938 L242.5,253.1938 A0,0 0 0 0 242.5,253.1938 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M548.5,253.1938 L548.5,263.1938 L558.5,263.1938 L548.5,253.1938 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="214" x="248.5" y="271.2637">处理MSG_NON/MSG_CON响应消息</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="295" x="248.5" y="287.063">调用服务或特性的MessageHandle()函数处理消息</text><path d="M554.5,382 L554.5,407.7993 A0,0 0 0 0 554.5,407.7993 L705.5,407.7993 A0,0 0 0 0 705.5,407.7993 L705.5,400 L939.5,461.0073 L705.5,392 L705.5,392 L695.5,382 L554.5,382 A0,0 0 0 0 554.5,382 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M695.5,382 L695.5,392 L705.5,392 L695.5,382 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="130" x="560.5" y="400.0698">消息接收者的身份信息</text><path d="M554.5,417.7993 L554.5,443.5986 A0,0 0 0 0 554.5,443.5986 L666.5,443.5986 A0,0 0 0 0 666.5,443.5986 L666.5,435.7993 L939.5,478.022 L666.5,427.7993 L666.5,427.7993 L656.5,417.7993 L554.5,417.7993 A0,0 0 0 0 554.5,417.7993 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M656.5,417.7993 L656.5,427.7993 L666.5,427.7993 L656.5,417.7993 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="91" x="560.5" y="435.8691">请求消息的主题</text><path d="M554.5,453.5986 L554.5,479.3979 A0,0 0 0 0 554.5,479.3979 L666.5,479.3979 A0,0 0 0 0 666.5,479.3979 L666.5,471.5986 L939.5,495.0366 L666.5,463.5986 L666.5,463.5986 L656.5,453.5986 L554.5,453.5986 A0,0 0 0 0 554.5,453.5986 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M656.5,453.5986 L656.5,463.5986 L666.5,463.5986 L656.5,453.5986 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="91" x="560.5" y="471.6685">响应消息的主题</text><path d="M554.5,489.3979 L554.5,515.1973 A0,0 0 0 0 554.5,515.1973 L640.5,515.1973 A0,0 0 0 0 640.5,515.1973 L640.5,507.3979 L939.5,512.0513 L640.5,499.3979 L640.5,499.3979 L630.5,489.3979 L554.5,489.3979 A0,0 0 0 0 554.5,489.3979 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M630.5,489.3979 L630.5,499.3979 L640.5,499.3979 L630.5,489.3979 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="65" x="560.5" y="507.4678">消息的类型</text><path d="M554.5,525.1973 L554.5,550.9966 A0,0 0 0 0 554.5,550.9966 L900.5,550.9966 A0,0 0 0 0 900.5,550.9966 L900.5,543.1973 L939.5,529.0659 L900.5,535.1973 L900.5,535.1973 L890.5,525.1973 L554.5,525.1973 A0,0 0 0 0 554.5,525.1973 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M890.5,525.1973 L890.5,535.1973 L900.5,535.1973 L890.5,525.1973 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="325" x="560.5" y="543.2671">请求消息的消息处理函数或响应消息的异步响应回调函数</text><path d="M554.5,560.9966 L554.5,586.7959 A0,0 0 0 0 554.5,586.7959 L896.5,586.7959 A0,0 0 0 0 896.5,586.7959 L896.5,578.9966 L939.5,546.0806 L896.5,570.9966 L896.5,570.9966 L886.5,560.9966 L554.5,560.9966 A0,0 0 0 0 554.5,560.9966 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M886.5,560.9966 L886.5,570.9966 L896.5,570.9966 L886.5,560.9966 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="321" x="560.5" y="579.0664">用以计数，指明request或response的data的引用次数</text><path d="M202,709 L202,717.8997 L161,758.0366 L202,725.8997 L202,734.7993 A0,0 0 0 0 202,734.7993 L563,734.7993 A0,0 0 0 0 563,734.7993 L563,719 L553,709 L202,709 A0,0 0 0 0 202,709 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M553,709 L553,719 L563,719 L553,709 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="340" x="208" y="727.0698">消息发送者的消息队列ID，消息接收者向该ID发送响应消息</text><g id="elem_GMN19"><path d="M1562,864.5 L1562,906.0986 A0,0 0 0 0 1562,906.0986 L1769,906.0986 A0,0 0 0 0 1769,906.0986 L1769,874.5 L1759,864.5 L1652.7,864.5 L1564.81,762.34 L1644.7,864.5 L1562,864.5 A0,0 0 0 0 1562,864.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M1759,864.5 L1759,874.5 L1769,874.5 L1759,864.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="186" x="1568" y="882.5698">data指向共享内存的空间首地址</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="84" x="1568" y="898.3691">len为数据长度</text></g><g id="elem_GMN22"><path d="M972.5,857 L972.5,914.3979 A0,0 0 0 0 972.5,914.3979 L1526.5,914.3979 A0,0 0 0 0 1526.5,914.3979 L1526.5,867 L1516.5,857 L1264.97,857 L1293.22,779.24 L1256.97,857 L972.5,857 A0,0 0 0 0 972.5,857 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M1516.5,857 L1516.5,867 L1526.5,867 L1516.5,857 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="117" x="978.5" y="875.0698">两类数据传输方式：</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="523" x="978.5" y="890.8691">一种共享内存（利用data,len字段，data指向共享内存的空间首地址，len为data的长度）</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="533" x="978.5" y="906.6685">一种利用msgID,msgValue（例如Bootstrap，Hiview，broadcast的pub_sub_feature）</text></g><!--link TaskPool to Exchange--><g id="link_TaskPool_Exchange"><path codeline="55" d="M1016.5,290.65 C1016.5,335.1 1016.5,376.91 1016.5,414.4 " fill="none" id="TaskPool-to-Exchange" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="1016.5,420.4,1020.5,411.4,1016.5,415.4,1012.5,411.4,1016.5,420.4" style="stroke:#000000;stroke-width:1.0;"></polygon><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="130" x="1017.5" y="349.0698">消息队列所交换的信息</text></g><!--link Exchange to Identity--><g id="link_Exchange_Identity"><path codeline="56" d="M967.27,558.68 C952.97,573.77 936.12,587.95 917.5,597 C623.49,739.91 491.34,545.25 184.5,658 C168.32,663.95 157.2922,669.9522 143.2522,679.9822 " fill="none" id="Exchange-to-Identity" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="138.37,683.47,148.0184,681.4931,142.4385,680.5635,143.3681,674.9836,138.37,683.47" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link Exchange to ExchangeType--><g id="link_Exchange_ExchangeType"><path codeline="57" d="M983.82,558.62 C968.89,589.72 953.8454,621.0804 938.9054,652.2204 " fill="none" id="Exchange-to-ExchangeType" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="936.31,657.63,943.8095,651.2458,938.4728,653.122,936.5966,647.7853,936.31,657.63" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link Exchange to Request--><g id="link_Exchange_Request"><path codeline="58" d="M1097.54,554.54 C1145.28,592.27 1200.1626,635.6397 1244.8026,670.9197 " fill="none" id="Exchange-to-Request" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="1249.51,674.64,1244.9292,665.9213,1245.5872,671.5397,1239.9688,672.1977,1249.51,674.64" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link Exchange to Response--><g id="link_Exchange_Response"><path codeline="59" d="M1097.72,524.07 C1176.27,556.93 1298.38,609.04 1402.5,658 C1430.12,670.99 1455.1574,683.5599 1479.9774,696.3599 " fill="none" id="Exchange-to-Response" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="1485.31,699.11,1479.1445,691.4298,1480.8661,696.8182,1475.4777,698.5399,1485.31,699.11" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--SRC=[lLPRJnj757xFhzY-L50PeRPILRbg98ffi2f8QgogVKABFU1LiDVP7TFGg9AX44p0O1fk0aenvPOB6AIK6jl1VsPdT_t4N-ZPdRtCUermNc89QJddpFc-S-PSvXESG4d4fSTv8NMFWrz2Y2CE9TDuaakYv0YIP5CiOoaJmroKbny_4iLnxfafDNvFCYY3md4ko0tyI3yTbOpvsECXuJS4oeoGmfz_vQZIaY1A0e1GpTVk6TVS5M8nxPD9Q1HaNZDW9uCmcf0G7sU83FKCF8WCzu8Ke- -5foXknz7HsMGpX7a9jz0QehuKbYOPsID9Z4MGd1PJCceIXmG9nN04GN9ax3l2Id-_n-QtxsaimQV6a9jUmSXiE8vI6BB516_w09NbZT5GGgQAVhhvcKmRSZaXIku1m8kF8mda_VJBlOe4Bw5unCopaVills0PerGcwV2D6fvTqWD33uRxVWv7kUvkhPfJJ_VLovmwLI87CrhXkLAjaXT5Z-tWmq4mLShvnavMFveYB_EaigfjpUYb_zIBQNhufhQeBXsggvTwTbO__qDRFL5tyk08p0QGBFDZYF9NS-lQ_9MQFGR5mvIbyg3r0Xh0VHIidjuV08g2KDyUzT0lWxs6lh2edXwsq8V2aRxUgC5Mstu7b9f9Rkn15DIxyQyfRsAUO6xLMsnsLJ4N9oDfGeZHTlOsx2ZqJaPgfRbb07Ynh39be9BoM0jduoZbayLvp8DmGeHU-8mz_nC_da4jYzD1jPhXsHtEcc4jDywuw-gwxzGw6D94DpR_9haDTJwhL0xK_3xKW58lsZVeM1j7dKpxLMm7-RLiTpSfhDusLIaH8uXX57FYg4Cw6Bnrx9c7b795BIqhvQnIVatBc-IsIRN21aV-NAJjgbxiMLqVDz7kXlLCKjESkYTNbtgze1SNjUqLTUbOgzIrauL08xkbr-UKwg5INb2g_sXxKwIuIxanenTgdDgJGecyE2659UggUJfBQ4oGCGmrUnDmsFxubkkmXPtH_aXVJyXAK8VZ9C2bWNBNVQkm0zodFCPIvpTj9y3nHCE-VgqjbI1QKdZBvjPKqXvbDqd0jpy2pDRGJkVr-ZQ4p4xKjecnE9IRUTuQLBufHSdPTGVrRSqIClTUNJkdPndpTXbuWckYGGVUnsBIcWDiesvhJzn2XBOBE_qzQw6ZyovUVc9sRC6WPzatZNHZJrNUADNtpAIvFLZN9niekqECcLMkDlOtFy0JMpvCUZxS5RP7dkD0kwYItOMs7R2hhIagjZtePS1jDT4bjMdOkbH8jdVXQgbbs_ZE0yaqWhg0-QMV5S65iOmNvzJD9UkX1k3smmo0ZHraugyPjVIswCDqGILXB66YsbKH33vXbgmLvl9A8pj5ouETCE6G_r502YjwwJ0SecTyzTs2meY8iPWqE7ZktWW2OWH_PFP2gRmXpsV9wQPnYQygZOrtZQDridDE_ihUi_QhiMxW5l9dZRKwgHorW-RMh58-WDgWvvNQddxzKbs_8hNbczgMfSzgntcMo4qjHtAl8By6pm3WazCDzUnVI4YxnC6KqhQkY_A-gSspY2Q4yPG91Um72I0hrmlaQFexKSJm4E7JuAbVc13Gh_0n8ebyFCR39D-QIMT6XcNuizvMjcixA_y3]--></g></svg></p><p>消息队列的底层POSIX,CMSIS两类实现</p>
<p class="plantuml"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="224px" preserveAspectRatio="none" style="width:775px;height:224px;background:#FFFFFF;" version="1.1" viewBox="0 0 775 224" width="775px" zoomAndPan="magnify"><defs></defs><g><!--cluster adpter--><g id="cluster_adpter"><path d="M13.5,11 L65.5,11 A3.75,3.75 0 0 1 68,13.5 L75,34.0146 L765.5,34.0146 A2.5,2.5 0 0 1 768,36.5146 L768,214.5 A2.5,2.5 0 0 1 765.5,217 L13.5,217 A2.5,2.5 0 0 1 11,214.5 L11,13.5 A2.5,2.5 0 0 1 13.5,11 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><line style="stroke:#000000;stroke-width:1.0;" x1="11" x2="75" y1="34.0146" y2="34.0146"></line><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="51" x="15" y="27.0752">adpter</text></g><!--entity memory_adapter--><g id="elem_memory_adapter"><path d="M138,166.5 L138,198.5146 A2.5,2.5 0 0 0 140.5,201.0146 L275.5,201.0146 A2.5,2.5 0 0 0 278,198.5146 L278,174 L268,164 L140.5,164 A2.5,2.5 0 0 0 138,166.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M268,164 L268,171.5 A2.5,2.5 0 0 0 270.5,174 L278,174 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="120" x="148" y="188.0752">memory_adapter</text></g><!--entity queue_adapter--><g id="elem_queue_adapter"><path d="M313,166.5 L313,198.5146 A2.5,2.5 0 0 0 315.5,201.0146 L436.5,201.0146 A2.5,2.5 0 0 0 439,198.5146 L439,174 L429,164 L315.5,164 A2.5,2.5 0 0 0 313,166.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M429,164 L429,171.5 A2.5,2.5 0 0 0 431.5,174 L439,174 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="106" x="323" y="188.0752">queue_adapter</text></g><!--entity thread_adapter--><g id="elem_thread_adapter"><path d="M474.5,166.5 L474.5,198.5146 A2.5,2.5 0 0 0 477,201.0146 L601,201.0146 A2.5,2.5 0 0 0 603.5,198.5146 L603.5,174 L593.5,164 L477,164 A2.5,2.5 0 0 0 474.5,166.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M593.5,164 L593.5,171.5 A2.5,2.5 0 0 0 596,174 L603.5,174 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="109" x="484.5" y="188.0752">thread_adapter</text></g><!--entity time_adapter--><g id="elem_time_adapter"><path d="M638.5,166.5 L638.5,198.5146 A2.5,2.5 0 0 0 641,201.0146 L749,201.0146 A2.5,2.5 0 0 0 751.5,198.5146 L751.5,174 L741.5,164 L641,164 A2.5,2.5 0 0 0 638.5,166.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M741.5,164 L741.5,171.5 A2.5,2.5 0 0 0 744,174 L751.5,174 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="93" x="648.5" y="188.0752">time_adapter</text></g><!--entity build.gn--><g id="elem_build.gn"><path d="M27,166.5 L27,198.5146 A2.5,2.5 0 0 0 29.5,201.0146 L100.5,201.0146 A2.5,2.5 0 0 0 103,198.5146 L103,174 L93,164 L29.5,164 A2.5,2.5 0 0 0 27,166.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M93,164 L93,171.5 A2.5,2.5 0 0 0 95.5,174 L103,174 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="56" x="37" y="188.0752">build.gn</text></g><!--entity posix--><g id="elem_posix"><path d="M493,55.5 L547,55.5 A3.75,3.75 0 0 1 549.5,58 L556.5,78.5146 L571,78.5146 A2.5,2.5 0 0 1 573.5,81.0146 L573.5,93.0146 A2.5,2.5 0 0 1 571,95.5146 L493,95.5146 A2.5,2.5 0 0 1 490.5,93.0146 L490.5,58 A2.5,2.5 0 0 1 493,55.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><line style="stroke:#000000;stroke-width:1.0;" x1="490.5" x2="556.5" y1="78.5146" y2="78.5146"></line><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="41" x="500.5" y="72.5752">posix</text></g><!--entity cmsis--><g id="elem_cmsis"><path d="M367.5,55.5 L422.5,55.5 A3.75,3.75 0 0 1 425,58 L432,78.5146 L446.5,78.5146 A2.5,2.5 0 0 1 449,81.0146 L449,93.0146 A2.5,2.5 0 0 1 446.5,95.5146 L367.5,95.5146 A2.5,2.5 0 0 1 365,93.0146 L365,58 A2.5,2.5 0 0 1 367.5,55.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><line style="stroke:#000000;stroke-width:1.0;" x1="365" x2="432" y1="78.5146" y2="78.5146"></line><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="42" x="375" y="72.5752">cmsis</text></g><g id="elem_GMN18"><path d="M27,47 L27,104.3979 A0,0 0 0 0 27,104.3979 L139.89,104.3979 L82.86,163.97 L147.89,104.3979 L317,104.3979 A0,0 0 0 0 317,104.3979 L317,57 L307,47 L27,47 A0,0 0 0 0 27,47 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M307,47 L307,57 L317,57 L307,47 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="233" x="33" y="65.0698">根据ohos_kernel_type决定构建的依赖</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="233" x="33" y="80.8691">liteos_m内核则链接cmsis包下的源文件</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="269" x="33" y="96.6685">liteos_a或linux内核则链接posix包下的源文件</text></g><!--link posix to memory_adapter--><g id="link_posix_memory_adapter"><path d="M490.31,94.93 C482.62,98.11 474.61,101.26 467,104 C402.19,127.33 343.9301,144.5868 291.1901,159.1568 " fill="none" id="posix-to-memory_adapter" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="none" points="273.84,163.95,292.7878,164.9402,289.5924,153.3735,273.84,163.95" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link posix to queue_adapter--><g id="link_posix_queue_adapter"><path d="M503.75,95.51 C474.86,114.96 445.2835,134.8706 417.1535,153.8006 " fill="none" id="posix-to-queue_adapter" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="none" points="402.22,163.85,420.5033,158.7784,413.8037,148.8227,402.22,163.85" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link posix to thread_adapter--><g id="link_posix_thread_adapter"><path d="M533.28,95.76 C534.58,115.18 535.3601,126.94 536.6201,145.8 " fill="none" id="posix-to-thread_adapter" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="none" points="537.82,163.76,542.6068,145.4001,530.6335,146.2,537.82,163.76" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link posix to time_adapter--><g id="link_posix_time_adapter"><path d="M561.52,95.51 C591.7,114.96 623.0773,135.1731 652.4673,154.1031 " fill="none" id="posix-to-time_adapter" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="none" points="667.6,163.85,655.7163,149.0589,649.2184,159.1473,667.6,163.85" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link cmsis to memory_adapter--><g id="link_cmsis_memory_adapter"><path d="M370.96,95.51 C334.11,114.96 293.2501,136.5207 257.3701,155.4507 " fill="none" id="cmsis-to-memory_adapter" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="none" points="241.45,163.85,260.1699,160.7574,254.5704,150.1439,241.45,163.85" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link cmsis to queue_adapter--><g id="link_cmsis_queue_adapter"><path d="M401.31,95.76 C395.58,115.18 391.8899,127.6346 386.3299,146.4946 " fill="none" id="cmsis-to-queue_adapter" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="none" points="381.24,163.76,392.085,148.1913,380.5748,144.798,381.24,163.76" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link cmsis to thread_adapter--><g id="link_cmsis_thread_adapter"><path d="M430.9,95.51 C455.27,114.9 478.6932,133.5345 502.5032,152.4745 " fill="none" id="cmsis-to-thread_adapter" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="none" points="516.59,163.68,506.2384,147.7789,498.7681,157.1701,516.59,163.68" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link cmsis to time_adapter--><g id="link_cmsis_time_adapter"><path d="M449.1,94.48 C457.01,97.73 465.23,101.03 473,104 C530.19,125.88 579.5166,142.9894 624.6866,158.1594 " fill="none" id="cmsis-to-time_adapter" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="none" points="641.75,163.89,626.5968,152.4716,622.7764,163.8472,641.75,163.89" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--SRC=[VP3BIiD058RtVOhn0UeZ-2fXR4wReNCpcK2BkkiDl2080GjADswx4QMsqAV9ZFKjJ0RCf6scP_bVu3l_cOg00P8K4zv2nKdSwUCU81nA1V6rrShh4Wg80HFnCC0XBirzxog559ej5SM0Guz7cATrcH8QdlTufVwZIP6GmP7QOGb9MaukGwZTlhdmGBj0CxdpFVYrGFs7ohT0fmXSe9d0-Hw2Mg2HW0jL32ma4jtZDStYspmiHIIIe0yn1ngeeGGz-T3BkNaRwStwPpxAjw-xpwpgKAAWo3Cz6Pl5IizUVf-tvl7TSkZxSRwwApfc_MIoQRxvEgnXCyieuUdWe6w7F5477jfNh73x1m00]--></g></svg></p><p class="plantUML"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="130px" preserveAspectRatio="none" style="width:164px;height:130px;background:#FFFFFF;" version="1.1" viewBox="0 0 164 130" width="164px" zoomAndPan="magnify"><defs></defs><g><!--class MQueue--><g id="elem_MQueue"><rect codeline="3" fill="#FFFFFF" height="104.0586" id="MQueue" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="138" x="12" y="12"></rect><ellipse cx="49.3" cy="26" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M44.4094,28.0469 L46.8,27.8125 Q47.0188,29.0156 47.675,29.5781 Q48.3469,30.1406 49.4563,30.1406 Q50.6438,30.1406 51.2375,29.6406 Q51.8469,29.1406 51.8469,28.4688 Q51.8469,28.0313 51.5969,27.7344 Q51.3469,27.4219 50.7219,27.2031 Q50.2844,27.0469 48.7531,26.6719 Q46.7688,26.1875 45.9719,25.4688 Q44.8469,24.4688 44.8469,23.0156 Q44.8469,22.0938 45.3781,21.2813 Q45.9094,20.4688 46.8938,20.0469 Q47.8938,19.625 49.3,19.625 Q51.5813,19.625 52.7375,20.625 Q53.9094,21.625 53.9563,23.3125 L51.5031,23.4219 Q51.3469,22.4844 50.8313,22.0781 Q50.3156,21.6563 49.2688,21.6563 Q48.2063,21.6563 47.5969,22.0938 Q47.2063,22.375 47.2063,22.8594 Q47.2063,23.2813 47.5656,23.5938 Q48.0344,23.9844 49.8156,24.4063 Q51.6125,24.8281 52.4719,25.2813 Q53.3313,25.7344 53.8156,26.5156 Q54.3156,27.2969 54.3156,28.4531 Q54.3156,29.5 53.7219,30.4219 Q53.1438,31.3281 52.0813,31.7813 Q51.0188,32.2188 49.4406,32.2188 Q47.1281,32.2188 45.8938,31.1563 Q44.6594,30.0781 44.4094,28.0469 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="56" x="66.7" y="31.5679">MQueue</text><line style="stroke:#000000;stroke-width:1.0;" x1="13" x2="149" y1="40" y2="40"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="116" x="18" y="58.0752">QUEUE_Create()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="93" x="18" y="75.0898">QUEUE_Put()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="96" x="18" y="92.1045">QUEUE_Pop()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="126" x="18" y="109.1191">QUEUE_Destroy()</text></g><!--SRC=[Kop9ICrDLIZ8ISpCur80WepCb5I5rDo2aag5tDJSfDIYOh1mS4bHQNA9WczWQMffQZLO20G2Grr3NUETYr8JIr8rDD640qfBCCNo2p34N5ABIuhoAw7YjG00]--></g></svg></p><h4 id="cmsis实现">CMSIS实现 </h4>
<p>QUEUE_Create调用链：</p>
<p class="plantuml"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="319px" preserveAspectRatio="none" style="width:1039px;height:319px;background:#FFFFFF;" version="1.1" viewBox="0 0 1039 319" width="1039px" zoomAndPan="magnify"><defs></defs><g><rect fill="#FFFFFF" height="180.5952" style="stroke:#000000;stroke-width:1.0;" width="10" x="447" y="84.6133"></rect><rect fill="#FFFFFF" height="105.1973" style="stroke:#000000;stroke-width:1.0;" width="10" x="725" y="130.2119"></rect><rect fill="#FFFFFF" height="29.7993" style="stroke:#000000;stroke-width:1.0;" width="10" x="978" y="175.8105"></rect><line style="stroke:#000000;stroke-width:1.0;" x1="79" x2="79" y1="37.0146" y2="283.2085"></line><line style="stroke:#000000;stroke-width:1.0;" x1="452" x2="452" y1="37.0146" y2="283.2085"></line><line style="stroke:#000000;stroke-width:1.0;" x1="730" x2="730" y1="37.0146" y2="283.2085"></line><line style="stroke:#000000;stroke-width:1.0;" x1="983" x2="983" y1="37.0146" y2="283.2085"></line><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="118" x="20" y="5"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="104" x="27" y="26.0752">QUEUE_Create</text><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="118" x="20" y="282.2085"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="104" x="27" y="303.2837">QUEUE_Create</text><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="112" x="396" y="5"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="98" x="403" y="26.0752">KAL内核抽象层</text><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="112" x="396" y="282.2085"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="98" x="403" y="303.2837">KAL内核抽象层</text><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="86" x="687" y="5"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="72" x="694" y="26.0752">los_queue</text><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="86" x="687" y="282.2085"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="72" x="694" y="303.2837">los_queue</text><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="100" x="933" y="5"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="86" x="940" y="26.0752">los_memory</text><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="100" x="933" y="282.2085"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="86" x="940" y="303.2837">los_memory</text><rect fill="#FFFFFF" height="180.5952" style="stroke:#000000;stroke-width:1.0;" width="10" x="447" y="84.6133"></rect><rect fill="#FFFFFF" height="105.1973" style="stroke:#000000;stroke-width:1.0;" width="10" x="725" y="130.2119"></rect><rect fill="#FFFFFF" height="29.7993" style="stroke:#000000;stroke-width:1.0;" width="10" x="978" y="175.8105"></rect><polygon fill="#000000" points="435,80.6133,445,84.6133,435,88.6133,439,84.6133" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="79" x2="441" y1="84.6133" y2="84.6133"></line><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="185" x="86" y="64.0845">调用osMessageQueueNew(),</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="349" x="86" y="79.8838">设置其size,count,name等属性（但其他属性UNUSED掉了)</text><polygon fill="#000000" points="713,126.2119,723,130.2119,713,134.2119,717,130.2119" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="457" x2="719" y1="130.2119" y2="130.2119"></line><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="249" x="464" y="109.6831">调用LOS_QueueCreate()创建消息队列，</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="133" x="464" y="125.4824">其由LosQueueCB管理</text><polygon fill="#000000" points="966,171.8105,976,175.8105,966,179.8105,970,175.8105" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="735" x2="972" y1="175.8105" y2="175.8105"></line><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="224" x="742" y="155.2817">调用LOS_MemAlloc()在指定内存池为</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="104" x="742" y="171.0811">消息队列分配内存</text><polygon fill="#000000" points="746,201.6099,736,205.6099,746,209.6099,742,205.6099" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="740" x2="982" y1="205.6099" y2="205.6099"></line><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="91" x="752" y="200.8804">分配的内存指针</text><polygon fill="#000000" points="468,231.4092,458,235.4092,468,239.4092,464,235.4092" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="462" x2="729" y1="235.4092" y2="235.4092"></line><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="130" x="474" y="230.6797">分配成功或失败的信息</text><polygon fill="#000000" points="90,261.2085,80,265.2085,90,269.2085,86,265.2085" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="84" x2="451" y1="265.2085" y2="265.2085"></line><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="312" x="96" y="260.479">如果成功返回message queue ID，如果失败返回null</text><!--SRC=[VPBRIW916CVlUuhjJa5Ve8l0qej83P6z4sIneOGzbBjRr5LPhgjOI8Y9YWVeu8rR2o7Y8LzcPtQzyXKQTqJpK7Cvyyt_z_lccstf5720EcEPEBz5uHMYVRGlkfy0Z0GezovrwF539OKQNPGTMdeJwabgXwAippkpq1B40115vWI4P2238BXqE5qHtjA-pQ46KnqnVWrSCK7c9HVFSC1iPw1UGpVlau5g31LSOFIBP8SEqc6V5prcZ9xYj3MOc1I_c2giy-tp3LfObXN4wFdK1JiIHVzHE6hRaOuSJgXMOB-7EYgw_HYNwb1zdWno4HxRc0NTBuYaUC_KccPUMLQPfzlR2zOCp05EI5mjaGE0yx2i4CFOQWlbqb0hOslOBY6zONHx4Vwt1rILSUg1dA-3IVgSF8EvLvec6MRvVeR9fSTFgdtf6FmNDslahtcJMAJcORQEr29yqQslLqmnHasilob_yKwR9eKvI_yC4zwIg5Ob16jKW9KQHxuMHTGEl7XCf8ZGIH4li-mgVXtu0m00]--></g></svg></p><pre data-role="codeBlock" data-info="code" class="language-code code"><code>typedef struct 
{
    UINT8       *queueHandle;                    /* 队列指针 */
    UINT8       queueState;                      /* 队列状态 */
    UINT8       queueMemType;                    /* 创建队列时内存分配的方式 */
    UINT16      queueLen;                        /* 队列中消息节点个数，即队列长度 */
    UINT16      queueSize;                       /* 消息节点大小 */
    UINT32      queueID;                         /* 队列ID */
    UINT16      queueHead;                       /* 消息头节点位置（数组下标）*/
    UINT16      queueTail;                       /* 消息尾节点位置（数组下标）*/
    UINT16      readWriteableCnt[OS_QUEUE_N_RW]; /* 数组下标0的元素表示队列中可读消息数，                              
                                                    数组下标1的元素表示队列中可写消息数 */
    LOS_DL_LIST readWriteList[OS_QUEUE_N_RW];    /* 读取或写入消息的任务等待链表， 
                                                    下标0：读取链表，下标1：写入链表 */
    LOS_DL_LIST memList;                         /* CMSIS-RTOS中的MailBox模块使用的内存块链表 */
} LosQueueCB;

</code></pre><p>QUEUE_Put调用链：</p>
<p class="plantuml"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="469px" preserveAspectRatio="none" style="width:1447px;height:469px;background:#FFFFFF;" version="1.1" viewBox="0 0 1447 469" width="1447px" zoomAndPan="magnify"><defs></defs><g><rect fill="#FFFFFF" height="339.1611" style="stroke:#000000;stroke-width:1.0;" width="10" x="332.5" y="84.6133"></rect><rect fill="#FFFFFF" height="189.5952" style="stroke:#000000;stroke-width:1.0;" width="10" x="600.5" y="114.4126"></rect><rect fill="#FFFFFF" height="105.1973" style="stroke:#000000;stroke-width:1.0;" width="10" x="868.5" y="144.2119"></rect><rect fill="#FFFFFF" height="29.7993" style="stroke:#000000;stroke-width:1.0;" width="10" x="1369.5" y="189.8105"></rect><rect fill="#FFFFFF" height="152.3652" style="stroke:#000000;stroke-width:1.0;" width="690" x="15" y="264.4092"></rect><rect fill="#FFFFFF" height="74.9673" style="stroke:none;stroke-width:1.0;" width="690" x="15" y="341.8071"></rect><line style="stroke:#000000;stroke-width:1.0;" x1="61" x2="61" y1="37.0146" y2="433.7744"></line><line style="stroke:#000000;stroke-width:1.0;" x1="337" x2="337" y1="37.0146" y2="433.7744"></line><line style="stroke:#000000;stroke-width:1.0;" x1="605" x2="605" y1="37.0146" y2="433.7744"></line><line style="stroke:#000000;stroke-width:1.0;" x1="873" x2="873" y1="37.0146" y2="433.7744"></line><line style="stroke:#000000;stroke-width:1.0;" x1="1374.5" x2="1374.5" y1="37.0146" y2="433.7744"></line><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="53" x="35" y="5"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="39" x="42" y="26.0752">Client</text><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="53" x="35" y="432.7744"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="39" x="42" y="453.8496">Client</text><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="95" x="290" y="5"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="81" x="297" y="26.0752">QUEUE_Put</text><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="95" x="290" y="432.7744"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="81" x="297" y="453.8496">QUEUE_Put</text><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="159" x="526" y="5"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="145" x="533" y="26.0752">osMessageQueuePut</text><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="159" x="526" y="432.7744"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="145" x="533" y="453.8496">osMessageQueuePut</text><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="171" x="788" y="5"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="157" x="795" y="26.0752">LOS_QueueWriteCopy</text><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="171" x="788" y="432.7744"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="157" x="795" y="453.8496">LOS_QueueWriteCopy</text><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="134" x="1307.5" y="5"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="120" x="1314.5" y="26.0752">OsQueueOperate</text><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="134" x="1307.5" y="432.7744"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="120" x="1314.5" y="453.8496">OsQueueOperate</text><rect fill="#FFFFFF" height="339.1611" style="stroke:#000000;stroke-width:1.0;" width="10" x="332.5" y="84.6133"></rect><rect fill="#FFFFFF" height="189.5952" style="stroke:#000000;stroke-width:1.0;" width="10" x="600.5" y="114.4126"></rect><rect fill="#FFFFFF" height="105.1973" style="stroke:#000000;stroke-width:1.0;" width="10" x="868.5" y="144.2119"></rect><rect fill="#FFFFFF" height="29.7993" style="stroke:#000000;stroke-width:1.0;" width="10" x="1369.5" y="189.8105"></rect><polygon fill="#000000" points="320.5,80.6133,330.5,84.6133,320.5,88.6133,324.5,84.6133" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="61.5" x2="326.5" y1="84.6133" y2="84.6133"></line><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="252" x="68.5" y="64.0845">设置队列ID, 元素, 优先级, 允许的超时时间</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="224" x="68.5" y="79.8838">源代码中所有该调用皆为DONT_WAIT</text><polygon fill="#000000" points="588.5,110.4126,598.5,114.4126,588.5,118.4126,592.5,114.4126" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="342.5" x2="594.5" y1="114.4126" y2="114.4126"></line><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="239" x="349.5" y="109.6831">设置队列ID, 元素, 优先级, 计算后的超时</text><polygon fill="#000000" points="856.5,140.2119,866.5,144.2119,856.5,148.2119,860.5,144.2119" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="610.5" x2="862.5" y1="144.2119" y2="144.2119"></line><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="239" x="617.5" y="139.4824">设置队列ID, 元素, 缓冲区大小, 超时时间</text><polygon fill="#000000" points="1357.5,185.8105,1367.5,189.8105,1357.5,193.8105,1361.5,189.8105" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="878.5" x2="1363.5" y1="189.8105" y2="189.8105"></line><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="340" x="885.5" y="169.2817">设置队列ID, 操作类型, 缓冲区地址, 缓冲区大小, 超时时间</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="472" x="885.5" y="185.0811">操作类型为写队列尾部且为非指针操作，这意味着会调用memcpy_s复制整个内存</text><polygon fill="#000000" points="889.5,215.6099,879.5,219.6099,889.5,223.6099,885.5,219.6099" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="883.5" x2="1373.5" y1="219.6099" y2="219.6099"></line><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="52" x="895.5" y="214.8804">返回状态</text><polygon fill="#000000" points="621.5,245.4092,611.5,249.4092,621.5,253.4092,617.5,249.4092" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="615.5" x2="872.5" y1="249.4092" y2="249.4092"></line><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="52" x="627.5" y="244.6797">返回状态</text><path d="M15,264.4092 L79,264.4092 L79,272.2085 L69,282.2085 L15,282.2085 L15,264.4092 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><rect fill="none" height="152.3652" style="stroke:#000000;stroke-width:1.0;" width="690" x="15" y="264.4092"></rect><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="30" y="278.479">alt</text><text fill="#000000" font-family="Verdana" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="105" x="94" y="277.4683">[如果返回LOS_OK]</text><polygon fill="#000000" points="353.5,300.0078,343.5,304.0078,353.5,308.0078,349.5,304.0078" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="347.5" x2="604.5" y1="304.0078" y2="304.0078"></line><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="59" x="359.5" y="299.2783">返回osOK</text><polygon fill="#000000" points="72.5,329.8071,62.5,333.8071,72.5,337.8071,68.5,333.8071" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="66.5" x2="331.5" y1="333.8071" y2="333.8071"></line><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="113" x="78.5" y="329.0776">返回EC_SUCCESS</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="15" x2="705" y1="342.8071" y2="342.8071"></line><text fill="#000000" font-family="Verdana" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="78" x="20" y="353.8662">[如果发生错误]</text><polygon fill="#000000" points="353.5,374.9751,343.5,378.9751,353.5,382.9751,349.5,378.9751" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="347.5" x2="604.5" y1="378.9751" y2="378.9751"></line><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="78" x="359.5" y="374.2456">返回错误状态</text><polygon fill="#000000" points="72.5,404.7744,62.5,408.7744,72.5,412.7744,68.5,408.7744" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="66.5" x2="331.5" y1="408.7744" y2="408.7744"></line><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="112" x="78.5" y="404.0449">返回EC_BUSBUSY</text><!--SRC=[fLDTRz9G6Bu_l-Auw-qFU66Y7HUBphfqP34nQHfsCfj0QMWnsHt8GAPCDbV3Xy1cd6unMK4bX32s_PcUdlRAl-2XBT12qIKsvwBd_NgUztdVSqzzYH88od51b80if5Gn9ig2fC8b9YuYILs2WWBTtw1x8ng9HlXdQJTY8utIY5w2CKbb7IcAi8F6RYUMLTQLdV249op7EvwjbAWY9YdlEXdK7BG6irZ5yR8oIWagyZ3y9W3S3k3AWmbJU1zQ-Wsvrktg2IvMrbQN8SxdIFTq6Hh3AiuNoU1yPCfQUf_KzwnUtgpqwB4htHUIEJWqhhwGqwpHlpJtCsPZtsf_jJevebsGUi7e3rRPfvlyriErJI34LF4LvJ2L24meK3e1CUx6oT8_4xs23zzFQ4r1Wjg2O7KADwVaNo39y1WNVkBI09-TuqwP0liqc4BE3mVCepYT-aSIWciU7nZN3VBZ2hVU-T4R7TpC_8CE7Oalcmu05sfkPToviNCNHb-ZHhlPCajlx0z5D_Zti6JTriozCZxwHPePOrXtHvX0YPYyoolux00NU-R7hj7_ZWjvV5dr2nrSi9dkLXPfVQlXJotojcTcic0RBImNec3OiYoe5Z8I8Qv2_EsrsMguIQENnZu6a7upIpBpHfpefEB51YZxLsta3DJmNjouGeJXkIZ3H3WEeBY2F2wuV4Iq4rkhMUtsNRcuqLxJ_ylfKPIZvpb0qZRmApXE-mC0]--></g></svg></p><h4 id="posix实现">POSIX实现 </h4>
<p>生产者-消费者模型</p>
<blockquote>
<p>生产者消费者模式是一种常见的并发设计模式，用于处理在多线程环境下不同进程或线程间的数据共享和同步。在这个模式中，生产者负责生成数据，消费者负责处理数据。关键点在于生产者和消费者的处理速度可能不同，因此需要一种机制来平衡它们之间的速率差异。</p>
<p>主要组件<br>
生产者（Producer）：负责生成数据，并将其放入缓冲区。生产者可以是一个或多个线程。</p>
<p>消费者（Consumer）：从缓冲区中取出数据并处理它。消费者也可以是一个或多个线程。</p>
<p>缓冲区（Buffer）：临时存储生产者生成的数据，等待消费者处理。缓冲区可以是有限的（有最大容量限制）或无限的。</p>
<p>关键特点<br>
同步机制：由于生产者和消费者通常以不同的速率运行，因此需要同步机制来协调它们的工作。这通常通过锁（如互斥锁）和信号（如条件变量）实现。</p>
<p>阻塞和唤醒：当缓冲区为空时，消费者线程可能会被阻塞，直到有新数据加入缓冲区。类似地，当缓冲区满时，生产者线程可能会被阻塞，直到消费者取走一些数据。</p>
</blockquote>
<p class="plantUML"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="140px" preserveAspectRatio="none" style="width:697px;height:140px;background:#FFFFFF;" version="1.1" viewBox="0 0 697 140" width="697px" zoomAndPan="magnify"><defs></defs><g><!--class LockFreeBlockQueue--><g id="elem_LockFreeBlockQueue"><rect codeline="4" fill="#FFFFFF" height="104.0586" id="LockFreeBlockQueue" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="206" x="314" y="20.5"></rect><ellipse cx="342.3" cy="34.5" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M337.4094,36.5469 L339.8,36.3125 Q340.0188,37.5156 340.675,38.0781 Q341.3469,38.6406 342.4563,38.6406 Q343.6438,38.6406 344.2375,38.1406 Q344.8469,37.6406 344.8469,36.9688 Q344.8469,36.5313 344.5969,36.2344 Q344.3469,35.9219 343.7219,35.7031 Q343.2844,35.5469 341.7531,35.1719 Q339.7688,34.6875 338.9719,33.9688 Q337.8469,32.9688 337.8469,31.5156 Q337.8469,30.5938 338.3781,29.7813 Q338.9094,28.9688 339.8938,28.5469 Q340.8938,28.125 342.3,28.125 Q344.5813,28.125 345.7375,29.125 Q346.9094,30.125 346.9563,31.8125 L344.5031,31.9219 Q344.3469,30.9844 343.8313,30.5781 Q343.3156,30.1563 342.2688,30.1563 Q341.2063,30.1563 340.5969,30.5938 Q340.2063,30.875 340.2063,31.3594 Q340.2063,31.7813 340.5656,32.0938 Q341.0344,32.4844 342.8156,32.9063 Q344.6125,33.3281 345.4719,33.7813 Q346.3313,34.2344 346.8156,35.0156 Q347.3156,35.7969 347.3156,36.9531 Q347.3156,38 346.7219,38.9219 Q346.1438,39.8281 345.0813,40.2813 Q344.0188,40.7188 342.4406,40.7188 Q340.1281,40.7188 338.8938,39.6563 Q337.6594,38.5781 337.4094,36.5469 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="144" x="357.7" y="40.0679">LockFreeBlockQueue</text><line style="stroke:#000000;stroke-width:1.0;" x1="315" x2="519" y1="48.5" y2="48.5"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="194" x="320" y="66.5752">wMutex : pthread_mutex_t</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="189" x="320" y="83.5898">rMutex : pthread_mutex_t</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="163" x="320" y="100.6045">cond : pthread_cond_t</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="166" x="320" y="117.6191">queue : LockFreeQueue</text></g><!--class LockFreeQueue--><g id="elem_LockFreeQueue"><rect codeline="10" fill="#FFFFFF" height="121.0732" id="LockFreeQueue" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="135" x="555.5" y="12"></rect><ellipse cx="568.5" cy="26" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M563.6094,28.0469 L566,27.8125 Q566.2188,29.0156 566.875,29.5781 Q567.5469,30.1406 568.6563,30.1406 Q569.8438,30.1406 570.4375,29.6406 Q571.0469,29.1406 571.0469,28.4688 Q571.0469,28.0313 570.7969,27.7344 Q570.5469,27.4219 569.9219,27.2031 Q569.4844,27.0469 567.9531,26.6719 Q565.9688,26.1875 565.1719,25.4688 Q564.0469,24.4688 564.0469,23.0156 Q564.0469,22.0938 564.5781,21.2813 Q565.1094,20.4688 566.0938,20.0469 Q567.0938,19.625 568.5,19.625 Q570.7813,19.625 571.9375,20.625 Q573.1094,21.625 573.1563,23.3125 L570.7031,23.4219 Q570.5469,22.4844 570.0313,22.0781 Q569.5156,21.6563 568.4688,21.6563 Q567.4063,21.6563 566.7969,22.0938 Q566.4063,22.375 566.4063,22.8594 Q566.4063,23.2813 566.7656,23.5938 Q567.2344,23.9844 569.0156,24.4063 Q570.8125,24.8281 571.6719,25.2813 Q572.5313,25.7344 573.0156,26.5156 Q573.5156,27.2969 573.5156,28.4531 Q573.5156,29.5 572.9219,30.4219 Q572.3438,31.3281 571.2813,31.7813 Q570.2188,32.2188 568.6406,32.2188 Q566.3281,32.2188 565.0938,31.1563 Q563.8594,30.0781 563.6094,28.0469 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="107" x="580.5" y="31.5679">LockFreeQueue</text><line style="stroke:#000000;stroke-width:1.0;" x1="556.5" x2="689.5" y1="40" y2="40"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="90" x="561.5" y="58.0752">write: uint32</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="87" x="561.5" y="75.0898">read: uint32</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="115" x="561.5" y="92.1045">itemSize: uint32</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="117" x="561.5" y="109.1191">totalSize: uint32</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="89" x="561.5" y="126.1338">buffer: uint8</text></g><path d="M11,29 L11,54.7993 A0,0 0 0 0 11,54.7993 L253,54.7993 A0,0 0 0 0 253,54.7993 L253,47 L318,61.0073 L253,39 L253,39 L243,29 L11,29 A0,0 0 0 0 11,29 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M243,29 L243,39 L253,39 L243,29 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="221" x="17" y="47.0698">POSIX 线程（pthreads）库的互斥锁</text><path d="M11,64.7993 L11,106.3979 A0,0 0 0 0 11,106.3979 L279,106.3979 A0,0 0 0 0 279,106.3979 L279,89.5986 L318,95.0366 L279,81.5986 L279,74.7993 L269,64.7993 L11,64.7993 A0,0 0 0 0 11,64.7993 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M269,64.7993 L269,74.7993 L279,74.7993 L269,64.7993 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="247" x="17" y="82.8691">POSIX 线程（pthreads）库的条件变量，</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="213" x="17" y="98.6685">支持Wait，Signal，Broadcast操作</text><!--link LockFreeBlockQueue to LockFreeQueue--><g id="link_LockFreeBlockQueue_LockFreeQueue"><path codeline="18" d="M520.4,72.5 C532.02,72.5 537.65,72.5 549.27,72.5 " fill="none" id="LockFreeBlockQueue-to-LockFreeQueue" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="555.27,72.5,546.27,68.5,550.27,72.5,546.27,76.5,555.27,72.5" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--SRC=[Kop9ICrDLIZ8ISpCuyh8J4bLICqjAAbKo4tDJKejAkRYAYufAaqkKV39JyvsAqfDTSe1CW9BKqjJ5Qgv582WtBUq9BL2mKgXe2IZA3Kn9JuNn8yl0KiMuPDCpizBGP82SQ4oXM3phU2MWktZgaLt2uepYZ9BKgqKIZFpIeoD87O33KKH02h83SwiGbLLab-Ic8CXcbIQbfPQ116o05hCXSNxkdPexkFAooz9LSX9JIjHo4_34c1MLf2muWhm3_QCK7Y-Q__p5TtlztH00w3u_PxEfxicFv_LycJNf6VJbhwSqiYL2WmXaAb4c0qAFe8cFvkxyCdkRK_xPxnixt-_fuVhsPJrpteQmnCpIu2yuCpqlCGS8CEfA3yn9JcnkEJPvDudU-V0NG40]--></g></svg></p><p class="plantuml"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="724px" preserveAspectRatio="none" style="width:272px;height:724px;background:#FFFFFF;" version="1.1" viewBox="0 0 272 724" width="272px" zoomAndPan="magnify"><defs></defs><g><ellipse cx="136" cy="15" fill="#FFFFFF" rx="10" ry="10" style="stroke:#000000;stroke-width:1.0;"></ellipse><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="260" x="6" y="45"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="240" x="16" y="67.0645">接收参数queueId, element, pri, timeout</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="124" x="74" y="148.2683"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="104" x="84" y="170.3328">返回 EC_INVALID</text><ellipse cx="136" cy="222.0603" fill="none" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"></ellipse><ellipse cx="136" cy="222.0603" fill="#FFFFFF" rx="6" ry="6" style="stroke:#000000;stroke-width:1.0;"></ellipse><polygon fill="#FFFFFF" points="114,99.584,158,99.584,170,111.584,158,123.584,114,123.584,102,111.584,114,99.584" style="stroke:#000000;stroke-width:1.0;"></polygon><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="22" x="140" y="134.6431">失败</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="44" x="114" y="115.9587">参数检查</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="22" x="170" y="109.2744">成功</text><rect fill="#FFFFFF" height="411.1025" style="stroke:#000000;stroke-width:1.0;" width="148" x="62" y="265.0603"></rect><path d="M153,265.0603 L153,275.075 L143,285.075 L62,285.075 " fill="none" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="81" x="65" y="280.1355">QUEUE_Put</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="97" x="87.5" y="302.075"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="77" x="97.5" y="324.1394">锁定 wMutex</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="128" x="72" y="356.6589"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="108" x="82" y="378.7234">执行 LFQUE_Push</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="97" x="87.5" y="411.2429"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="77" x="97.5" y="433.3074">解锁 wMutex</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="91" x="90.5" y="465.8269"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="71" x="100.5" y="487.8914">锁定 rMutex</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="116" x="78" y="520.4109"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="96" x="88" y="542.4753">发出条件变量信号</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="91" x="90.5" y="574.9949"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="71" x="100.5" y="597.0593">解锁 rMutex</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="92" x="90" y="629.5789"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="72" x="100" y="651.6433">返回操作结果</text><ellipse cx="136" cy="707.1628" fill="none" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"></ellipse><ellipse cx="136" cy="707.1628" fill="#FFFFFF" rx="6" ry="6" style="stroke:#000000;stroke-width:1.0;"></ellipse><line style="stroke:#000000;stroke-width:1.0;" x1="136" x2="136" y1="25" y2="45"></line><polygon fill="#000000" points="132,35,136,45,140,35,136,39" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="136" x2="136" y1="182.8523" y2="211.0603"></line><polygon fill="#000000" points="132,201.0603,136,211.0603,140,201.0603,136,205.0603" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="136" x2="136" y1="123.584" y2="148.2683"></line><polygon fill="#000000" points="132,138.2683,136,148.2683,140,138.2683,136,142.2683" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="170" x2="208" y1="111.584" y2="111.584"></line><polygon fill="#000000" points="204,181.0603,208,191.0603,212,181.0603,208,185.0603" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="208" x2="208" y1="111.584" y2="255.0603"></line><line style="stroke:#000000;stroke-width:1.0;" x1="208" x2="136" y1="255.0603" y2="255.0603"></line><line style="stroke:#000000;stroke-width:1.0;" x1="136" x2="136" y1="255.0603" y2="302.075"></line><polygon fill="#000000" points="132,292.075,136,302.075,140,292.075,136,296.075" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="136" x2="136" y1="79.584" y2="99.584"></line><polygon fill="#000000" points="132,89.584,136,99.584,140,89.584,136,93.584" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="136" x2="136" y1="336.6589" y2="356.6589"></line><polygon fill="#000000" points="132,346.6589,136,356.6589,140,346.6589,136,350.6589" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="136" x2="136" y1="391.2429" y2="411.2429"></line><polygon fill="#000000" points="132,401.2429,136,411.2429,140,401.2429,136,405.2429" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="136" x2="136" y1="445.8269" y2="465.8269"></line><polygon fill="#000000" points="132,455.8269,136,465.8269,140,455.8269,136,459.8269" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="136" x2="136" y1="500.4109" y2="520.4109"></line><polygon fill="#000000" points="132,510.4109,136,520.4109,140,510.4109,136,514.4109" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="136" x2="136" y1="554.9949" y2="574.9949"></line><polygon fill="#000000" points="132,564.9949,136,574.9949,140,564.9949,136,568.9949" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="136" x2="136" y1="609.5789" y2="629.5789"></line><polygon fill="#000000" points="132,619.5789,136,629.5789,140,619.5789,136,623.5789" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="136" x2="136" y1="664.1628" y2="696.1628"></line><polygon fill="#000000" points="132,686.1628,136,696.1628,140,686.1628,136,690.1628" style="stroke:#000000;stroke-width:1.0;"></polygon><!--SRC=[JO_DIiD054RtzockNJMG9qXMeX42hTX5tPP2ftGWJM8oGK44TLCLDKeZYFQ7K4DtHK4KBDANoOpfMpXf1RCzd7kutmRha2v1rsfI6y1dJOy1QE8s4T473y_5m-j1G09YjbGabZHjfgBhKHKPxH8dO3hGDfRNffYSYd6Ye4pQahsyPU-90eXQjeZuymYDhOQvkxzPCRTrINtck40ids1PNDpngx42n6xHDe0hdw2CEZQMQdMZRZJs0bR2uxoqZCxux0aFgm4ZHtb54vVJBBx6oavj9VgT5Ssc4waMlRzBxv_my9xtliGmJkTowkEo5wQBc8UVnK11NuyG_PlqU_0pxulHG8SJo5Vy0W00]--></g></svg></p><p class="plantuml"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="638px" preserveAspectRatio="none" style="width:199px;height:638px;background:#FFFFFF;" version="1.1" viewBox="0 0 199 638" width="199px" zoomAndPan="magnify"><defs></defs><g><ellipse cx="99.5" cy="15" fill="#FFFFFF" rx="10" ry="10" style="stroke:#000000;stroke-width:1.0;"></ellipse><rect fill="#FFFFFF" height="555.97" style="stroke:#000000;stroke-width:1.0;" width="187" x="6" y="35"></rect><path d="M100,35 L100,45.0146 L90,55.0146 L6,55.0146 " fill="none" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="84" x="9" y="50.0752">QUEUE_Pop</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="121" x="39" y="72.0146"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="101" x="49" y="94.0791">尝试 LFQUE_Pop</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="132" x="33.5" y="175.283"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="112" x="43.5" y="197.3474">返回 EC_SUCCESS</text><ellipse cx="99.5" cy="249.075" fill="none" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"></ellipse><ellipse cx="99.5" cy="249.075" fill="#FFFFFF" rx="6" ry="6" style="stroke:#000000;stroke-width:1.0;"></ellipse><polygon fill="#FFFFFF" points="74.5,126.5986,124.5,126.5986,136.5,138.5986,124.5,150.5986,74.5,150.5986,62.5,138.5986,74.5,126.5986" style="stroke:#000000;stroke-width:1.0;"></polygon><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="11" x="103.5" y="161.6577">是</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="50" x="74.5" y="142.9734">操作成功?</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="11" x="136.5" y="136.2891">否</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="91" x="54" y="302.075"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="71" x="64" y="324.1394">锁定 rMutex</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="92" x="53.5" y="413.218"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="72" x="63.5" y="435.2825">等待条件变量</text><polygon fill="#FFFFFF" points="46,356.6589,153,356.6589,165,368.6589,153,380.6589,46,380.6589,34,368.6589,46,356.6589" style="stroke:#000000;stroke-width:1.0;"></polygon><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="11" x="103.5" y="391.718">是</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="107" x="46" y="373.0337">LFQUE_Pop 不成功?</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="91" x="54" y="489.802"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="71" x="64" y="511.8665">解锁 rMutex</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="132" x="33.5" y="544.386"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="112" x="43.5" y="566.4504">返回 EC_SUCCESS</text><ellipse cx="99.5" cy="621.97" fill="none" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"></ellipse><ellipse cx="99.5" cy="621.97" fill="#FFFFFF" rx="6" ry="6" style="stroke:#000000;stroke-width:1.0;"></ellipse><line style="stroke:#000000;stroke-width:1.0;" x1="99.5" x2="99.5" y1="209.8669" y2="238.075"></line><polygon fill="#000000" points="95.5,228.075,99.5,238.075,103.5,228.075,99.5,232.075" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="99.5" x2="99.5" y1="150.5986" y2="175.283"></line><polygon fill="#000000" points="95.5,165.283,99.5,175.283,103.5,165.283,99.5,169.283" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="136.5" x2="175.5" y1="138.5986" y2="138.5986"></line><polygon fill="#000000" points="171.5,208.075,175.5,218.075,179.5,208.075,175.5,212.075" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="175.5" y1="138.5986" y2="282.075"></line><line style="stroke:#000000;stroke-width:1.0;" x1="175.5" x2="99.5" y1="282.075" y2="282.075"></line><line style="stroke:#000000;stroke-width:1.0;" x1="99.5" x2="99.5" y1="282.075" y2="302.075"></line><polygon fill="#000000" points="95.5,292.075,99.5,302.075,103.5,292.075,99.5,296.075" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="99.5" x2="99.5" y1="106.5986" y2="126.5986"></line><polygon fill="#000000" points="95.5,116.5986,99.5,126.5986,103.5,116.5986,99.5,120.5986" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="99.5" x2="99.5" y1="380.6589" y2="413.218"></line><polygon fill="#000000" points="95.5,403.218,99.5,413.218,103.5,403.218,99.5,407.218" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="99.5" x2="99.5" y1="447.802" y2="457.802"></line><line style="stroke:#000000;stroke-width:1.0;" x1="99.5" x2="177" y1="457.802" y2="457.802"></line><polygon fill="#000000" points="173,421.8257,177,411.8257,181,421.8257,177,417.8257" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="177" x2="177" y1="368.6589" y2="457.802"></line><line style="stroke:#000000;stroke-width:1.0;" x1="177" x2="165" y1="368.6589" y2="368.6589"></line><polygon fill="#000000" points="175,364.6589,165,368.6589,175,372.6589,171,368.6589" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="34" x2="22" y1="368.6589" y2="368.6589"></line><polygon fill="#000000" points="18,407.8257,22,417.8257,26,407.8257,22,411.8257" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="22" x2="22" y1="368.6589" y2="469.802"></line><line style="stroke:#000000;stroke-width:1.0;" x1="22" x2="99.5" y1="469.802" y2="469.802"></line><line style="stroke:#000000;stroke-width:1.0;" x1="99.5" x2="99.5" y1="469.802" y2="489.802"></line><polygon fill="#000000" points="95.5,479.802,99.5,489.802,103.5,479.802,99.5,483.802" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="99.5" x2="99.5" y1="336.6589" y2="356.6589"></line><polygon fill="#000000" points="95.5,346.6589,99.5,356.6589,103.5,346.6589,99.5,350.6589" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="99.5" x2="99.5" y1="524.386" y2="544.386"></line><polygon fill="#000000" points="95.5,534.386,99.5,544.386,103.5,534.386,99.5,538.386" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="99.5" x2="99.5" y1="25" y2="72.0146"></line><polygon fill="#000000" points="95.5,62.0146,99.5,72.0146,103.5,62.0146,99.5,66.0146" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="99.5" x2="99.5" y1="578.97" y2="610.97"></line><polygon fill="#000000" points="95.5,600.97,99.5,610.97,103.5,600.97,99.5,604.97" style="stroke:#000000;stroke-width:1.0;"></polygon><!--SRC=[Kop9ICrDLIZ8ISpCu-8gBaaiAk7YAW2IcIMP-NaAIe6Xhg6kyG7v1KeArLmA2bPFDynziNwgWezR84JO6YYOcQQWyMnoxvEzSvvrJ7ZQDTzUKm5eQXvGSCPwJQ0yKDkB_LEUpfwduEeS7npgxEmQ76mD5YykoIy0Cb9pYbCLD9vEM0PIdPgNafd61RBhvPJ6f-jcAHJvbfQaLe0qb6TavW0LmYrNUBAZ5svbPZ6oXS_NTZxTr_fixi8dkxSzxP_nihtV6c8ss0oGwI-MBmPQW6GwDaVMWi8alm00]--></g></svg></p><h2 id="进程间通信ipc">进程间通信（IPC） </h2>
<p class="plantuml"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="554px" preserveAspectRatio="none" style="width:1988px;height:554px;background:#FFFFFF;" version="1.1" viewBox="0 0 1988 554" width="1988px" zoomAndPan="magnify"><defs></defs><g><!--class RemoteRegister--><g id="elem_RemoteRegister"><rect codeline="4" fill="#FFFFFF" height="87.0439" id="RemoteRegister" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="165" x="1085.5" y="12"></rect><ellipse cx="1109.75" cy="26" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M1112.5156,27.5313 L1114.9063,28.2813 Q1114.3594,30.2656 1113.0781,31.2344 Q1111.8125,32.2031 1109.8438,32.2031 Q1107.4219,32.2031 1105.8594,30.5469 Q1104.3125,28.8906 1104.3125,26.0156 Q1104.3125,22.9844 1105.875,21.3125 Q1107.4375,19.625 1110,19.625 Q1112.2344,19.625 1113.625,20.9375 Q1114.4531,21.7188 1114.875,23.1875 L1112.4375,23.7656 Q1112.2188,22.8125 1111.5313,22.2656 Q1110.8594,21.7188 1109.875,21.7188 Q1108.5156,21.7188 1107.6719,22.7031 Q1106.8438,23.6719 1106.8438,25.8438 Q1106.8438,28.1406 1107.6719,29.125 Q1108.5,30.1094 1109.8281,30.1094 Q1110.8125,30.1094 1111.5156,29.4844 Q1112.2188,28.8594 1112.5156,27.5313 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="112" x="1124.25" y="31.5679">RemoteRegister</text><line style="stroke:#000000;stroke-width:1.0;" x1="1086.5" x2="1249.5" y1="40" y2="40"></line><rect fill="none" height="6" style="stroke:#000000;stroke-width:1.0;" width="6" x="1093.5" y="51.0073"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="101" x="1103.5" y="58.0752">mtx : MutexId</text><rect fill="none" height="6" style="stroke:#000000;stroke-width:1.0;" width="6" x="1093.5" y="68.022"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="106" x="1103.5" y="75.0898">clients : Vector</text><rect fill="none" height="6" style="stroke:#000000;stroke-width:1.0;" width="6" x="1093.5" y="85.0366"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="141" x="1103.5" y="92.1045">endpoint : Endpoint</text></g><!--class Endpoint--><g id="elem_Endpoint"><rect codeline="10" fill="#FFFFFF" height="189.1318" id="Endpoint" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="232" x="1052" y="160"></rect><ellipse cx="1132.75" cy="174" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M1135.5156,175.5313 L1137.9063,176.2813 Q1137.3594,178.2656 1136.0781,179.2344 Q1134.8125,180.2031 1132.8438,180.2031 Q1130.4219,180.2031 1128.8594,178.5469 Q1127.3125,176.8906 1127.3125,174.0156 Q1127.3125,170.9844 1128.875,169.3125 Q1130.4375,167.625 1133,167.625 Q1135.2344,167.625 1136.625,168.9375 Q1137.4531,169.7188 1137.875,171.1875 L1135.4375,171.7656 Q1135.2188,170.8125 1134.5313,170.2656 Q1133.8594,169.7188 1132.875,169.7188 Q1131.5156,169.7188 1130.6719,170.7031 Q1129.8438,171.6719 1129.8438,173.8438 Q1129.8438,176.1406 1130.6719,177.125 Q1131.5,178.1094 1132.8281,178.1094 Q1133.8125,178.1094 1134.5156,177.4844 Q1135.2188,176.8594 1135.5156,175.5313 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="63" x="1150.25" y="179.5679">Endpoint</text><line style="stroke:#000000;stroke-width:1.0;" x1="1053" x2="1283" y1="188" y2="188"></line><rect fill="none" height="6" style="stroke:#000000;stroke-width:1.0;" width="6" x="1060" y="199.0073"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="84" x="1070" y="206.0752">name : char</text><rect fill="none" height="6" style="stroke:#000000;stroke-width:1.0;" width="6" x="1060" y="216.022"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="114" x="1070" y="223.0898">routers : Vector</text><rect fill="none" height="6" style="stroke:#000000;stroke-width:1.0;" width="6" x="1060" y="233.0366"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="113" x="1070" y="240.1045">boss : ThreadId</text><rect fill="none" height="6" style="stroke:#000000;stroke-width:1.0;" width="6" x="1060" y="250.0513"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="109" x="1070" y="257.1191">deadId : uint32</text><rect fill="none" height="6" style="stroke:#000000;stroke-width:1.0;" width="6" x="1060" y="267.0659"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="88" x="1070" y="274.1338">running : int</text><rect fill="none" height="6" style="stroke:#000000;stroke-width:1.0;" width="6" x="1060" y="284.0806"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="208" x="1070" y="291.1484">registerEP : RegisterEndpoint</text><rect fill="none" height="6" style="stroke:#000000;stroke-width:1.0;" width="6" x="1060" y="301.0952"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="154" x="1070" y="308.1631">bucket : TokenBucket</text><rect fill="none" height="6" style="stroke:#000000;stroke-width:1.0;" width="6" x="1060" y="318.1099"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="148" x="1070" y="325.1777">context : IpcContext</text><rect fill="none" height="6" style="stroke:#000000;stroke-width:1.0;" width="6" x="1060" y="335.1245"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="147" x="1070" y="342.1924">identity : SvcIdentity</text></g><!--class SvcIdentity--><g id="elem_SvcIdentity"><rect codeline="22" fill="#FFFFFF" height="104.0586" id="SvcIdentity" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="571" x="210.5" y="434.5"></rect><ellipse cx="452.75" cy="448.5" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M455.5156,450.0313 L457.9063,450.7813 Q457.3594,452.7656 456.0781,453.7344 Q454.8125,454.7031 452.8438,454.7031 Q450.4219,454.7031 448.8594,453.0469 Q447.3125,451.3906 447.3125,448.5156 Q447.3125,445.4844 448.875,443.8125 Q450.4375,442.125 453,442.125 Q455.2344,442.125 456.625,443.4375 Q457.4531,444.2188 457.875,445.6875 L455.4375,446.2656 Q455.2188,445.3125 454.5313,444.7656 Q453.8594,444.2188 452.875,444.2188 Q451.5156,444.2188 450.6719,445.2031 Q449.8438,446.1719 449.8438,448.3438 Q449.8438,450.6406 450.6719,451.625 Q451.5,452.6094 452.8281,452.6094 Q453.8125,452.6094 454.5156,451.9844 Q455.2188,451.3594 455.5156,450.0313 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="79" x="470.25" y="454.0679">SvcIdentity</text><line style="stroke:#000000;stroke-width:1.0;" x1="211.5" x2="780.5" y1="462.5" y2="462.5"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="504" x="216.5" y="480.5752">handle : uint32_t //本Endpoint的boss线程ID在内核的映射后得到的一个句柄</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="559" x="216.5" y="497.5898">token : uint32_t //其它Endpoint访问本Endpoint的routers.data[token]获取Router</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="120" x="216.5" y="514.6045">cookie : uint32_t</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="332" x="216.5" y="531.6191">ipcContext : IpcContext //Linux内核的IPC上下文</text></g><!--class Router--><g id="elem_Router"><rect codeline="29" fill="#FFFFFF" height="121.0732" id="Router" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="331" x="1002.5" y="426"></rect><ellipse cx="1140.25" cy="440" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M1143.0156,441.5313 L1145.4063,442.2813 Q1144.8594,444.2656 1143.5781,445.2344 Q1142.3125,446.2031 1140.3438,446.2031 Q1137.9219,446.2031 1136.3594,444.5469 Q1134.8125,442.8906 1134.8125,440.0156 Q1134.8125,436.9844 1136.375,435.3125 Q1137.9375,433.625 1140.5,433.625 Q1142.7344,433.625 1144.125,434.9375 Q1144.9531,435.7188 1145.375,437.1875 L1142.9375,437.7656 Q1142.7188,436.8125 1142.0313,436.2656 Q1141.3594,435.7188 1140.375,435.7188 Q1139.0156,435.7188 1138.1719,436.7031 Q1137.3438,437.6719 1137.3438,439.8438 Q1137.3438,442.1406 1138.1719,443.125 Q1139,444.1094 1140.3281,444.1094 Q1141.3125,444.1094 1142.0156,443.4844 Q1142.7188,442.8594 1143.0156,441.5313 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="48" x="1157.75" y="445.5679">Router</text><line style="stroke:#000000;stroke-width:1.0;" x1="1003.5" x2="1332.5" y1="454" y2="454"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="132" x="1008.5" y="472.0752">policyNum : uint32</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="289" x="1008.5" y="489.0898">saName : SaName //{服务名字，特性名字}</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="232" x="1008.5" y="506.1045">identity : Identity //{Sid,Fid,Qid}</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="319" x="1008.5" y="523.1191">proxy : IServerProxy //服务或特性的IUnknown</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="133" x="1008.5" y="540.1338">policy : PolicyTrans</text></g><!--class IpcContext--><g id="elem_IpcContext"><rect codeline="37" fill="#FFFFFF" height="87.0439" id="IpcContext" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="323" x="1658.5" y="443"></rect><ellipse cx="1777.25" cy="457" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M1780.0156,458.5313 L1782.4063,459.2813 Q1781.8594,461.2656 1780.5781,462.2344 Q1779.3125,463.2031 1777.3438,463.2031 Q1774.9219,463.2031 1773.3594,461.5469 Q1771.8125,459.8906 1771.8125,457.0156 Q1771.8125,453.9844 1773.375,452.3125 Q1774.9375,450.625 1777.5,450.625 Q1779.7344,450.625 1781.125,451.9375 Q1781.9531,452.7188 1782.375,454.1875 L1779.9375,454.7656 Q1779.7188,453.8125 1779.0313,453.2656 Q1778.3594,452.7188 1777.375,452.7188 Q1776.0156,452.7188 1775.1719,453.7031 Q1774.3438,454.6719 1774.3438,456.8438 Q1774.3438,459.1406 1775.1719,460.125 Q1776,461.1094 1777.3281,461.1094 Q1778.3125,461.1094 1779.0156,460.4844 Q1779.7188,459.8594 1780.0156,458.5313 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="78" x="1794.75" y="462.5679">IpcContext</text><line style="stroke:#000000;stroke-width:1.0;" x1="1659.5" x2="1980.5" y1="471" y2="471"></line><rect fill="none" height="6" style="stroke:#000000;stroke-width:1.0;" width="6" x="1666.5" y="482.0073"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="135" x="1676.5" y="489.0752">fd : int //文件描述符</text><rect fill="none" height="6" style="stroke:#000000;stroke-width:1.0;" width="6" x="1666.5" y="499.022"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="269" x="1676.5" y="506.0898">mmapSize : size_t //Memory Map Size</text><rect fill="none" height="6" style="stroke:#000000;stroke-width:1.0;" width="6" x="1666.5" y="516.0366"></rect><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="299" x="1676.5" y="523.1045">mmapAddr : void* //Memory Map Address</text></g><g id="elem_GMN11"><path d="M11,473.5 L11,499.2993 A0,0 0 0 0 11,499.2993 L175,499.2993 A0,0 0 0 0 175,499.2993 L175,491.5 L210.33,486.5 L175,483.5 L175,483.5 L165,473.5 L11,473.5 A0,0 0 0 0 11,473.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M165,473.5 L165,483.5 L175,483.5 L165,473.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="143" x="17" y="491.5698">本Endpooint的身份信息</text></g><g id="elem_GMN14"><path d="M813.5,233.5 L813.5,275.0986 A0,0 0 0 0 813.5,275.0986 L1016.5,275.0986 A0,0 0 0 0 1016.5,275.0986 L1016.5,258.5 L1051.94,254.5 L1016.5,250.5 L1016.5,243.5 L1006.5,233.5 L813.5,233.5 A0,0 0 0 0 813.5,233.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M1006.5,233.5 L1006.5,243.5 L1016.5,243.5 L1006.5,233.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="174" x="819.5" y="251.5698">每个进程对应一个Endpoint，</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="182" x="819.5" y="267.3691">用以维护boss线程，其用以IPC</text></g><g id="elem_GMN17"><path d="M1368.5,473.5 L1368.5,482.5 L1333.6,486.5 L1368.5,490.5 L1368.5,499.2993 A0,0 0 0 0 1368.5,499.2993 L1623.5,499.2993 A0,0 0 0 0 1623.5,499.2993 L1623.5,483.5 L1613.5,473.5 L1368.5,473.5 A0,0 0 0 0 1368.5,473.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M1613.5,473.5 L1613.5,483.5 L1623.5,483.5 L1613.5,473.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="234" x="1374.5" y="491.5698">某个进程对外提供服务或特性的服务单元</text></g><g id="elem_GMN20"><path d="M1286,42.5 L1286,51.5 L1250.76,55.5 L1286,59.5 L1286,68.2993 A0,0 0 0 0 1286,68.2993 L1578,68.2993 A0,0 0 0 0 1578,68.2993 L1578,52.5 L1568,42.5 L1286,42.5 A0,0 0 0 0 1286,42.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M1568,42.5 L1568,52.5 L1578,52.5 L1568,42.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="271" x="1292" y="60.5698">每个进程维护一个g_remoteRegister全局变量</text></g><path d="M816.5,468.5 L816.5,494.2993 A0,0 0 0 0 816.5,494.2993 L967.5,494.2993 A0,0 0 0 0 967.5,494.2993 L967.5,486.5 L1006.5,517.5513 L967.5,478.5 L967.5,478.5 L957.5,468.5 L816.5,468.5 A0,0 0 0 0 816.5,468.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M957.5,468.5 L957.5,478.5 L967.5,478.5 L957.5,468.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="130" x="822.5" y="486.5698">对外提供的服务或特性</text><path d="M1319,185 L1319,193.8997 L1154,200.5073 L1319,201.8997 L1319,210.7993 A0,0 0 0 0 1319,210.7993 L1745,210.7993 A0,0 0 0 0 1745,210.7993 L1745,195 L1735,185 L1319,185 A0,0 0 0 0 1319,185 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M1735,185 L1735,195 L1745,195 L1735,185 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="405" x="1325" y="203.0698">客户端Endpoint的名字为ipc client,samgr Endpoint的名字为samgr</text><path d="M1319,220.7993 L1319,229.699 L1183,234.5366 L1319,237.699 L1319,246.5986 A0,0 0 0 0 1319,246.5986 L1566,246.5986 A0,0 0 0 0 1566,246.5986 L1566,230.7993 L1556,220.7993 L1319,220.7993 A0,0 0 0 0 1319,220.7993 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M1556,220.7993 L1556,230.7993 L1566,230.7993 L1556,220.7993 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="226" x="1325" y="238.8691">Endpoint用于进程间通信的线程的句柄</text><path d="M1319,256.5986 L1319,281.2976 L1278,285.5806 L1319,289.2976 L1319,313.9966 A0,0 0 0 0 1319,313.9966 L1675,313.9966 A0,0 0 0 0 1675,313.9966 L1675,266.5986 L1665,256.5986 L1319,256.5986 A0,0 0 0 0 1319,256.5986 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M1665,256.5986 L1665,266.5986 L1675,266.5986 L1665,256.5986 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="335" x="1325" y="274.6685">函数指针指向Enpoint向服务管理者注册自己的注册函数，</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="285" x="1325" y="290.4678">客户端Endpoint为RegisterRemoteEndpoint(),</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="277" x="1325" y="306.2671">samgr Endpoint为RegisterSamgrEndpoint()</text><!--link RemoteRegister to Endpoint--><g id="link_RemoteRegister_Endpoint"><path codeline="43" d="M1168,99.25 C1168,117.13 1168,126.66 1168,147.89 " fill="none" id="RemoteRegister-to-Endpoint" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="1168,159.89,1172,153.89,1168,147.89,1164,153.89,1168,159.89" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link Endpoint to SvcIdentity--><g id="link_Endpoint_SvcIdentity"><path codeline="44" d="M1051.8,340.13 C1045.88,343.31 1039.93,346.29 1034,349 C979.28,374.02 861.6213,404.4056 743.4713,431.7356 " fill="none" id="Endpoint-to-SvcIdentity" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="731.78,434.44,738.5271,436.9849,743.4713,431.7356,736.7242,429.1907,731.78,434.44" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link Endpoint to IpcContext--><g id="link_Endpoint_IpcContext"><path codeline="45" d="M1284.38,340.94 C1289.9,343.83 1295.45,346.54 1301,349 C1442.62,411.86 1491.75,384.4 1641,426 C1659.3,431.1 1667.0591,433.2882 1685.8091,439.2782 " fill="none" id="Endpoint-to-IpcContext" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="1697.24,442.93,1692.7418,437.2938,1685.8091,439.2782,1690.3073,444.9144,1697.24,442.93" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link Endpoint to Router--><g id="link_Endpoint_Router"><path codeline="46" d="M1168,349.05 C1168,374.92 1168,390.29 1168,413.67 " fill="none" id="Endpoint-to-Router" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="1168,425.67,1172,419.67,1168,413.67,1164,419.67,1168,425.67" style="stroke:#000000;stroke-width:1.0;"></polygon><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="101" x="1169" y="393.0698">routers.data[x]</text></g><!--SRC=[ZLHTJnD157tVNp6-gG59zArlYfWq4O8KVJ66hBj3kw4xs-nkiMXCQgGM4MWrK8oG00QK-54m6gb5xP_PcMsV_0lUcTcFBcYqITkPU- -SU-wTS-UCcyCcHeMyQX0bP-WOORFWpY4JctUnxIYAbbST1qrWqtBn1CuQZejjz411y1b4fbj2AJHQT74fhGSsBMzWuZfWluKrrx83CoPwmJA82_QHOAay3E53ImHCL22LGbfE3S_R5cInJy7UjHnkcypPMDKZ3hhOWBq8e9SkXX15GWoI1JDF7jY2aaR6mHpM5n4CSXIr6So9Jrepc5mHkx1OYq3jt9SkQCDo4xYWbyGre9Kfb9dLqi4khhdF69ITKucUnn7hAHSD3R7D3o4R_zKyhzPlT_pzP-chT7EVFgcmxHROsSjjUZXFwolqvpfTE0IBrofxhNUqjiUsvWMuoxadiMdbAsq-3k6xpKvllPdC5pJzWgwwwcs1SAUxSaHhZGdX4C2QPSqO_Qo5rOZQaUWDPBrka68fOfuU7_PQYrxh6MjKuzv8-A0j1IjlQ7DZHJFAWOJTKSUaIZ9oCJJqW6qkqyKTMb-c7zT_VL_odtvZvRTo-r3IYYybQZwSonZwm3NutZ1q6LUmhP88oc1x5jlZOijlW-EpXOP4vlnlaXbYtIDzJE7Ok5XCsYfnugBYBeGgdzQb5Zboe-eTVsMrMhTpw7zu4ywNgHOondrUf0D_ujP6OHJjEJIg5X1tzKLUrdKR8cSjGp-V3EGUx0Wk9oPvSF1yF8_H679hGhL9Jv_MauxWtb8e8PpI7KKXa1JbyRIBhEa4SYYuG77Tzdll-8VNsM6F3XHuCn0_c3mTqMK7DT1ujxC1yq0Flj7sgbHz600AKFpLVUzupp_-mXPtu-a13uXV-a219nBPHZOdCWKgPrlrH9xT1glLlPyRfzKGw6zvZLOU_nKqSG698YHDMKHsoau4qie-_LIcjPUzQYs6JdP6yasbX7gLVgeHjuZjIOo8NzYzL8e_mWfjlcOBH_xxWxvdGKwKrsh3b0Vl_O2ZcbaR_Ib8UFuZdNZA8q7noscloBxqrh_qogz0500hBv3ZoxVjtxYdNdLQ_S7M3jbIjVTY0Nvf_Va84HvOoIxvpHs__gHRhh3FyCWkTQllwD4dtaEnbUUvkaur1yeDqybx3XrdpmqeoHRrXMQu8uwCQleD]--></g></svg></p><h3 id="ipc概要">IPC概要 </h3>
<p class="plantuml"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="148px" preserveAspectRatio="none" style="width:617px;height:148px;background:#FFFFFF;" version="1.1" viewBox="0 0 617 148" width="617px" zoomAndPan="magnify"><defs></defs><g><!--class Endpoint--><g id="elem_Endpoint"><rect codeline="4" fill="#FFFFFF" height="28" id="Endpoint" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="91" x="382.5" y="12"></rect><ellipse cx="395.5" cy="26" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M398.2656,27.5313 L400.6563,28.2813 Q400.1094,30.2656 398.8281,31.2344 Q397.5625,32.2031 395.5938,32.2031 Q393.1719,32.2031 391.6094,30.5469 Q390.0625,28.8906 390.0625,26.0156 Q390.0625,22.9844 391.625,21.3125 Q393.1875,19.625 395.75,19.625 Q397.9844,19.625 399.375,20.9375 Q400.2031,21.7188 400.625,23.1875 L398.1875,23.7656 Q397.9688,22.8125 397.2813,22.2656 Q396.6094,21.7188 395.625,21.7188 Q394.2656,21.7188 393.4219,22.7031 Q392.5938,23.6719 392.5938,25.8438 Q392.5938,28.1406 393.4219,29.125 Q394.25,30.1094 395.5781,30.1094 Q396.5625,30.1094 397.2656,29.4844 Q397.9688,28.8594 398.2656,27.5313 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="63" x="407.5" y="31.5679">Endpoint</text></g><!--class SamgrEP--><g id="elem_SamgrEP"><rect codeline="7" fill="#FFFFFF" height="28" id="SamgrEP" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="91" x="252.5" y="107"></rect><ellipse cx="265.5" cy="121" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M268.2656,122.5313 L270.6563,123.2813 Q270.1094,125.2656 268.8281,126.2344 Q267.5625,127.2031 265.5938,127.2031 Q263.1719,127.2031 261.6094,125.5469 Q260.0625,123.8906 260.0625,121.0156 Q260.0625,117.9844 261.625,116.3125 Q263.1875,114.625 265.75,114.625 Q267.9844,114.625 269.375,115.9375 Q270.2031,116.7188 270.625,118.1875 L268.1875,118.7656 Q267.9688,117.8125 267.2813,117.2656 Q266.6094,116.7188 265.625,116.7188 Q264.2656,116.7188 263.4219,117.7031 Q262.5938,118.6719 262.5938,120.8438 Q262.5938,123.1406 263.4219,124.125 Q264.25,125.1094 265.5781,125.1094 Q266.5625,125.1094 267.2656,124.4844 Q267.9688,123.8594 268.2656,122.5313 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="63" x="277.5" y="126.5679">SamgrEP</text></g><!--class IpcClientA--><g id="elem_IpcClientA"><rect codeline="10" fill="#FFFFFF" height="28" id="IpcClientA" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="98" x="379" y="107"></rect><ellipse cx="392" cy="121" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M394.7656,122.5313 L397.1563,123.2813 Q396.6094,125.2656 395.3281,126.2344 Q394.0625,127.2031 392.0938,127.2031 Q389.6719,127.2031 388.1094,125.5469 Q386.5625,123.8906 386.5625,121.0156 Q386.5625,117.9844 388.125,116.3125 Q389.6875,114.625 392.25,114.625 Q394.4844,114.625 395.875,115.9375 Q396.7031,116.7188 397.125,118.1875 L394.6875,118.7656 Q394.4688,117.8125 393.7813,117.2656 Q393.1094,116.7188 392.125,116.7188 Q390.7656,116.7188 389.9219,117.7031 Q389.0938,118.6719 389.0938,120.8438 Q389.0938,123.1406 389.9219,124.125 Q390.75,125.1094 392.0781,125.1094 Q393.0625,125.1094 393.7656,124.4844 Q394.4688,123.8594 394.7656,122.5313 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="70" x="404" y="126.5679">IpcClientA</text></g><!--class IpcClientB--><g id="elem_IpcClientB"><rect codeline="13" fill="#FFFFFF" height="28" id="IpcClientB" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="98" x="512" y="107"></rect><ellipse cx="525" cy="121" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M527.7656,122.5313 L530.1563,123.2813 Q529.6094,125.2656 528.3281,126.2344 Q527.0625,127.2031 525.0938,127.2031 Q522.6719,127.2031 521.1094,125.5469 Q519.5625,123.8906 519.5625,121.0156 Q519.5625,117.9844 521.125,116.3125 Q522.6875,114.625 525.25,114.625 Q527.4844,114.625 528.875,115.9375 Q529.7031,116.7188 530.125,118.1875 L527.6875,118.7656 Q527.4688,117.8125 526.7813,117.2656 Q526.1094,116.7188 525.125,116.7188 Q523.7656,116.7188 522.9219,117.7031 Q522.0938,118.6719 522.0938,120.8438 Q522.0938,123.1406 522.9219,124.125 Q523.75,125.1094 525.0781,125.1094 Q526.0625,125.1094 526.7656,124.4844 Q527.4688,123.8594 527.7656,122.5313 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="70" x="537" y="126.5679">IpcClientB</text></g><g id="elem_GMN9"><path d="M11,100 L11,141.5986 A0,0 0 0 0 11,141.5986 L217,141.5986 A0,0 0 0 0 217,141.5986 L217,125 L252.2,121 L217,117 L217,110 L207,100 L11,100 A0,0 0 0 0 11,100 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M207,100 L207,110 L217,110 L207,100 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="52" x="17" y="118.0698">全局唯一</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="185" x="17" y="133.8691">由SamgrServer g_server维护</text></g><!--reverse link Endpoint to SamgrEP--><g id="link_Endpoint_SamgrEP"><path d="M395.0084,50.6001 C370.2284,68.3201 340.98,89.25 316.26,106.94 " fill="none" id="Endpoint-backto-SamgrEP" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="none" points="409.65,40.13,391.5184,45.7196,398.4984,55.4806,409.65,40.13" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--reverse link Endpoint to IpcClientA--><g id="link_Endpoint_IpcClientA"><path d="M428,58.32 C428,76.1 428,89.39 428,107 " fill="none" id="Endpoint-backto-IpcClientA" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="none" points="428,40.32,422,58.32,434,58.32,428,40.32" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--reverse link Endpoint to IpcClientB--><g id="link_Endpoint_IpcClientB"><path d="M461.523,50.4426 C486.873,68.1626 517.02,89.25 542.32,106.94 " fill="none" id="Endpoint-backto-IpcClientB" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="none" points="446.77,40.13,458.0855,55.3602,464.9605,45.5249,446.77,40.13" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--SRC=[Kop9ICrDLIZ8ISpCuyh8J4bLICqjAAbKo4tDJKejAkRYIiv9B2vMSCrBASZFp2jHgEQgXOa59-Qc5xa6AAHMbAJcfM1NurcGx9oJcPfNuaYSCYSSolBoIr8LSbBJIXJoqs0MSprjNV5qOyFJAUkVx6ZWUZvb8rWyEBMeBBL88Js-6CnuldlBiwubN40Z5K1c0000]--></g></svg></p><p class="plantuml"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="168px" preserveAspectRatio="none" style="width:441px;height:168px;background:#FFFFFF;" version="1.1" viewBox="0 0 441 168" width="441px" zoomAndPan="magnify"><defs></defs><g><!--class SamgrEP--><g id="elem_SamgrEP"><rect codeline="4" fill="#FFFFFF" height="28" id="SamgrEP" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="91" x="83.5" y="133"></rect><ellipse cx="96.5" cy="147" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M99.2656,148.5313 L101.6563,149.2813 Q101.1094,151.2656 99.8281,152.2344 Q98.5625,153.2031 96.5938,153.2031 Q94.1719,153.2031 92.6094,151.5469 Q91.0625,149.8906 91.0625,147.0156 Q91.0625,143.9844 92.625,142.3125 Q94.1875,140.625 96.75,140.625 Q98.9844,140.625 100.375,141.9375 Q101.2031,142.7188 101.625,144.1875 L99.1875,144.7656 Q98.9688,143.8125 98.2813,143.2656 Q97.6094,142.7188 96.625,142.7188 Q95.2656,142.7188 94.4219,143.7031 Q93.5938,144.6719 93.5938,146.8438 Q93.5938,149.1406 94.4219,150.125 Q95.25,151.1094 96.5781,151.1094 Q97.5625,151.1094 98.2656,150.4844 Q98.9688,149.8594 99.2656,148.5313 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="63" x="108.5" y="152.5679">SamgrEP</text></g><!--class IpcClientA--><g id="elem_IpcClientA"><rect codeline="7" fill="#FFFFFF" height="28" id="IpcClientA" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="98" x="12" y="12"></rect><ellipse cx="25" cy="26" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M27.7656,27.5313 L30.1563,28.2813 Q29.6094,30.2656 28.3281,31.2344 Q27.0625,32.2031 25.0938,32.2031 Q22.6719,32.2031 21.1094,30.5469 Q19.5625,28.8906 19.5625,26.0156 Q19.5625,22.9844 21.125,21.3125 Q22.6875,19.625 25.25,19.625 Q27.4844,19.625 28.875,20.9375 Q29.7031,21.7188 30.125,23.1875 L27.6875,23.7656 Q27.4688,22.8125 26.7813,22.2656 Q26.1094,21.7188 25.125,21.7188 Q23.7656,21.7188 22.9219,22.7031 Q22.0938,23.6719 22.0938,25.8438 Q22.0938,28.1406 22.9219,29.125 Q23.75,30.1094 25.0781,30.1094 Q26.0625,30.1094 26.7656,29.4844 Q27.4688,28.8594 27.7656,27.5313 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="70" x="37" y="31.5679">IpcClientA</text></g><!--class IpcClientB--><g id="elem_IpcClientB"><rect codeline="10" fill="#FFFFFF" height="28" id="IpcClientB" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="98" x="149" y="12"></rect><ellipse cx="162" cy="26" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M164.7656,27.5313 L167.1563,28.2813 Q166.6094,30.2656 165.3281,31.2344 Q164.0625,32.2031 162.0938,32.2031 Q159.6719,32.2031 158.1094,30.5469 Q156.5625,28.8906 156.5625,26.0156 Q156.5625,22.9844 158.125,21.3125 Q159.6875,19.625 162.25,19.625 Q164.4844,19.625 165.875,20.9375 Q166.7031,21.7188 167.125,23.1875 L164.6875,23.7656 Q164.4688,22.8125 163.7813,22.2656 Q163.1094,21.7188 162.125,21.7188 Q160.7656,21.7188 159.9219,22.7031 Q159.0938,23.6719 159.0938,25.8438 Q159.0938,28.1406 159.9219,29.125 Q160.75,30.1094 162.0781,30.1094 Q163.0625,30.1094 163.7656,29.4844 Q164.4688,28.8594 164.7656,27.5313 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="70" x="174" y="31.5679">IpcClientB</text></g><!--link IpcClientA to SamgrEP--><g id="link_IpcClientA_SamgrEP"><path codeline="13" d="M56.56,40.07 C51.98,56.03 46.92,83.33 58,103 C65.57,116.43 73.8596,123.4346 87.1796,130.1946 " fill="none" id="IpcClientA-to-SamgrEP" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="92.53,132.91,86.3146,125.27,88.0713,130.6472,82.6942,132.4039,92.53,132.91" style="stroke:#000000;stroke-width:1.0;"></polygon><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="89" x="62" y="84.0698">注册boss的Tid</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="95" x="59" y="99.8691">注册Router列表</text></g><!--link IpcClientB to SamgrEP--><g id="link_IpcClientB_SamgrEP"><path codeline="14" d="M191.9,40.2 C184.63,55.59 171.84,81.65 159,103 C152.81,113.3 148.5546,119.5616 142.4746,127.9016 " fill="none" id="IpcClientB-to-SamgrEP" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="138.94,132.75,147.4741,127.8338,141.8855,128.7097,141.0096,123.121,138.94,132.75" style="stroke:#000000;stroke-width:1.0;"></polygon><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="255" x="178" y="84.0698">查询IpcClientA的handle，Router的token</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="74" x="268.5" y="99.8691">而后进行IPC</text></g><!--SRC=[Kop9ICrDLIZ8ISpCuyh8J4bLICqjAAbKo4tDJKejAkRYIiv9B2vM24xCJIzo3L1GgEQgXObv5YGxvsIcvfKuOXLrWeWYgT9DoI_FqxM36sQby6ppYgTjFKdvnSNFPxM4PAR4v454Wl9BIrABddPCVx5m1HUIYLXCcB_qnVf524k0vcGavgNafBxV0pK5A5AIdvsQ5vFteg7dwOI-5_jdlrZOundW3000]--></g></svg></p><h3 id="endpoint注册流程">Endpoint注册流程 </h3>
<p class="plantuml"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="1402px" preserveAspectRatio="none" style="width:512px;height:1402px;background:#FFFFFF;" version="1.1" viewBox="0 0 512 1402" width="512px" zoomAndPan="magnify"><defs></defs><g><rect fill="#FFFFFF" height="49.168" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="348" x="82" y="6"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="204" x="92" y="28.0645">服务或特性初始化时其消息队列会收到</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="328" x="92" y="42.6484">MSG_DIRECT的消息，该消息由HandleInitRequest()处理</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="349" x="81.5" y="75.168"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="329" x="91.5" y="97.2324">调用DEFAULT_Initialize(serviceImpl)初始化各服务和特性</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="368" x="72" y="129.752"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="348" x="82" y="151.8164">调用服务的生命周期函数Initialize()、OnInitialize()进行初始化</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="317" x="97.5" y="184.3359"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="297" x="107.5" y="206.4004">调用SAMGR_RegisterServiceApi()进行服务接口注册</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="270" x="121" y="238.9199"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="250" x="131" y="260.9844">InitializeRegistry()初始化RemoteRegister</text><rect fill="#FFFFFF" height="370.1172" style="stroke:#000000;stroke-width:1.0;" width="498" x="7" y="283.5039"></rect><path d="M171,283.5039 L171,293.5186 L161,303.5186 L7,303.5186 " fill="none" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="154" x="10" y="298.5791">初始化RemoteRegister</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="220" x="146" y="320.5186"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="200" x="156" y="342.583">调用MUTEX_InitValue()创建互斥量</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="221" x="145.5" y="375.1025"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="201" x="155.5" y="397.167">调用VECTOR_Make()创建空Vector</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="386" x="63" y="429.6865"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="366" x="73" y="451.751">调用SAMGR_CreateEndpoint()创建名为"ipc client"的Endpoint</text><rect fill="#FFFFFF" height="167.3506" style="stroke:#000000;stroke-width:1.0;" width="478" x="17" y="474.2705"></rect><path d="M132,474.2705 L132,484.2852 L122,494.2852 L17,494.2852 " fill="none" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="105" x="20" y="489.3457">初始化Endpoint</text><rect fill="#FFFFFF" height="49.168" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="342" x="85" y="511.2852"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="241" x="95" y="533.3496">调用OpenLiteIpc()初始化context该函数，</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="322" x="95" y="547.9336">包含打开设备驱动文件(如/dev/binder）,创建内存映射两步</text><rect fill="#FFFFFF" height="49.168" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="458" x="27" y="580.4531"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="438" x="37" y="602.5176">初始化其它成员变量，boss、identity的成员变量置为Null或INVALID_INDEX，</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="204" x="37" y="617.1016">它们将在后续步骤中进行真正的初始化</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="237" x="137.5" y="673.6211"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="217" x="147.5" y="695.6855">调用SAMGR_AddRouter()注册Router</text><rect fill="#FFFFFF" height="236.5186" style="stroke:#000000;stroke-width:1.0;" width="402" x="55" y="718.2051"></rect><path d="M141,718.2051 L141,728.2197 L131,738.2197 L55,738.2197 " fill="none" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="76" x="58" y="733.2803">注册Router</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="338" x="87" y="755.2197"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="318" x="97" y="777.2842">为服务或特性对外提供的接口创建一个Router对象并初始化</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="322" x="95" y="809.8037"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="302" x="105" y="831.8682">将Router对象的指针添加到endpoint-&gt;routers向量中</text><rect fill="#FFFFFF" height="78.3359" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="382" x="65" y="864.3877"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="362" x="75" y="886.4521">调用Listen()为当前EndPoint创建boss线程并开始监听消息队列，</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="194" x="75" y="901.0361">使用THREAD_Create()新建线程，</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="339" x="75" y="915.6201">线程优先级为PRI_ABOVE_NORMAL,高于普通线程的优先级，</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="154" x="75" y="930.2041">其线程入口函数为Receive()</text><rect fill="#FFFFFF" height="431.4531" style="stroke:#000000;stroke-width:1.0;" width="500" x="6" y="964.7236"></rect><path d="M184,964.7236 L184,974.7383 L174,984.7383 L6,984.7383 " fill="none" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="168" x="9" y="979.7988">boss线程的Receive()函数</text><rect fill="#FFFFFF" height="167.3506" style="stroke:#000000;stroke-width:1.0;" width="480" x="16" y="994.7383"></rect><path d="M145,994.7383 L145,1004.7529 L135,1014.7529 L16,1014.7529 " fill="none" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="119" x="19" y="1009.8135">远程注册Endpoint</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="442" x="35" y="1031.7529"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="422" x="45" y="1053.8174">对于客户端Endpoint，调用RegisterRemoteEndpoint()远程注册Endpoint</text><rect fill="#FFFFFF" height="63.752" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="460" x="26" y="1086.3369"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="381" x="36" y="1108.4014">新生成的客户端Endpoint向服务管理者SamgrServer g_server注册,</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="265" x="36" y="1122.9854">通过Transact()函数发送IPC消息给samgr EP，</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="440" x="36" y="1137.5693">将Endpoint加入到其g_server.store-&gt;maps[]中并获取SvcIdentity的handle</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="245" x="133.5" y="1182.0889"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="225" x="143.5" y="1204.1533">如果反复注册失败，则调用exit()函数退出</text><rect fill="#FFFFFF" height="63.752" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="358" x="77" y="1236.6729"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="338" x="87" y="1258.7373">如果Endpoint注册成功，将endpoint-&gt;running标记为TRUE</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="330" x="87" y="1273.3213">并调用RegisterRemoteFeatures()远程注册Endpoint特性</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="268" x="87" y="1287.9053">(即客户端Endpoint的routers向量中的所有元素)</text><rect fill="#FFFFFF" height="63.752" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="348" x="82" y="1320.4248"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="262" x="92" y="1342.4893">执行StartLoop()函数，进入监听IPC消息的状态</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="245" x="92" y="1357.0732">如果其它进程向当前handle发送了IPC消息，</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="328" x="92" y="1371.6572">其会调用Dispatch()函数处理消息，以此对其他进程提供服务</text><line style="stroke:#000000;stroke-width:1.0;" x1="256" x2="256" y1="55.168" y2="75.168"></line><polygon fill="#000000" points="252,65.168,256,75.168,260,65.168,256,69.168" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="256" x2="256" y1="109.752" y2="129.752"></line><polygon fill="#000000" points="252,119.752,256,129.752,260,119.752,256,123.752" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="256" x2="256" y1="164.3359" y2="184.3359"></line><polygon fill="#000000" points="252,174.3359,256,184.3359,260,174.3359,256,178.3359" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="256" x2="256" y1="218.9199" y2="238.9199"></line><polygon fill="#000000" points="252,228.9199,256,238.9199,260,228.9199,256,232.9199" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="256" x2="256" y1="355.1025" y2="375.1025"></line><polygon fill="#000000" points="252,365.1025,256,375.1025,260,365.1025,256,369.1025" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="256" x2="256" y1="409.6865" y2="429.6865"></line><polygon fill="#000000" points="252,419.6865,256,429.6865,260,419.6865,256,423.6865" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="256" x2="256" y1="560.4531" y2="580.4531"></line><polygon fill="#000000" points="252,570.4531,256,580.4531,260,570.4531,256,574.4531" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="256" x2="256" y1="464.2705" y2="511.2852"></line><polygon fill="#000000" points="252,501.2852,256,511.2852,260,501.2852,256,505.2852" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="256" x2="256" y1="273.5039" y2="320.5186"></line><polygon fill="#000000" points="252,310.5186,256,320.5186,260,310.5186,256,314.5186" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="256" x2="256" y1="629.6211" y2="673.6211"></line><polygon fill="#000000" points="252,663.6211,256,673.6211,260,663.6211,256,667.6211" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="256" x2="256" y1="789.8037" y2="809.8037"></line><polygon fill="#000000" points="252,799.8037,256,809.8037,260,799.8037,256,803.8037" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="256" x2="256" y1="844.3877" y2="864.3877"></line><polygon fill="#000000" points="252,854.3877,256,864.3877,260,854.3877,256,858.3877" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="256" x2="256" y1="708.2051" y2="755.2197"></line><polygon fill="#000000" points="252,745.2197,256,755.2197,260,745.2197,256,749.2197" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="256" x2="256" y1="1066.3369" y2="1086.3369"></line><polygon fill="#000000" points="252,1076.3369,256,1086.3369,260,1076.3369,256,1080.3369" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="256" x2="256" y1="1150.0889" y2="1182.0889"></line><polygon fill="#000000" points="252,1172.0889,256,1182.0889,260,1172.0889,256,1176.0889" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="256" x2="256" y1="1216.6729" y2="1236.6729"></line><polygon fill="#000000" points="252,1226.6729,256,1236.6729,260,1226.6729,256,1230.6729" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="256" x2="256" y1="1300.4248" y2="1320.4248"></line><polygon fill="#000000" points="252,1310.4248,256,1320.4248,260,1310.4248,256,1314.4248" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="256" x2="256" y1="942.7236" y2="1031.7529"></line><polygon fill="#000000" points="252,1021.7529,256,1031.7529,260,1021.7529,256,1025.7529" style="stroke:#000000;stroke-width:1.0;"></polygon><!--SRC=[TLPTRzfc5BxVhs2z0YbTxrkf4ajeYqG-14bKQPgG2wyIQyGmsqJjhfmbVAKG8CqeITYIhB2aJI54hKW2fFoO-Ro6g_w57Vl5ng6CAsoVyxpFUSvpZlszl4hMY2CMuNZXEmV-7j9A3hPFQBgaPMweSWhfF-7qDMHBz6qB4YtQIjEDYq7v2D9lrUu1tMj1kcaapWQU1cUyVi_qedQmnSA-ThFzYnhxh-rTFkE4S8Hu1Lxsar_ZH9ATBgXkQONa8tPolxcfxPtDU9wubtoBGJsEvoByRyGf4N6T3n7lMYpYilX0OOjHXTqiete7XZr3AjhU4HHleOXtZY1rI_zesf1T_oeRyuBzHhzts3_9MgVSmGouPv_wWtwomaio4GECbJl6crb3wNPga7z7Fvr1CZjC7nt0aiLNpb4XVh8MbOc9oZ9Mn6WyvlYV43kbsQL5ptD3gsKk4YSwx25qscfxbvPgWrJ-3lzbRCwyFpZB_M85Qk_RooGaHyK9XKwBX9E9HmZ7ehmWcnbGoAdNxNjyBEG8HNWYoFTGP3De8dlpeVs4-HWHVBnClB6GJOfGL939InbDmpg51ZAI89k0mZdDl86kqczyWMfgyFuIjizeAQLsMaxuv_S7ORB-u0KlX8dujPkP6b9D9g1UfkLZQ6wfrrLQhmsh79aeqOB69aqNe5Y6V1a5moDVH2K9VS67iJXUVgNRsHQWtJQm_hbu988pufrRTlkyCq7lt8pdkSMsiQbsFa8p2PKpAEnedJgUFFXGLQ_hp2TQvOZMto7kcCs846RQZLrzsnftEEoFnj4BJXSp6hkoos-_pm2GzlXmNzn0jKJp1VNBeLwcuToXWwuLzVe3IyUm_kK9tBJ6nm9hj4Ve4DdKO3TDhpgmVOoRWGnRV_-nQCH9K2YYXgZ47R_vT5yBJXSoXDitaCcXPHRqFCP5RuZMxcbdhtKENGKvQ8T5A7oqRoDJVVMsXuYBp_mUzypGmYXIgQcRtS0m0zcLsYr38gsrJ_7i1RytwFvnVjaJd9ltpxfzKuFpijhUeVkDWNB0mh54AyFgTw8rP9Smz3EiYt1-4YByEfu-gRkiIQFA4DYAPmYsi7wlWY6ietUd2OL7Xj3ucwQljFCByw6-UGrbpPt1DiXebYSX3bk2Mk7EHClh1Xq7nluDDslZ13TtNqa4kBKLOnSIqR4Ib8m_37VAm4Ff-htKeiW94XUIpU8WNnme6zw5wU7ReRClwJWEpuAbQZDf7OfUGcdJJLJQFE872PSMkVzuZOj9F_sCXa9hz7Uk85yAh8Uyez5TDLuwaphm4DS6_Qi2-HnKSumnL2_xdsl80DBxJ3_oahSu3nG5Kkr7zcIJ8KlNryJsaPxUJDgS7nS4NbYXnwb-GxV5ed_9mof4nXEQz0Gj6nU9DBb9R72DV2VaFdtJ82nvVDJqiSmej9A1nARs-TXbzZbpYhie87EYx8j6OsQLkdLwXwWt6x5HY_1LkjsYoWRZphGprYU6w-Ol5DdiCiLPWzLsqWAmZGj-EGnVzhmKu-JGgcKButl0YbSxDLglwbiASpebTX1RLyo5Ottz3m00]--></g></svg></p><h3 id="samgr-endpoint">samgr Endpoint </h3>
<p class="plantuml"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="612px" preserveAspectRatio="none" style="width:862px;height:612px;background:#FFFFFF;" version="1.1" viewBox="0 0 862 612" width="862px" zoomAndPan="magnify"><defs></defs><g><!--class SamgrServer--><g id="elem_SamgrServer"><rect codeline="4" fill="#FFFFFF" height="248.1758" id="SamgrServer" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="193" x="79" y="12"></rect><ellipse cx="125.75" cy="26" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M128.5156,27.5313 L130.9063,28.2813 Q130.3594,30.2656 129.0781,31.2344 Q127.8125,32.2031 125.8438,32.2031 Q123.4219,32.2031 121.8594,30.5469 Q120.3125,28.8906 120.3125,26.0156 Q120.3125,22.9844 121.875,21.3125 Q123.4375,19.625 126,19.625 Q128.2344,19.625 129.625,20.9375 Q130.4531,21.7188 130.875,23.1875 L128.4375,23.7656 Q128.2188,22.8125 127.5313,22.2656 Q126.8594,21.7188 125.875,21.7188 Q124.5156,21.7188 123.6719,22.7031 Q122.8438,23.6719 122.8438,25.8438 Q122.8438,28.1406 123.6719,29.125 Q124.5,30.1094 125.8281,30.1094 Q126.8125,30.1094 127.5156,29.4844 Q128.2188,28.8594 128.5156,27.5313 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="92" x="143.25" y="31.5679">SamgrServer</text><line style="stroke:#000000;stroke-width:1.0;" x1="80" x2="271" y1="40" y2="40"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="112" x="85" y="58.0752">identity:Identity</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="118" x="85" y="75.0898">samgr: Endpoint</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="96" x="85" y="92.1045">mtx: MutexId</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="107" x="85" y="109.1191">store: SAStore</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="181" x="85" y="126.1338">ipcAuth: IpcAuthInterface</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="145" x="85" y="143.1484">sysCapMtx: MutexId</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="156" x="85" y="160.1631">sysCapabilitys: Vector</text><line style="stroke:#000000;stroke-width:1.0;" x1="80" x2="271" y1="167.1025" y2="167.1025"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="76" x="85" y="185.1777">GetName()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="65" x="85" y="202.1924">Intialize()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="115" x="85" y="219.207">GetTaskConifg()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="119" x="85" y="236.2217">MessageHandle()</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="59" x="85" y="253.2363">Invoke()</text></g><!--class SAStore--><g id="elem_SAStore"><rect codeline="20" fill="#FFFFFF" height="121.0732" id="SAStore" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="327" x="12" y="320"></rect><ellipse cx="142.25" cy="334" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M145.0156,335.5313 L147.4063,336.2813 Q146.8594,338.2656 145.5781,339.2344 Q144.3125,340.2031 142.3438,340.2031 Q139.9219,340.2031 138.3594,338.5469 Q136.8125,336.8906 136.8125,334.0156 Q136.8125,330.9844 138.375,329.3125 Q139.9375,327.625 142.5,327.625 Q144.7344,327.625 146.125,328.9375 Q146.9531,329.7188 147.375,331.1875 L144.9375,331.7656 Q144.7188,330.8125 144.0313,330.2656 Q143.3594,329.7188 142.375,329.7188 Q141.0156,329.7188 140.1719,330.7031 Q139.3438,331.6719 139.3438,333.8438 Q139.3438,336.1406 140.1719,337.125 Q141,338.1094 142.3281,338.1094 Q143.3125,338.1094 144.0156,337.4844 Q144.7188,336.8594 145.0156,335.5313 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="59" x="159.75" y="339.5679">SAStore</text><line style="stroke:#000000;stroke-width:1.0;" x1="13" x2="338" y1="348" y2="348"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="69" x="18" y="366.0752">saSize:int</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="315" x="18" y="383.0898">root: ListNode //存储服务和特性相关信息的链表</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="106" x="18" y="400.1045">mapSize: int16</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="104" x="18" y="417.1191">mapTop: int16</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="128" x="18" y="434.1338">maps: PidHandle[]</text></g><!--class PidHandle--><g id="elem_PidHandle"><rect codeline="28" fill="#FFFFFF" height="104.0586" id="PidHandle" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="301" x="25" y="501"></rect><ellipse cx="138.25" cy="515" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M141.0156,516.5313 L143.4063,517.2813 Q142.8594,519.2656 141.5781,520.2344 Q140.3125,521.2031 138.3438,521.2031 Q135.9219,521.2031 134.3594,519.5469 Q132.8125,517.8906 132.8125,515.0156 Q132.8125,511.9844 134.375,510.3125 Q135.9375,508.625 138.5,508.625 Q140.7344,508.625 142.125,509.9375 Q142.9531,510.7188 143.375,512.1875 L140.9375,512.7656 Q140.7188,511.8125 140.0313,511.2656 Q139.3594,510.7188 138.375,510.7188 Q137.0156,510.7188 136.1719,511.7031 Q135.3438,512.6719 135.3438,514.8438 Q135.3438,517.1406 136.1719,518.125 Q137,519.1094 138.3281,519.1094 Q139.3125,519.1094 140.0156,518.4844 Q140.7188,517.8594 141.0156,516.5313 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="67" x="155.75" y="520.5679">PidHandle</text><line style="stroke:#000000;stroke-width:1.0;" x1="26" x2="325" y1="529" y2="529"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="234" x="31" y="547.0752">pid: pid_t //客户端EP所在进程的Pid</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="278" x="31" y="564.0898">uid: uid_t //客户端EP所在进程拥有者的Uid</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="289" x="31" y="581.1045">handle: unit32 //客户端EP的boss线程的Tid</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="104" x="31" y="598.1191">deadId: unit32</text></g><!--class ListNode--><g id="elem_ListNode"><rect codeline="35" fill="#FFFFFF" height="70.0293" id="ListNode" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="127" x="374" y="345.5"></rect><ellipse cx="404.1" cy="359.5" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M406.8656,361.0313 L409.2563,361.7813 Q408.7094,363.7656 407.4281,364.7344 Q406.1625,365.7031 404.1938,365.7031 Q401.7719,365.7031 400.2094,364.0469 Q398.6625,362.3906 398.6625,359.5156 Q398.6625,356.4844 400.225,354.8125 Q401.7875,353.125 404.35,353.125 Q406.5844,353.125 407.975,354.4375 Q408.8031,355.2188 409.225,356.6875 L406.7875,357.2656 Q406.5688,356.3125 405.8813,355.7656 Q405.2094,355.2188 404.225,355.2188 Q402.8656,355.2188 402.0219,356.2031 Q401.1938,357.1719 401.1938,359.3438 Q401.1938,361.6406 402.0219,362.625 Q402.85,363.6094 404.1781,363.6094 Q405.1625,363.6094 405.8656,362.9844 Q406.5688,362.3594 406.8656,361.0313 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="61" x="419.9" y="365.0679">ListNode</text><line style="stroke:#000000;stroke-width:1.0;" x1="375" x2="500" y1="373.5" y2="373.5"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="113" x="380" y="391.5752">next: ListNode*</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="115" x="380" y="408.5898">info: ServiceInfo</text></g><!--class ServiceInfo--><g id="elem_ServiceInfo"><rect codeline="40" fill="#FFFFFF" height="87.0439" id="ServiceInfo" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="146" x="536.5" y="337"></rect><ellipse cx="567.5" cy="351" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M570.2656,352.5313 L572.6563,353.2813 Q572.1094,355.2656 570.8281,356.2344 Q569.5625,357.2031 567.5938,357.2031 Q565.1719,357.2031 563.6094,355.5469 Q562.0625,353.8906 562.0625,351.0156 Q562.0625,347.9844 563.625,346.3125 Q565.1875,344.625 567.75,344.625 Q569.9844,344.625 571.375,345.9375 Q572.2031,346.7188 572.625,348.1875 L570.1875,348.7656 Q569.9688,347.8125 569.2813,347.2656 Q568.6094,346.7188 567.625,346.7188 Q566.2656,346.7188 565.4219,347.7031 Q564.5938,348.6719 564.5938,350.8438 Q564.5938,353.1406 565.4219,354.125 Q566.25,355.1094 567.5781,355.1094 Q568.5625,355.1094 569.2656,354.4844 Q569.9688,353.8594 570.2656,352.5313 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="78" x="583.5" y="356.5679">ServiceInfo</text><line style="stroke:#000000;stroke-width:1.0;" x1="537.5" x2="681.5" y1="365" y2="365"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="91" x="542.5" y="383.0752">name: char[]</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="102" x="542.5" y="400.0898">handle: unit32</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="134" x="542.5" y="417.1045">head: FeatureNode</text></g><!--class FeatureNode--><g id="elem_FeatureNode"><rect codeline="46" fill="#FFFFFF" height="104.0586" id="FeatureNode" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="138" x="717.5" y="328.5"></rect><ellipse cx="739.95" cy="342.5" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M742.7156,344.0313 L745.1063,344.7813 Q744.5594,346.7656 743.2781,347.7344 Q742.0125,348.7031 740.0438,348.7031 Q737.6219,348.7031 736.0594,347.0469 Q734.5125,345.3906 734.5125,342.5156 Q734.5125,339.4844 736.075,337.8125 Q737.6375,336.125 740.2,336.125 Q742.4344,336.125 743.825,337.4375 Q744.6531,338.2188 745.075,339.6875 L742.6375,340.2656 Q742.4188,339.3125 741.7313,338.7656 Q741.0594,338.2188 740.075,338.2188 Q738.7156,338.2188 737.8719,339.2031 Q737.0438,340.1719 737.0438,342.3438 Q737.0438,344.6406 737.8719,345.625 Q738.7,346.6094 740.0281,346.6094 Q741.0125,346.6094 741.7156,345.9844 Q742.4188,345.3594 742.7156,344.0313 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="89" x="754.05" y="348.0679">FeatureNode</text><line style="stroke:#000000;stroke-width:1.0;" x1="718.5" x2="854.5" y1="356.5" y2="356.5"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="91" x="723.5" y="374.5752">name: char[]</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="117" x="723.5" y="391.5898">isDefault: unit32</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="96" x="723.5" y="408.6045">token: unit32</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="126" x="723.5" y="425.6191">next FeatureNode</text></g><!--link SamgrServer to SAStore--><g id="link_SamgrServer_SAStore"><path codeline="53" d="M175.5,260.03 C175.5,280.89 175.5,295.69 175.5,313.95 " fill="none" id="SamgrServer-to-SAStore" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="175.5,319.95,179.5,310.95,175.5,314.95,171.5,310.95,175.5,319.95" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link SAStore to ListNode--><g id="link_SAStore_ListNode"><path codeline="54" d="M339.25,380.5 C350.76,380.5 356.28,380.5 367.79,380.5 " fill="none" id="SAStore-to-ListNode" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="373.79,380.5,364.79,376.5,368.79,380.5,364.79,384.5,373.79,380.5" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link SAStore to PidHandle--><g id="link_SAStore_PidHandle"><path codeline="55" d="M175.5,441.13 C175.5,460.63 175.5,476.09 175.5,494.9 " fill="none" id="SAStore-to-PidHandle" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="175.5,500.9,179.5,491.9,175.5,495.9,171.5,491.9,175.5,500.9" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link ListNode to ServiceInfo--><g id="link_ListNode_ServiceInfo"><path codeline="56" d="M501.33,380.5 C513.02,380.5 518.71,380.5 530.4,380.5 " fill="none" id="ListNode-to-ServiceInfo" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="536.4,380.5,527.4,376.5,531.4,380.5,527.4,384.5,536.4,380.5" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--link ServiceInfo to FeatureNode--><g id="link_ServiceInfo_FeatureNode"><path codeline="57" d="M682.79,380.5 C694.27,380.5 699.75,380.5 711.22,380.5 " fill="none" id="ServiceInfo-to-FeatureNode" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="717.22,380.5,708.22,376.5,712.22,380.5,708.22,384.5,717.22,380.5" style="stroke:#000000;stroke-width:1.0;"></polygon></g><!--SRC=[VLDDYzD06BxdLumt5SgYWeSv59PrrO1T5bAzYCWqUTiCcoyoawLr4QguO5szx5x4xQM2M13TWmS_3lRFcAJ-2zzaCaswY_RGpZppFX_lEzDBqWKVIEGn7XWkTu207yaHyS7lGImCm_QO4CHY_Y2s8Dw7-C0W-Ba3SeVvSFbAkJC3oPd7d-WzddQPsDiA0zuVL5W7X603kCi2nwjv- -6Utg0voiWHDQj5YOh2cPBjm8b27iWIy-MGaauYOMWwgaY6CL1YRLh5Ggb5zcOYNKfCjS284FUPhKx5I6ong7D1fuHPZtjeBoXv03OA6iRJrHoKmq4LpSAMgKuLXw6av1uNSYV4EMvif9_Vfi_dsVHD-cgM7h_E9p-oySVyz7jw-FNtOfOzEylVlVXpycivcwkkM5Jg4HIyTbD3tJ0wXs2kNUweEJvyL6TRWIfTn1rQV3sMHPGlxxENt_9FPzkxsMISJkVBnMa-Fy80o2hBaw8y-NzvTlGXcqwMuqFatQzuRcc9r83B6zVNkLZM2uN8VowKLxVYEC0Sqz6SkWCzEzL00CF6FA-gMmtw8TupFaHkWucRnjNKOCN7zqc9xR8OftGnge8m2IMtWSaaXiAcrck0_z3ZuXRqMUB9DKc9BpfOGuf6pdiq_b2jLbi_tEgt5VE1ArjjtViARxLNbspeGrtS74fZhOyR_dy1]--></g></svg></p><p>samgr EP接受客户端EP的IPC消息后：</p>
<p class="plantuml"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="955px" preserveAspectRatio="none" style="width:692px;height:955px;background:#FFFFFF;" version="1.1" viewBox="0 0 692 955" width="692px" zoomAndPan="magnify"><defs></defs><g><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="277" x="174.5" y="6"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="257" x="184.5" y="28.0645">samgr EP的boss线程的StartLoop()循环收到</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="156" x="235" y="60.584"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="136" x="245" y="82.6484">调用Dispatch()函数处理</text><rect fill="#FFFFFF" height="221.9346" style="stroke:#000000;stroke-width:1.0;" width="326" x="150" y="105.168"></rect><path d="M233,105.168 L233,115.1826 L223,125.1826 L150,125.1826 " fill="none" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="73" x="153" y="120.2432">Dispatch()</text><rect fill="#FFFFFF" height="49.168" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="246" x="190" y="142.1826"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="208" x="200" y="164.2471">GetToken()从ipcMsg中取出token，</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="226" x="200" y="178.8311">该token指出EP用以处理该消息的Router</text><rect fill="#FFFFFF" height="49.168" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="172" x="227" y="211.3506"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="130" x="237" y="233.415">获取EP对应的Router，</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="152" x="237" y="247.999">endpoint.routers[token]</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="306" x="160" y="280.5186"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="286" x="170" y="302.583">利用router,ipcMsg构建Request,调用HandleIpc()</text><rect fill="#FFFFFF" height="247.3506" style="stroke:#000000;stroke-width:1.0;" width="321" x="152.5" y="337.1025"></rect><path d="M242.5,337.1025 L242.5,347.1172 L232.5,357.1172 L152.5,357.1172 " fill="none" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="80" x="155.5" y="352.1777">HandleIpc()</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="301" x="162.5" y="374.1172"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="281" x="172.5" y="396.1816">解析Request获得ipcMsg,endpoint,router等信息</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="238" x="194" y="428.7012"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="218" x="204" y="450.7656">根据Uid判断是否有权限调用对应Router</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="269" x="178.5" y="483.2852"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="249" x="188.5" y="505.3496">调用router-&gt;proxy-&gt;Invoke()处理IPC消息</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="262" x="182" y="537.8691"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="242" x="192" y="559.9336">根据返回值决定是否响应消息给IPC发送者EP</text><rect fill="#FFFFFF" height="355.1025" style="stroke:#000000;stroke-width:1.0;" width="680" x="6" y="594.4531"></rect><path d="M133,594.4531 L133,604.4678 L123,614.4678 L6,614.4678 " fill="none" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="117" x="9" y="609.5283">samgr的Invoke()</text><rect fill="#FFFFFF" height="49.168" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="453" x="86.5" y="631.4678"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="298" x="96.5" y="653.5322">调用IpcIoPopUnint32()获取resource,option信息，</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="433" x="96.5" y="668.1162">前者决定调用哪个功能函数（RES_ENDPOINT,RES_FEATURE,RES_SYSCAP)</text><polygon fill="#FFFFFF" points="288,700.6357,338,700.6357,350,712.6357,338,724.6357,288,724.6357,276,712.6357,288,700.6357" style="stroke:#000000;stroke-width:1.0;"></polygon><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="50" x="288" y="717.0105">resource</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="90" x="186" y="710.3262">RES_ENDPOINT</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="81" x="350" y="710.3262">RES_FEATURE</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="252" x="18" y="734.6357"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="232" x="28" y="756.7002">调用GenServiceHandle生成SvcIdentity</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="107" x="90.5" y="789.2197"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="87" x="100.5" y="811.2842">配置PidHandle</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="231" x="28.5" y="858.3877"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="211" x="38.5" y="880.4521">存放在g_server.store的maps存储中</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="179" x="392.5" y="734.6357"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="159" x="402.5" y="756.7002">检查对应PidHandle是否存在</text><rect fill="#FFFFFF" height="49.168" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="307" x="328.5" y="789.2197"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="287" x="338.5" y="811.2842">调用SASTORA_SAVE()将服务或特性节点插入链表中</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="255" x="338.5" y="825.8682">包括ListNode，ServiceInfo，FeatureNode</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="384" x="290" y="872.9717"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="364" x="300" y="895.0361">客户端EP注册到服务管理者中的服务和特性可以向其它进程提供服务</text><polygon fill="#FFFFFF" points="313,913.5557,325,925.5557,313,937.5557,301,925.5557,313,913.5557" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="313" x2="313" y1="40.584" y2="60.584"></line><polygon fill="#000000" points="309,50.584,313,60.584,317,50.584,313,54.584" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="313" x2="313" y1="191.3506" y2="211.3506"></line><polygon fill="#000000" points="309,201.3506,313,211.3506,317,201.3506,313,205.3506" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="313" x2="313" y1="260.5186" y2="280.5186"></line><polygon fill="#000000" points="309,270.5186,313,280.5186,317,270.5186,313,274.5186" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="313" x2="313" y1="95.168" y2="142.1826"></line><polygon fill="#000000" points="309,132.1826,313,142.1826,317,132.1826,313,136.1826" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="313" x2="313" y1="408.7012" y2="428.7012"></line><polygon fill="#000000" points="309,418.7012,313,428.7012,317,418.7012,313,422.7012" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="313" x2="313" y1="463.2852" y2="483.2852"></line><polygon fill="#000000" points="309,473.2852,313,483.2852,317,473.2852,313,477.2852" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="313" x2="313" y1="517.8691" y2="537.8691"></line><polygon fill="#000000" points="309,527.8691,313,537.8691,317,527.8691,313,531.8691" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="313" x2="313" y1="315.1025" y2="374.1172"></line><polygon fill="#000000" points="309,364.1172,313,374.1172,317,364.1172,313,368.1172" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="144" x2="144" y1="769.2197" y2="789.2197"></line><polygon fill="#000000" points="140,779.2197,144,789.2197,148,779.2197,144,783.2197" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="144" x2="144" y1="823.8037" y2="858.3877"></line><polygon fill="#000000" points="140,848.3877,144,858.3877,148,848.3877,144,852.3877" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="482" x2="482" y1="769.2197" y2="789.2197"></line><polygon fill="#000000" points="478,779.2197,482,789.2197,486,779.2197,482,783.2197" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="482" x2="482" y1="838.3877" y2="872.9717"></line><polygon fill="#000000" points="478,862.9717,482,872.9717,486,862.9717,482,866.9717" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="276" x2="144" y1="712.6357" y2="712.6357"></line><line style="stroke:#000000;stroke-width:1.0;" x1="144" x2="144" y1="712.6357" y2="734.6357"></line><polygon fill="#000000" points="140,724.6357,144,734.6357,148,724.6357,144,728.6357" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="350" x2="482" y1="712.6357" y2="712.6357"></line><line style="stroke:#000000;stroke-width:1.0;" x1="482" x2="482" y1="712.6357" y2="734.6357"></line><polygon fill="#000000" points="478,724.6357,482,734.6357,486,724.6357,482,728.6357" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="144" x2="144" y1="892.9717" y2="925.5557"></line><line style="stroke:#000000;stroke-width:1.0;" x1="144" x2="301" y1="925.5557" y2="925.5557"></line><polygon fill="#000000" points="291,921.5557,301,925.5557,291,929.5557,295,925.5557" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="482" x2="482" y1="907.5557" y2="925.5557"></line><line style="stroke:#000000;stroke-width:1.0;" x1="482" x2="325" y1="925.5557" y2="925.5557"></line><polygon fill="#000000" points="335,921.5557,325,925.5557,335,929.5557,331,925.5557" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="313" x2="313" y1="680.6357" y2="700.6357"></line><polygon fill="#000000" points="309,690.6357,313,700.6357,317,690.6357,313,694.6357" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="313" x2="313" y1="572.4531" y2="631.4678"></line><polygon fill="#000000" points="309,621.4678,313,631.4678,317,621.4678,313,625.4678" style="stroke:#000000;stroke-width:1.0;"></polygon><!--SRC=[PLJTJzfG57_dh-ZU844VjZT9J8XMH-AqeRXaMHR3u8hDjEtQOkORYc1H45Jc_60wfapcnaTYeW8A_mpt5fxy5tRQMzHaFFMUSy_luvnpUQ4je2N4o8j1GNICgC6bYCAmd76q_b5ILQFPCSfRSE2reA9DIPBiTE7sfR5T8_bhhDSzZf5UFMxao-E2AWUrq0AaD-x9rpe-NpToIOyZeaXHcNdAEaOcaHQGFY7HwUgsjWKvz4QDT6yhEBkFDvgQcNYuIpjwjPBrJT8R40Ov-NAtLQAWa2FNEbcjWIo_5DMGOghOlW48biEr1cxc7pCc5XB3iYI8sh1YXTJt5l87ACBwRm2cOJULGaxMSQlfHv-ZIDNSrDlhe1XUH3uvv7HvJ3J6CcLRUvO45HTdv2HdLvkIsjyeh7iWmatPZ4ggsoc21r11VZH8fZehXB5-JlOhvA26Sxz88KM-n_k7EIg1sdfoQmKfrD2eh4XVLeP6VU8o68C1M5toSMEqIuyClKuU7v_Ws1rENk7g4UN1Una0jllPEeGgdDtfnrPxiGJB_U_MMW_exe1h80Ny-oHEacT5yFZgfTD5vw4WLOeg8UIMP4sGH6hPd0bEPO212h4TxbrsRo_nvcalVazNwE5EzxFy73izpitufWDkyp31UWEpVjRwvj_nOruEHYBCCyu1auk1THOPv_DAbuE1dwrq4eayKfQ54AAJC_AdHC_noo5V68cQeAruwEr-8cFSLpaXJA_PKLmv8FasBfGZSogW86LOrIG5GKUMWh8AMRnMXcs6nYsgYAgm9TiYo5cCd9ReE1_1xL50TQ7iUIwMz_A16RztZlU-PM6mzIGfPF1caUZxHgf1OXUzpJLZhK6okpXHwk-rUqMJt0B0wGJP-ZibgDgq54RGSjkqJvoNu3I1WbfKGMPkuApwa-WtnfyQov6hCawcuNLJDgDQD5zTB07OO9G6yMwQIi3PclaoSpiuSOshyLxd6FumI3RNRH_JczOI2VDFg_GF]--></g></svg></p><p>RemoteRegister的clients</p>
<p class="plantuml"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="338px" preserveAspectRatio="none" style="width:668px;height:338px;background:#FFFFFF;" version="1.1" viewBox="0 0 668 338" width="668px" zoomAndPan="magnify"><defs></defs><g><!--class RemoteRegister--><g id="elem_RemoteRegister"><rect codeline="4" fill="#FFFFFF" height="87.0439" id="RemoteRegister" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="153" x="485.5" y="12"></rect><ellipse cx="504.35" cy="26" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M507.1156,27.5313 L509.5063,28.2813 Q508.9594,30.2656 507.6781,31.2344 Q506.4125,32.2031 504.4438,32.2031 Q502.0219,32.2031 500.4594,30.5469 Q498.9125,28.8906 498.9125,26.0156 Q498.9125,22.9844 500.475,21.3125 Q502.0375,19.625 504.6,19.625 Q506.8344,19.625 508.225,20.9375 Q509.0531,21.7188 509.475,23.1875 L507.0375,23.7656 Q506.8188,22.8125 506.1313,22.2656 Q505.4594,21.7188 504.475,21.7188 Q503.1156,21.7188 502.2719,22.7031 Q501.4438,23.6719 501.4438,25.8438 Q501.4438,28.1406 502.2719,29.125 Q503.1,30.1094 504.4281,30.1094 Q505.4125,30.1094 506.1156,29.4844 Q506.8188,28.8594 507.1156,27.5313 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="112" x="517.65" y="31.5679">RemoteRegister</text><line style="stroke:#000000;stroke-width:1.0;" x1="486.5" x2="637.5" y1="40" y2="40"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="101" x="491.5" y="58.0752">mtx : MutexId</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="106" x="491.5" y="75.0898">clients : Vector</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="141" x="491.5" y="92.1045">endpoint : Endpoint</text></g><!--class IDefaultClient--><g id="elem_IDefaultClient"><rect codeline="10" fill="#FFFFFF" height="155.1025" id="IDefaultClient" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="175" x="474.5" y="176"></rect><ellipse cx="511.35" cy="190" fill="#FFFFFF" rx="9" ry="9" style="stroke:#000000;stroke-width:1.0;"></ellipse><path d="M514.1156,191.5313 L516.5063,192.2813 Q515.9594,194.2656 514.6781,195.2344 Q513.4125,196.2031 511.4438,196.2031 Q509.0219,196.2031 507.4594,194.5469 Q505.9125,192.8906 505.9125,190.0156 Q505.9125,186.9844 507.475,185.3125 Q509.0375,183.625 511.6,183.625 Q513.8344,183.625 515.225,184.9375 Q516.0531,185.7188 516.475,187.1875 L514.0375,187.7656 Q513.8188,186.8125 513.1313,186.2656 Q512.4594,185.7188 511.475,185.7188 Q510.1156,185.7188 509.2719,186.7031 Q508.4438,187.6719 508.4438,189.8438 Q508.4438,192.1406 509.2719,193.125 Q510.1,194.1094 511.4281,194.1094 Q512.4125,194.1094 513.1156,193.4844 Q513.8188,192.8594 514.1156,191.5313 Z " fill="#000000"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="94" x="528.65" y="195.5679">IDefaultClient</text><line style="stroke:#000000;stroke-width:1.0;" x1="475.5" x2="648.5" y1="204" y2="204"></line><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="97" x="480.5" y="222.0752">key : SaName</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="142" x="480.5" y="239.0898">target: SvcIndentity</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="104" x="480.5" y="256.1045">deadId: unit32</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="143" x="480.5" y="273.1191">context: IpcContext</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="78" x="480.5" y="290.1338">ver: uint16</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="66" x="480.5" y="307.1484">ref: int16</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="163" x="480.5" y="324.1631">IClientProxy: iUnknown</text></g><path d="M11,235.5 L11,261.2993 A0,0 0 0 0 11,261.2993 L439,261.2993 A0,0 0 0 0 439,261.2993 L439,253.5 L478.5,318.5952 L439,245.5 L439,245.5 L429,235.5 L11,235.5 A0,0 0 0 0 11,235.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><path d="M429,235.5 L429,245.5 L439,245.5 L429,235.5 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="407" x="17" y="253.5698">客户端代理接口类的指针，调用其Invoke()实现服务或特性功能的使用</text><!--link RemoteRegister to IDefaultClient--><g id="link_RemoteRegister_IDefaultClient"><path codeline="20" d="M562,99.03 C562,121.43 562,143.61 562,169.68 " fill="none" id="RemoteRegister-to-IDefaultClient" style="stroke:#000000;stroke-width:1.0;"></path><polygon fill="#000000" points="562,175.68,566,166.68,562,170.68,558,166.68,562,175.68" style="stroke:#000000;stroke-width:1.0;"></polygon><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="97" x="563" y="143.0698">clients.data[x]</text></g><!--SRC=[NP3FIiD04CRl-nJhJGyLLF2GWvVg8GT5AdeH3sjsqeOccv1CQu88GlrJIwqYua54qI8AGgqNHMhnPPgaddm5jqb5wPvcVlFDp3SxXWMmW3ecCmGf61meM0u6r09h4roF4CradaTpODa8ESWR7e9BjmcLpqAVAdInXE2hF26QQO10Jz8rqD1s4mY2ExOXKDA5OKXsVWUhyw2paedPf3ETMuH0QbVO4hCW0SZSFA14PKqLNEeC39821yPLhj2IC71cEhLW2-b7YbL7owPnmilWIftSFJMRv2xe2lrBrTJ0iclxWUIheYZiBJ7mEN9w9ZCtObfw7TuzoHcoTN-3429a3pL1Hshh8tf5-R-CXAsxgFeMFpttEituz21gt8SdpVYb4r_kHVN3hxFgzqUztwx4vu_X_gigodOHnYV2rdNSQ4TNns7jDgfUn4VlqUv3MBlfLxgohzVzb78YFvuEVFm0]--></g></svg></p><p class="plantuml"><!--?xml version="1.0" encoding="us-ascii" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="699px" preserveAspectRatio="none" style="width:573px;height:699px;background:#FFFFFF;" version="1.1" viewBox="0 0 573 699" width="573px" zoomAndPan="magnify"><defs></defs><g><rect fill="#FFFFFF" height="49.168" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="444" x="64.5" y="6"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="424" x="74.5" y="28.0645">某进程通过SAMGR_GetInstance()-&gt;GetFeatureApi()获取IUnknown接口</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="204" x="74.5" y="42.6484">通过调用该接口来调用某个服务或特性</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="333" x="120" y="75.168"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="313" x="130" y="97.2324">根据serviceName调用GetService()尝试在本进程内查找</text><rect fill="#FFFFFF" height="49.168" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="286" x="143.5" y="129.752"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="156" x="153.5" y="151.8164">本进程无对应ServiceImpl，</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="266" x="153.5" y="166.4004">调用SAMGR_FindServiceApi()在SAMGR中查找</text><rect fill="#FFFFFF" height="450.1172" style="stroke:#000000;stroke-width:1.0;" width="561" x="6" y="188.9199"></rect><path d="M190,188.9199 L190,198.9346 L180,208.9346 L6,208.9346 " fill="none" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="174" x="9" y="203.9951">SAMGR_FindServiceApi()</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="333" x="120" y="225.9346"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="313" x="130" y="247.999">先查找本进程g_remoteRegister.clients中是否存在接口</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="426" x="73.5" y="280.5186"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="406" x="83.5" y="302.583">若无服务接口，则调用SAMGR_CreateIProxy()通过IPC向服务管理者查询</text><rect fill="#FFFFFF" height="247.3506" style="stroke:#000000;stroke-width:1.0;" width="541" x="16" y="325.1025"></rect><path d="M190,325.1025 L190,335.1172 L180,345.1172 L16,345.1172 " fill="none" style="stroke:#000000;stroke-width:1.0;"></path><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="164" x="19" y="340.1777">SAMGR_CreateIProxy()</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="421" x="76" y="362.1172"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="401" x="86" y="384.1816">通过QueryIdentity()向samgr EP发送RES_FEATURE类的OP_GET消息</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="521" x="26" y="416.7012"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="501" x="36" y="438.7656">服务管理者在g_server.store-&gt;root链表中查找匹配{服务名,特性名}的服务节点或特性节点</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="289" x="142" y="471.2852"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="269" x="152" y="493.3496">返回对应SvcIdentity，其中包含handle和token</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="323" x="125" y="525.8691"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="303" x="135" y="547.9336">调用SAMGR_CreateIClient()创建IDefaultClient对象</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="347" x="113" y="592.4531"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="327" x="123" y="614.5176">将创建的IDefaultClient放入g_remoteRegister.clients中</text><rect fill="#FFFFFF" height="34.584" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="540" x="16.5" y="659.0371"></rect><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="520" x="26.5" y="681.1016">invoke()调用，handle对应的boss线程接收到IPC信息，进入Dispatch()中对IPC消息进行处理</text><line style="stroke:#000000;stroke-width:1.0;" x1="286.5" x2="286.5" y1="55.168" y2="75.168"></line><polygon fill="#000000" points="282.5,65.168,286.5,75.168,290.5,65.168,286.5,69.168" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="286.5" x2="286.5" y1="109.752" y2="129.752"></line><polygon fill="#000000" points="282.5,119.752,286.5,129.752,290.5,119.752,286.5,123.752" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="286.5" x2="286.5" y1="260.5186" y2="280.5186"></line><polygon fill="#000000" points="282.5,270.5186,286.5,280.5186,290.5,270.5186,286.5,274.5186" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="286.5" x2="286.5" y1="396.7012" y2="416.7012"></line><polygon fill="#000000" points="282.5,406.7012,286.5,416.7012,290.5,406.7012,286.5,410.7012" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="286.5" x2="286.5" y1="451.2852" y2="471.2852"></line><polygon fill="#000000" points="282.5,461.2852,286.5,471.2852,290.5,461.2852,286.5,465.2852" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="286.5" x2="286.5" y1="505.8691" y2="525.8691"></line><polygon fill="#000000" points="282.5,515.8691,286.5,525.8691,290.5,515.8691,286.5,519.8691" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="286.5" x2="286.5" y1="315.1025" y2="362.1172"></line><polygon fill="#000000" points="282.5,352.1172,286.5,362.1172,290.5,352.1172,286.5,356.1172" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="286.5" x2="286.5" y1="560.4531" y2="592.4531"></line><polygon fill="#000000" points="282.5,582.4531,286.5,592.4531,290.5,582.4531,286.5,586.4531" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="286.5" x2="286.5" y1="178.9199" y2="225.9346"></line><polygon fill="#000000" points="282.5,215.9346,286.5,225.9346,290.5,215.9346,286.5,219.9346" style="stroke:#000000;stroke-width:1.0;"></polygon><line style="stroke:#000000;stroke-width:1.0;" x1="286.5" x2="286.5" y1="627.0371" y2="659.0371"></line><polygon fill="#000000" points="282.5,649.0371,286.5,659.0371,290.5,649.0371,286.5,653.0371" style="stroke:#000000;stroke-width:1.0;"></polygon><!--SRC=[VLDTRn9157tdL-0R9DOV04aJGe7iWuhGFfCLHjWKTidkW3R6XDQ2jEMhYhKMQekwIjHswGiMQk3FCBF3at_1kpj093M-xTovzvnppvczWrCeWvpPj2Z93WyzQx1no-mUJ0idRFmgwhiVYiH220koXaKvZbpkbLKu1f68SohoPIMNczL-algHi25loifJcTPqKl_auEEizz9iTfcXyoezrNa5M2RNtsYxIlOxj7naxWreuQiNsCy7j7gf8JKlnT43CODuEn16UStb9hrJPhmbxIvj_-1AIQb8ptIwDx80vaNwxfmO0p9ipWQ5J3Rz-rV5mG7vMa59JiokxKK0rBwON5_C0PEgaiiw_ztky91YcJSkQ9Cn5MKKZ28eAMaOgVVYQGd9MBCWZmtI-48kZYtjjXsWbntee7HcX5q4aQJy_c-PVXNCHa9OLPvjkTpSM27i9ur3FcTUTin6YHKi5vZnSLdqyh33mySVvP2w9IH0cOIX352Qc4cgpa2Or0-dXUr881eB1dph6v60UNLZdkm-3CT2WNNQBzDjmxPvYHWsIiQir61X3IigMbbL5GLFtunOfxjmarG6qsBrEPybZUfT7ZjylG06NcRxE-REOF4a-D7oQTmahG-pHFFnkNJBh68V64YbI1hVKwASI2FokeALJIHROxTjzDk1mCxb5haP2cleYPXBOru5V7RLyJgGd73Q9aB4lHBl18dBpRGv8aNzFu4luKXo7ZJ1ps8h0jqphVP6WFrOqJHpEBPURasdpJufzo3ZoRW3XaCtl2uWMvEqh8ZZAPVRMjaOG0UF1AvPfq8-xq8UtZy0]--></g></svg></p><blockquote>
<h3 id="打开设备驱动文件">打开设备驱动文件 </h3>
<p>设备驱动文件：在类 Unix 系统（如 Linux）中，设备驱动文件通常位于 /dev 目录下。它们是特殊的文件，提供了用户空间程序与硬件设备或虚拟设备交互的接口。通过这些文件，程序可以读取或写入设备，或者执行特定的控制操作。</p>
<p>打开过程：打开设备驱动文件通常涉及到调用如 open 的系统调用。这个调用需要设备文件的路径和所需的访问模式（如只读、只写或读写）。成功的 open 调用返回一个文件描述符（fd），这是一个整数值，用于后续的读写或控制操作。</p>
<p>用途：这个过程通常用于与特定的硬件设备通信，比如读取传感器数据，控制图形显示设备，或者与网络接口交互。在 IPC (进程间通信) 的上下文中，这可能涉及到打开一个代表某种通信机制（如管道、消息队列）的特殊文件。</p>
<h3 id="创建内存映射">创建内存映射 </h3>
<p>内存映射（Memory Mapping）：内存映射是一种内存管理技术，它允许程序将一部分磁盘文件映射到其地址空间。通过这种方式，文件内容可以像访问普通内存一样直接访问，这样可以提高文件操作的效率，并且支持进程间共享内存。</p>
<p>创建过程：在类 Unix 系统中，这通常通过 mmap 系统调用实现。mmap 调用需要文件描述符、映射区域的大小、期望的保护级别（如是否可读写）、映射类型（共享或私有）等参数。成功调用 mmap 后，它返回一个指向映射区域开始位置的指针。</p>
<p>用途：内存映射常用于高效文件访问，以及在多个进程之间共享内存。在 IPC 上下文中，内存映射可以用来创建一个共享的内存区域，让多个进程可以读写同一块内存，从而实现数据共享和通信。</p>
</blockquote>

      </div>
      
      
    
    
    
    
    
    
  
    </body></html>